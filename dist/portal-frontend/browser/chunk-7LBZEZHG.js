import{a as ue}from"./chunk-PZI4WV4M.js";import{p as le}from"./chunk-WY5L5QV5.js";import{a as P}from"./chunk-WYL7NH4F.js";import{a as de,b as ce}from"./chunk-DEGAUCA6.js";import{j as pe}from"./chunk-Y6YU6P5I.js";import"./chunk-YGKFOOJ6.js";import"./chunk-7XV6CRBL.js";import{a as se,b as me}from"./chunk-LFBU7IBC.js";import"./chunk-6OSMVD66.js";import"./chunk-IAKHD2KQ.js";import"./chunk-KTZAFNHT.js";import"./chunk-L2YMTAJ4.js";import{e as K,f as X}from"./chunk-SQDM7FYD.js";import"./chunk-MUUDK5FO.js";import"./chunk-GS33KFGJ.js";import{h as te,i as ie,q as ne,x as ae}from"./chunk-OHCSBWXS.js";import"./chunk-APKN3PFA.js";import"./chunk-X6GEXHSG.js";import{a as Z,b as ee}from"./chunk-MX4UQD2B.js";import"./chunk-X5B2VV3T.js";import"./chunk-ZTWDMVRM.js";import"./chunk-P7FDEGEE.js";import"./chunk-XSSXK7EZ.js";import{a as re,b as oe}from"./chunk-PWTX4GCB.js";import{b as R,c as S,e as L,f as z,i as $,j,k as q,m as Q,o as G,p as U,q as J}from"./chunk-HXGQMCX4.js";import"./chunk-TDXTCVPJ.js";import"./chunk-WTM76CTQ.js";import{d as F,e as N}from"./chunk-AXYD25ST.js";import{e as W,i as Y,n as w}from"./chunk-VBSZGXZN.js";import{$ as E,Db as M,Eb as V,Fb as k,Hb as d,Ib as T,Ob as D,Pb as O,Ta as s,Wa as H,Y as h,Za as A,da as B,db as f,ea as v,fa as C,fb as m,kb as y,ob as a,pb as n,qb as u,ub as b,wb as g,xb as c}from"./chunk-HOTPW52P.js";function he(i,l){if(i&1&&u(0,"app-error-input",6),i&2){let o=c();m("message",o.getErrorMessage("name",o.form))}}function ve(i,l){if(i&1&&u(0,"app-error-input",6),i&2){let o=c();m("message",o.getErrorMessage("price",o.form))}}function Ce(i,l){if(i&1&&u(0,"app-error-input",6),i&2){let o=c();m("message",o.getErrorMessage("description",o.form))}}function be(i,l){if(i&1&&u(0,"app-error-input",6),i&2){let o=c();m("message",o.getErrorMessage("period",o.form))}}function Te(i,l){if(i&1){let o=b();a(0,"p-button",17),g("onClick",function(){v(o);let t=c();return C(t.handleAccept())}),n(),a(1,"p-button",18),g("onClick",function(){v(o);let t=c();return t.modalData.response=null,C(t.handleClose.emit())}),n()}i&2&&(m("raised",!0)("rounded",!0),s(),m("raised",!0)("rounded",!0))}var fe=(()=>{let l=class l{constructor(){this.fb=h(Q),this.getErrorMessage=ee,this.modalData={title:"",visible:!1,data:null,response:null},this.handleClose=new A,this.perdiodOptions=[{label:"Mensual",value:P.MONTHLY},{label:"Casual",value:P.CASUAL}],this.form=this.fb.group({id:[""],name:["",S.required],description:[""],price:[0,[S.required,S.min(0)]],period:["",S.required]})}ngOnChanges(r){r.modalData&&(this.form.reset(),this.modalData.data&&this.form.patchValue(this.modalData.data))}handleAccept(){this.form.valid?(this.modalData.response=this.form.value,this.handleClose.emit()):Object.values(this.form.controls).forEach(r=>{r.invalid&&(r.markAsDirty(),r.updateValueAndValidity({onlySelf:!0}))})}isReadonly(){return this.modalData.data?!this.modalData.data.canBeDeleted:!1}};l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=E({type:l,selectors:[["app-income-type-form"]],inputs:{modalData:"modalData"},outputs:{handleClose:"handleClose"},standalone:!0,features:[B,D],decls:26,vars:15,consts:[["id","dialog","styleClass","w-10 md:w-6 lg:w-6",3,"header","visible","modal","draggable","resizable","visibleChange","onHide"],[1,"pt-4","grid","row-gap-3","h-full",3,"formGroup"],[1,"col-12","lg:col-6"],[1,"p-float-label"],["pInputText","","formControlName","name","id","name","type","text",1,"w-full",3,"readOnly"],["for","name"],[3,"message"],[1,"p-float-label","w-full"],["formControlName","price","mode","currency","currency","USD","locale","en-US","styleClass","w-full",1,"w-full",3,"min"],["for","price"],[1,"col-12","lg:col-8"],["pInputTextarea","","formControlName","description","id","description",1,"w-full",3,"rows"],["for","description"],[1,"col-12","lg:col-4","relative"],["for","severity",1,"text-xs","text-gray-500","block","ml-3","absolute","left-0",2,"top","-1rem"],["styleClass","w-full","formControlName","period","appendTo","body","placeholder","Selecciona un periodo",3,"options","readonly"],["pTemplate","footer"],["label","Aceptar","severity","success",3,"raised","rounded","onClick"],["label","Cancelar","severity","danger",3,"raised","rounded","onClick"]],template:function(t,e){if(t&1&&(a(0,"p-dialog",0),g("visibleChange",function(_){return e.modalData.visible=_})("onHide",function(){return e.modalData.response=null,e.handleClose.emit()}),a(1,"form",1)(2,"div",2)(3,"span",3),u(4,"input",4),a(5,"label",5),d(6,"Nombre"),n()(),f(7,he,1,1,"app-error-input",6),n(),a(8,"div",2)(9,"span",7),u(10,"p-inputNumber",8),a(11,"label",9),d(12,"Pago"),n()(),f(13,ve,1,1,"app-error-input",6),n(),a(14,"div",10)(15,"span",3),u(16,"textarea",11),a(17,"label",12),d(18,"Descripci\xF3n"),n()(),f(19,Ce,1,1,"app-error-input",6),n(),a(20,"div",13)(21,"label",14),d(22,"Periodo de pago"),n(),u(23,"p-dropdown",15),f(24,be,1,1,"app-error-input",6),n()(),f(25,Te,2,4,"ng-template",16),n()),t&2){let p,_,x,I;m("header",e.modalData.title)("visible",e.modalData.visible)("modal",!0)("draggable",!1)("resizable",!1),s(),m("formGroup",e.form),s(3),m("readOnly",e.isReadonly()),s(3),y(7,(p=e.form.get("name"))!=null&&p.dirty&&((p=e.form.get("name"))!=null&&p.invalid)?7:-1),s(3),m("min",0),s(3),y(13,(_=e.form.get("price"))!=null&&_.dirty&&((_=e.form.get("price"))!=null&&_.invalid)?13:-1),s(3),m("rows",5),s(3),y(19,(x=e.form.get("description"))!=null&&x.dirty&&((x=e.form.get("description"))!=null&&x.invalid)?19:-1),s(4),m("options",e.perdiodOptions)("readonly",e.isReadonly()),s(),y(24,(I=e.form.get("period"))!=null&&I.dirty&&((I=e.form.get("period"))!=null&&I.invalid)?24:-1)}},dependencies:[X,K,w,G,$,R,L,z,j,q,N,F,oe,re,me,se,J,U,Z,ie,te]});let i=l;return i})();var Se=["container"],xe=["table"];function Ie(i,l){i&1&&(a(0,"tr")(1,"th"),d(2,"Nombre"),n(),a(3,"th"),d(4,"Descripci\xF3n"),n(),a(5,"th"),d(6,"Pago"),n(),a(7,"th"),d(8,"Periodo de pago"),n(),a(9,"th"),d(10,"Activo"),n(),a(11,"th",7),d(12,"Acciones"),n()())}function Ee(i,l){if(i&1){let o=b();a(0,"p-button",12),g("onClick",function(){v(o);let t=c(2).$implicit,e=c();return C(e.onDeleteIncomeType(t))}),n()}i&2&&m("rounded",!0)("raised",!0)}function De(i,l){if(i&1){let o=b();a(0,"p-button",13),g("onClick",function(){v(o);let t=c(2).$implicit,e=c();return C(e.onReactivateIncomeType(t))}),n()}i&2&&m("rounded",!0)("raised",!0)}function we(i,l){if(i&1&&f(0,Ee,1,2,"p-button",11)(1,De,1,2),i&2){let o=c().$implicit;y(0,o.active?0:1)}}function Fe(i,l){if(i&1){let o=b();a(0,"tr")(1,"td"),d(2),n(),a(3,"td"),d(4),n(),a(5,"td"),d(6),n(),a(7,"td"),d(8),n(),a(9,"td"),u(10,"p-chip",8),n(),a(11,"td")(12,"div",9)(13,"p-button",10),g("onClick",function(){let e=v(o).$implicit,p=c();return C(p.onOpenForm(e))}),n(),f(14,we,2,1),n()()()}if(i&2){let o=l.$implicit,r=c();s(2),T(o.name),s(2),T(o.description),s(2),T("$ "+r.getNumberWithDigits(o.price)),s(2),T(r.getIncomeTypePeriodSpanishTranslation(o.period)),s(2),m("label",o.active?"Si":"No")("styleClass",o.active?"bg-blue-100 text-blue-600 text-sm shadow-3":"bg-red-100 text-red-600 text-sm shadow-3"),s(3),m("rounded",!0)("raised",!0),s(),y(14,o.canBeDeleted?14:-1)}}var Ne=()=>({"min-width":"50rem"}),Me=()=>["name"],ct=(()=>{let l=class l{constructor(){this.incomeTypeService=h(ue),this.messageService=h(Y),this.confirmationService=h(W),this.cdr=h(H),this.getIncomeTypePeriodSpanishTranslation=le,this.modalData={title:"",visible:!1,data:null,response:null},this.incomeTypes=[],this.toolbarHeight=0,this.containerOptions={dataLoading:!0,showNewButton:!0,showSearch:!0}}ngOnInit(){this.getIncomeTypes()}ngAfterViewInit(){this.toolbarHeight=this.container.toolbar.getBlockableElement().clientHeight,this.cdr.detectChanges()}getIncomeTypes(){this.containerOptions.dataLoading=!0,this.incomeTypeService.findAll().subscribe(r=>{this.incomeTypes=r.data,setTimeout(()=>{this.containerOptions.dataLoading=!1},300)})}onOpenForm(r){this.modalData={title:r?"Editar tipo de Ingreso":"Nuevo tipo de Ingreso",visible:!0,data:r,response:null}}onHandleClose(){if(this.modalData.response){let r=this.modalData.response.id;if(r){let t={name:this.modalData.response.name,description:this.modalData.response.description,price:this.modalData.response.price,period:this.modalData.response.period};this.incomeTypeService.update(r,t).subscribe({next:e=>{this.messageService.add({severity:"success",summary:"Tipo de Ingreso actualizado",detail:e.message}),this.getIncomeTypes(),this.reset()},error:e=>{e.error?e.status===500?this.messageService.add({severity:"error",summary:"Error",detail:e.error}):this.messageService.add({severity:"error",summary:"Error",detail:e.error.message}):this.messageService.add({severity:"error",summary:"Error",detail:"Error al actualizar el tipo de ingreso"})}})}else{let t={name:this.modalData.response.name,description:this.modalData.response.description,price:this.modalData.response.price,period:this.modalData.response.period};this.incomeTypeService.create(t).subscribe({next:e=>{this.messageService.add({severity:"success",summary:"Tipo de Ingreso creado",detail:e.message}),this.getIncomeTypes(),this.reset()},error:e=>{e.error?e.status===500?this.messageService.add({severity:"error",summary:"Error",detail:e.error}):this.messageService.add({severity:"error",summary:"Error",detail:e.error.message}):this.messageService.add({severity:"error",summary:"Error",detail:"Error al crear el tipo de ingreso"})}})}}else this.reset()}onSearch(r){this.table.filterGlobal(r,"contains")}onDeleteIncomeType(r){this.confirmationService.confirm({message:`\xBFEst\xE1 seguro que desea inhabilitar el tipo de ingreso
                <span class="font-bold"> ${r.name}</span>
                ?`,header:"Confirmar inactivaci\xF3n",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",acceptIcon:"pi pi-trash mr-2",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.incomeTypeService.delete(r.id).subscribe({next:t=>{this.messageService.add({severity:"success",summary:"Tipo de Ingreso inactivado",detail:t.message}),this.getIncomeTypes()},error:t=>{t.error?t.status===500?this.messageService.add({severity:"error",summary:"Error",detail:t.error}):this.messageService.add({severity:"error",summary:"Error",detail:t.error.message}):this.messageService.add({severity:"error",summary:"Error",detail:"Error al inactivar el tipo de ingreso"})}})}})}onReactivateIncomeType(r){this.confirmationService.confirm({message:`\xBFEst\xE1 seguro que desea habilitar el tipo de ingreso
                <span class="font-bold"> ${r.name}</span>
                ?`,header:"Confirmar activaci\xF3n",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-success",rejectButtonStyleClass:"p-button-secondary",acceptIcon:"pi pi-check mr-2",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.incomeTypeService.reactivate(r.id).subscribe({next:t=>{this.messageService.add({severity:"success",summary:"Tipo de Ingreso activado",detail:t.message}),this.getIncomeTypes()},error:t=>{t.error?t.status===500?this.messageService.add({severity:"error",summary:"Error",detail:t.error}):this.messageService.add({severity:"error",summary:"Error",detail:t.error.message}):this.messageService.add({severity:"error",summary:"Error",detail:"Error al activar el tipo de ingreso"})}})}})}getNumberWithDigits(r){return r.toFixed(2)}reset(){this.modalData={title:"",visible:!1,data:null,response:null}}};l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=E({type:l,selectors:[["app-income-type"]],viewQuery:function(t,e){if(t&1&&(M(Se,5),M(xe,5)),t&2){let p;V(p=k())&&(e.container=p.first),V(p=k())&&(e.table=p.first)}},standalone:!0,features:[D],decls:7,vars:13,consts:[[1,"block","mt-2",3,"options","onSearch","onOpenForm"],["container",""],["styleClass","p-datatable-sm p-datatable-striped",3,"value","tableStyle","paginator","rows","showJumpToPageDropdown","scrollable","currentPageReportTemplate","scrollHeight","globalFilterFields"],["table",""],["pTemplate","header"],["pTemplate","body"],[3,"modalData","handleClose"],[1,"w-15rem"],[3,"label","styleClass"],[1,"flex","gap-2"],["icon","pi pi-pencil","severity","warning","label","Editar","size","small",3,"rounded","raised","onClick"],["icon","pi pi-trash","severity","danger","label","Inhabilitar","size","small",3,"rounded","raised"],["icon","pi pi-trash","severity","danger","label","Inhabilitar","size","small",3,"rounded","raised","onClick"],["icon","pi pi-undo","severity","help","label","Habilitar","size","small",3,"rounded","raised","onClick"]],template:function(t,e){t&1&&(a(0,"app-container",0,1),g("onSearch",function(_){return e.onSearch(_)})("onOpenForm",function(){return e.onOpenForm()}),a(2,"p-table",2,3),f(4,Ie,13,0,"ng-template",4)(5,Fe,15,9,"ng-template",5),n()(),a(6,"app-income-type-form",6),g("handleClose",function(){return e.onHandleClose()}),n()),t&2&&(m("options",e.containerOptions),s(2),m("value",e.incomeTypes)("tableStyle",O(11,Ne))("paginator",!0)("rows",20)("showJumpToPageDropdown",!0)("scrollable",!0)("currentPageReportTemplate","{currentPage} de {totalPages} p\xE1ginas ({totalRecords} registros)")("scrollHeight","calc(100vh - "+e.toolbarHeight+"px - 18.0rem)")("globalFilterFields",O(12,Me)),s(4),m("modalData",e.modalData))},dependencies:[pe,ae,ne,w,N,F,ce,de,fe]});let i=l;return i})();export{ct as IncomeTypeComponent};
