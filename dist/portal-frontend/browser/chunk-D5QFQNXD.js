import{a as be}from"./chunk-LTNNPEBL.js";import{a as we}from"./chunk-3VKVQU3Q.js";import{a as G,b as M}from"./chunk-B2W5NOZS.js";import{b as ye}from"./chunk-7XV6CRBL.js";import{a as ve,b as ke}from"./chunk-6OSMVD66.js";import"./chunk-L2YMTAJ4.js";import{e as de,f as ce}from"./chunk-SQDM7FYD.js";import{m as _e,n as fe,q as he,r as Ce,x as xe}from"./chunk-OHCSBWXS.js";import"./chunk-APKN3PFA.js";import"./chunk-X6GEXHSG.js";import{a as ue,b as ge}from"./chunk-MX4UQD2B.js";import"./chunk-X5B2VV3T.js";import"./chunk-ZTWDMVRM.js";import"./chunk-XSSXK7EZ.js";import{a as O}from"./chunk-PXO2TRVQ.js";import"./chunk-PWTX4GCB.js";import{b as Z,c as E,e as ee,f as te,i as ie,j as ne,k as re,m as ae,o as oe,p as le,q as se}from"./chunk-HXGQMCX4.js";import{a as Y}from"./chunk-RQIDKQUN.js";import"./chunk-WTM76CTQ.js";import{d as A,e as R}from"./chunk-AXYD25ST.js";import{i as V,n as pe,o as me}from"./chunk-VBSZGXZN.js";import{$ as S,Gb as w,Hb as p,Ib as I,Jb as y,Jc as Q,Nc as X,O as q,Ob as P,Pb as K,Rb as W,S as U,Ta as s,Y as C,Za as $,a as H,ab as D,b as j,da as z,db as u,ea as g,fa as _,fb as m,ib as J,kb as x,mb as N,nb as B,ob as a,pb as l,qb as h,ub as k,wb as f,wc as F,xb as d}from"./chunk-HOTPW52P.js";var Se=(()=>{let n=class n{constructor(){this.END_POINT=Y.API_URL+"/protected/parking-group",this.http=C(X)}findAll(){return this.http.get(this.END_POINT)}};n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=U({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();var T=function(e){return e.AVAILABLE="AVAILABLE",e.OCCUPIED="OCCUPIED",e}(T||{});var Pe=(()=>{let n=class n{constructor(){this.ParkingStatus=T}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=S({type:n,selectors:[["app-parking-overlay-panel-item"]],inputs:{parking:"parking"},standalone:!0,features:[P],decls:4,vars:2,consts:[[1,"border-round","p-1","shadow-2","cursor-pointer",3,"ngClass"],["ngSrc","assets/images/parking.svg","alt","parking-item","width","40","height","40",1,"text-white"],[1,"text-white","text-center","text-xs","font-bold"]],template:function(i,o){i&1&&(a(0,"div",0),h(1,"img",1),a(2,"div",2),p(3),l()()),i&2&&(m("ngClass",o.parking.status===o.ParkingStatus.AVAILABLE?"bg-green-500 hover:bg-green-600":"bg-gray-500 hover:bg-gray-600"),s(3),y(" ",o.parking.code," "))},dependencies:[F,Q]});let e=n;return e})();function Ve(e,n){if(e&1&&(a(0,"div",16)(1,"p",17),p(2,"C\xF3digo de parqueadero"),l(),a(3,"p",18),p(4),l()(),a(5,"div",19)(6,"p",17),p(7,"Estado"),l(),a(8,"p",20),p(9),l()()),e&2){let t=d();s(4),I(t.parking.code),s(4),m("ngClass",t.parking.status===t.ParkingStatus.AVAILABLE?"bg-green-500":"bg-gray-500"),s(),y(" ",t.parking.status===t.ParkingStatus.AVAILABLE?"DISPONIBLE":"OCUPADO"," ")}}function Ae(e,n){if(e&1&&h(0,"app-error-input",6),e&2){let t=d();m("message",t.getErrorMessage("owner",t.parkingForm))}}function Re(e,n){if(e&1&&h(0,"app-error-input",6),e&2){let t=d();m("message",t.getErrorMessage("currentResidence",t.parkingForm))}}function Oe(e,n){if(e&1&&(a(0,"div",21)(1,"p",22),p(2,"Residencia y propietarios nuevos"),l(),a(3,"p",23),p(4),l(),a(5,"p",23),p(6),l()()),e&2){let t=d();s(4),y(" Casa: ",t.selectedResidence.number," "),s(2),y(" Propietario: ",t.selectedResidence.user.surnames+" "+t.selectedResidence.user.names," ")}}function Ge(e,n){e&1&&(a(0,"div",27),h(1,"p-progressSpinner",28),l())}function Me(e,n){e&1&&(a(0,"tr")(1,"th"),p(2,"N\xFAmero de Casa"),l(),a(3,"th"),p(4,"Propietario"),l(),a(5,"th"),p(6,"Pasaje"),l()())}function Ne(e,n){if(e&1&&(a(0,"td"),p(1),l()),e&2){let t=d().$implicit;s(),y(" ",t.user.names+" "+t.user.surnames," ")}}function Be(e,n){e&1&&(a(0,"td",35),p(1,"Sin residente registrado"),l())}function Le(e,n){if(e&1&&(a(0,"tr",33)(1,"td",34),p(2),l(),u(3,Ne,2,1,"td")(4,Be,2,0),a(5,"td"),p(6),l()()),e&2){let t=n.$implicit,r=n.$implicit;m("pSelectableRow",r),s(2),I(t.number),s(),x(3,t.user?3:4),s(3),I((t.passage==null?null:t.passage.name)||"")}}function He(e,n){if(e&1){let t=k();a(0,"div",27)(1,"p-paginator",36),f("onPageChange",function(i){g(t);let o=d(4);return _(o.onPageChange(i))}),l()()}if(e&2){let t=d(4);s(),m("rows",t.rows)("first",t.first)("totalRecords",t.totalItems)("showJumpToPageDropdown",!0)}}function je(e,n){e&1&&(a(0,"div",27)(1,"p",37),p(2,"No hay datos para mostrar"),l()())}function qe(e,n){if(e&1&&u(0,He,2,4,"div",26)(1,je,3,0),e&2){let t=d(3);x(0,t.residences.length>0?0:1)}}var Ue=()=>({"min-width":"30rem"});function ze(e,n){if(e&1){let t=k();a(0,"p-table",29),f("selectionChange",function(i){g(t);let o=d(2);return _(o.selectedResidence=i)})("onRowSelect",function(i){g(t);let o=d(2),c=w(19);return _(o.onRowSelect(i,c))}),u(1,Me,7,0,"ng-template",30)(2,Le,7,4,"ng-template",31)(3,qe,2,1,"ng-template",32),l()}if(e&2){let t=d(2);m("value",t.residences)("tableStyle",K(5,Ue))("scrollable",!0)("scrollHeight","20vh")("selection",t.selectedResidence)}}function $e(e,n){if(e&1){let t=k();a(0,"input",24,25),f("input",function(){g(t);let i=w(1),o=d();return _(o.onSearch(i.value))}),l(),u(2,Ge,2,0,"div",26)(3,ze,4,6)}if(e&2){let t=d();s(2),x(2,t.dataLoading?2:3)}}function Je(e,n){if(e&1){let t=k();a(0,"p-button",38),f("onClick",function(){g(t);let i=d();return _(i.handleAccept())}),l(),a(1,"p-button",39),f("onClick",function(){g(t);let i=d();return _(i.handleClose.emit())}),l()}e&2&&(m("raised",!0)("rounded",!0),s(),m("raised",!0)("rounded",!0))}var Fe=(()=>{let n=class n extends O{constructor(){super(),this.modalData={visible:!1,title:"",data:null,response:null},this.handleClose=new $,this.first=0,this.dataLoading=!0,this.rows=10,this.totalItems=0,this.residences=[],this.selectedResidence=null,this.fb=C(ae),this.messageService=C(V),this.residenceService=C(be),this.parkingForm=this.fb.group({id:["",E.required],code:["",E.required],status:["",E.required],owner:["",E.required],currentResidence:["",E.required],residence:[""]}),this.getErrorMessage=ge,this.ParkingStatus=T}handleAccept(){this.parkingForm.valid?(this.modalData.response=this.parkingForm.value,this.handleClose.emit(),this.selectedResidence=null):Object.values(this.parkingForm.controls).forEach(r=>{r.invalid&&(r.markAsDirty(),r.updateValueAndValidity({onlySelf:!0}))})}getResidences(r=0,i=""){this.residenceService.findAll(r,i).pipe(q(this.destroyed)).subscribe({next:this.handleFindAllNext.bind(this),error:this.handleError.bind(this)})}handleFindAllNext(r){this.dataLoading=!0;let i=r.data;this.residences=i.content,this.totalItems=i.totalItems,setTimeout(()=>{this.dataLoading=!1},1e3)}handleError(r){this.messageService.add({severity:"error",summary:"Error",detail:r.error||r.status===404?"No se encontrado la residencia":"Ha ocurrido un error"}),this.modalData.response=null}onPageChange(r){this.getResidences(r.page),this.first=r.first}onSearch(r){this.getResidences(0,r)}ngOnChanges(r){if(r.modalData&&(this.parkingForm.reset(),this.modalData.data)){this.parking=this.modalData.data;let i=this.parking.residence;this.parkingForm.patchValue(j(H({},r.modalData.currentValue.data),{currentResidence:i?i.number:"Sin casa asignada",owner:i?i.user.names+" "+i.user.surnames:"Sin residente registrado"})),this.getResidences()}}openResidencePanel(r,i){r.show(i)}onRowSelect(r,i){let o=r.data;o.user?(this.parkingForm.patchValue({residence:o}),this.messageService.add({severity:"info",summary:"Informaci\xF3n",detail:"Residencia seleccionada"}),i.hide()):this.messageService.add({severity:"error",summary:"Error",detail:"Residencia seleccionada no v\xE1lida"})}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=S({type:n,selectors:[["app-parking-form"]],inputs:{modalData:"modalData"},outputs:{handleClose:"handleClose"},standalone:!0,features:[D,z,P],decls:22,vars:14,consts:[["styleClass","w-10 md:w-25rem",3,"header","visible","modal","draggable","resizable","visibleChange","onHide"],[1,"pt-4","grid","row-gap-3",3,"formGroup"],[1,"col-12"],[1,"p-float-label"],["pInputText","","id","owner","formControlName","owner","type","text","autocomplete","off",1,"w-full",3,"readOnly"],["for","owner"],[3,"message"],["pInputText","","id","currentResidence","formControlName","currentResidence","type","text","autocomplete","off",1,"w-full",3,"readOnly"],["for","currentResidence"],["class","flex gap-2 flex-column border-1 p-2 w-full"],["label","Cambiar Casa/Propietario","styleClass","w-full",1,"w-full",3,"click"],["btn",""],["styleClass","bg-gray-200 w-11 lg:w-6",3,"showCloseIcon","dismissable"],["op1",""],["pTemplate","content"],["pTemplate","footer"],[1,"col-8"],[1,"text-gray-400","text-sm","mb-2"],[1,"font-bold","text-teal-600"],[1,"col-4"],[1,"text-white","p-1","border-round","text-center","shadow-1",3,"ngClass"],[1,"flex","gap-2","flex-column","border-1","p-2","w-full"],[1,"text-gray-700","text-sm"],[1,"font-bold","text-indigo-600"],["pInputText","","placeholder","Buscar",1,"p-inputtext-sm","mb-2",3,"input"],["search",""],["class","flex justify-content-center"],[1,"flex","justify-content-center"],["styleClass","w-14rem h-14rem","strokeWidth","4","fill","var(--surface-ground)","animationDuration",".5s"],["styleClass","p-datatable-sm p-datatable-striped","selectionMode","single",3,"value","tableStyle","scrollable","scrollHeight","selection","selectionChange","onRowSelect"],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],[3,"pSelectableRow"],[1,"font-bold","text-teal-700"],[1,"text-red-700"],[3,"rows","first","totalRecords","showJumpToPageDropdown","onPageChange"],[1,"text-lg","py-2"],["label","Aceptar","severity","success",3,"raised","rounded","onClick"],["label","Cancelar","severity","danger",3,"raised","rounded","onClick"]],template:function(i,o){if(i&1){let c=k();a(0,"p-dialog",0),f("visibleChange",function(b){return o.modalData.visible=b})("onHide",function(){g(c);let b=w(19);return o.handleClose.emit(),_(b.hide())}),a(1,"form",1),u(2,Ve,10,3),a(3,"div",2)(4,"span",3),h(5,"input",4),a(6,"label",5),p(7,"Propietario"),l()(),u(8,Ae,1,1,"app-error-input",6),l(),a(9,"div",2)(10,"span",3),h(11,"input",7),a(12,"label",8),p(13,"Casa"),l()(),u(14,Re,1,1,"app-error-input",6),l(),u(15,Oe,7,2,"div",9),a(16,"p-button",10,11),f("click",function(b){g(c);let Te=w(19);return _(o.openResidencePanel(Te,b))}),l(),a(18,"p-overlayPanel",12,13),u(20,$e,4,1,"ng-template",14),l()(),u(21,Je,2,4,"ng-template",15),l()}if(i&2){let c,v;m("header",o.modalData.title)("visible",o.modalData.visible)("modal",!0)("draggable",!1)("resizable",!1),s(),m("formGroup",o.parkingForm),s(),x(2,o.parking?2:-1),s(3),m("readOnly",!0),s(3),x(8,(c=o.parkingForm.get("owner"))!=null&&c.invalid&&((c=o.parkingForm.get("owner"))!=null&&c.dirty)?8:-1),s(3),m("readOnly",!0),s(3),x(14,(v=o.parkingForm.get("currentResidence"))!=null&&v.invalid&&((v=o.parkingForm.get("currentResidence"))!=null&&v.dirty)?14:-1),s(),x(15,o.selectedResidence&&o.selectedResidence.user?15:-1),s(3),m("showCloseIcon",!0)("dismissable",!1)}},dependencies:[R,A,pe,ce,de,ue,se,le,oe,ie,Z,ee,te,ne,re,me,M,G,fe,_e,ke,ve,xe,he,Ce,F]});let e=n;return e})();var Ee=(e,n)=>n.id,Ke=(e,n)=>({position:"absolute",top:e,left:n});function We(e,n){if(e&1){let t=k();a(0,"p-button",6),f("click",function(i){let c=g(t).$implicit,v=d(),b=w(5);return _(v.toggleOverlayPanel(b,i,c))}),l()}if(e&2){let t=n.$implicit;J(W(5,Ke,t.y,t.x)),m("raised",!0)("rounded",!0)("severity",t.type.severity)}}function Qe(e,n){if(e&1){let t=k();a(0,"app-parking-overlay-panel-item",16),f("click",function(){let o=g(t).$implicit,c=d(2);return _(c.openForm(o))}),l()}if(e&2){let t=n.$implicit;m("parking",t)}}function Xe(e,n){if(e&1&&(a(0,"div",7)(1,"div",8)(2,"div",9),p(3," Grupo: "),a(4,"span",10),p(5),l()(),a(6,"div",11),h(7,"div",12),a(8,"span",13),p(9,"Disponibles"),l(),h(10,"div",14),a(11,"span"),p(12,"Ocupados"),l()()(),a(13,"div",15),N(14,Qe,1,1,"app-parking-overlay-panel-item",17,Ee),l()()),e&2){let t=d();s(4),m("ngClass",t.selectedParkingGroup.type.severity==="info"?"text-cyan-600":"text-orange-600"),s(),y(" ",t.selectedParkingGroup.code," "),s(9),B(t.parkings)}}var Wt=(()=>{let n=class n extends O{constructor(){super(),this.parkingGroups=[],this.parkings=[],this.selectedParkingGroup=null,this.modalData={visible:!1,title:"",data:null,response:null},this.parkingGroupService=C(Se),this.parkingService=C(we),this.messageService=C(V)}ngOnInit(){super.ngOnInit(),this.getAllParkingGroups()}getAllParkingGroups(){this.parkingGroupService.findAll().subscribe({next:r=>{this.parkingGroups=r.data},error:r=>{this.messageService.add({severity:"error",summary:"Error",detail:"Ha ocurrido un error"})}})}toggleOverlayPanel(r,i,o){this.selectedParkingGroup=o,r.overlayVisible?(r.show(i,i.target),r.align()):r.show(i,i.target),this.selectedParkingGroup&&this.getParkingsByGroup(this.selectedParkingGroup.id)}getParkingsByGroup(r){this.parkingService.findAllByGroup(r).subscribe({next:i=>{this.parkings=i.data},error:i=>{this.messageService.add({severity:"error",summary:"Error",detail:"Ha ocurrido un error"})}})}getHandleClose(){if(this.modalData.response){let r=this.modalData.response.id,i={residence:this.modalData.response.residence.id};this.parkingService.update(r,i).subscribe({next:o=>{this.messageService.add({severity:"success",summary:"\xC9xito",detail:o.message}),this.getAllParkingGroups(),this.getParkingsByGroup(this.selectedParkingGroup.id),this.reset()},error:o=>{this.messageService.add({severity:"error",summary:"Error",detail:"Ha ocurrido un error"})}})}else this.reset()}openForm(r){this.modalData={visible:!0,title:"Administrar parqueadero",data:r,response:null}}reset(){this.modalData={visible:!1,title:"",data:null,response:null}}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=S({type:n,selectors:[["app-admin-parking"]],standalone:!0,features:[D,P],decls:8,vars:4,consts:[[1,"w-full","h-full","overflow-auto","overflow-auto"],[1,"parking-background","w-full","relative","m-auto"],["appendTo","body","styleClass","bg-indigo-50 shadow-5 max-w-20rem md:max-w-29rem",3,"dismissable","showCloseIcon"],["op",""],["class","flex flex-column "],[3,"modalData","handleClose"],["icon","pi pi-car","styleClass","p-button-lg",3,"raised","rounded","severity","click"],[1,"flex","flex-column"],[1,"p-2","flex","justify-content-between","flex-column","md:flex-row","gap-1"],[1,"ml-1"],[1,"font-bold",3,"ngClass"],[1,"flex","align-items-center","gap-1"],[1,"w-1rem","h-1rem","border-circle","bg-green-500"],[1,"mr-1"],[1,"w-1rem","h-1rem","border-circle","bg-gray-500"],[1,"flex","gap-1","flex-wrap","justify-content-center"],[3,"parking","click"],[3,"parking"],["icon","pi pi-car","styleClass","p-button-lg",3,"raised","rounded","severity","style"]],template:function(i,o){i&1&&(a(0,"div",0)(1,"div",1),N(2,We,1,8,"p-button",18,Ee),a(4,"p-overlayPanel",2,3),u(6,Xe,16,2,"div",4),l()()(),a(7,"app-parking-form",5),f("handleClose",function(){return o.getHandleClose()}),l()),i&2&&(s(2),B(o.parkingGroups),s(2),m("dismissable",!1)("showCloseIcon",!0),s(2),x(6,o.selectedParkingGroup?6:-1),s(),m("modalData",o.modalData))},dependencies:[ye,R,A,M,G,F,Pe,Fe],styles:['.parking-background[_ngcontent-%COMP%]{background-image:url("./media/portal_parking-2OOSKJ7D.svg");min-width:70rem;max-width:70rem;height:50rem;background-size:contain;background-repeat:no-repeat;background-position:top center}']});let e=n;return e})();export{Wt as AdminParkingComponent};
