import{a as ce}from"./chunk-JDRUBIL5.js";import{a as Ae}from"./chunk-X3UOWKQ6.js";import{a as pe}from"./chunk-PZI4WV4M.js";import{a as de}from"./chunk-DZYMMIQY.js";import{a as ke,b as Ne}from"./chunk-X2N4LBF3.js";import{a as W,b as K}from"./chunk-B2W5NOZS.js";import{a as ae}from"./chunk-WYL7NH4F.js";import{f as Re,g as Pe,n as Me}from"./chunk-U446ZUSE.js";import{a as se,b as me}from"./chunk-7XV6CRBL.js";import{a as De,b as Ve}from"./chunk-LFBU7IBC.js";import{a as re,b as le}from"./chunk-6OSMVD66.js";import"./chunk-IAKHD2KQ.js";import"./chunk-KTZAFNHT.js";import"./chunk-L2YMTAJ4.js";import{e as J,f as Q}from"./chunk-SQDM7FYD.js";import"./chunk-MUUDK5FO.js";import"./chunk-GS33KFGJ.js";import{h as X,i as Ie,k as Y,l as Z,m as ee,n as te,q as ie,r as ne,x as oe}from"./chunk-OHCSBWXS.js";import"./chunk-APKN3PFA.js";import"./chunk-X6GEXHSG.js";import{a as Te,b as Ee}from"./chunk-MX4UQD2B.js";import"./chunk-X5B2VV3T.js";import"./chunk-ZTWDMVRM.js";import"./chunk-P7FDEGEE.js";import"./chunk-XSSXK7EZ.js";import{b as Fe}from"./chunk-PWTX4GCB.js";import{b as M,c as E,e as k,f as N,i as A,j as B,k as O,l as U,o as L,p as H,q as j}from"./chunk-HXGQMCX4.js";import"./chunk-TDXTCVPJ.js";import"./chunk-WTM76CTQ.js";import{d as q,e as G}from"./chunk-AXYD25ST.js";import{e as Se,i as $,n as z}from"./chunk-VBSZGXZN.js";import{$ as R,Bc as we,Db as he,Eb as ve,Fb as xe,Gb as T,Hb as p,Ib as S,Jb as I,Ob as P,Pb as F,Ta as l,Wa as fe,Y as y,Yb as ye,Za as Ce,_b as be,a as ue,b as _e,da as ge,db as f,ea as _,fa as g,fb as m,kb as x,ob as a,pb as r,qb as v,ub as b,wb as u,xb as d}from"./chunk-HOTPW52P.js";function Xe(t,s){if(t&1&&v(0,"app-error-input",8),t&2){let e=d();m("message",e.getErrorMessage("residence",e.form))}}function Ye(t,s){if(t&1&&v(0,"app-error-input",8),t&2){let e=d();m("message",e.getErrorMessage("description",e.form))}}function Ze(t,s){if(t&1&&v(0,"app-error-input",8),t&2){let e=d();m("message",e.getErrorMessage("incomeType",e.form))}}function et(t,s){if(t&1&&v(0,"app-error-input",8),t&2){let e=d();m("message",e.getErrorMessage("paidDate",e.form))}}function tt(t,s){if(t&1&&v(0,"app-error-input",8),t&2){let e=d();m("message",e.getErrorMessage("paidEvidence",e.form))}}function it(t,s){if(t&1&&(a(0,"div",17),v(1,"p-image",34),r()),t&2){let e=d();l(),m("src",e.modalData.data.paidEvidence.fileUrl||"assets/images/No_image_available.svg")("preview",!!e.modalData.data.paidEvidence.fileUrl)}}function nt(t,s){t&1&&(a(0,"div",38),v(1,"p-progressSpinner",39),r())}function ot(t,s){t&1&&(a(0,"tr")(1,"th"),p(2,"N\xFAmero de Casa"),r(),a(3,"th"),p(4,"Propietario"),r(),a(5,"th"),p(6,"Pasaje"),r()())}function at(t,s){if(t&1&&(a(0,"td"),p(1),r()),t&2){let e=d().$implicit;l(),I(" ",e.user.names+" "+e.user.surnames," ")}}function rt(t,s){t&1&&(a(0,"td",46),p(1,"Sin residente registrado"),r())}function lt(t,s){if(t&1&&(a(0,"tr",44)(1,"td",45),p(2),r(),f(3,at,2,1,"td")(4,rt,2,0),a(5,"td"),p(6),r()()),t&2){let e=s.$implicit,n=s.$implicit;m("pSelectableRow",n),l(2),S(e.number),l(),x(3,e.user?3:4),l(3),S((e.passage==null?null:e.passage.name)||"")}}function st(t,s){if(t&1){let e=b();a(0,"div",38)(1,"p-paginator",47),u("onPageChange",function(o){_(e);let i=d(4);return g(i.onPageChange(o))}),r()()}if(t&2){let e=d(4);l(),m("rows",e.rows)("first",e.first)("totalRecords",e.totalItems)("showJumpToPageDropdown",!0)}}function mt(t,s){t&1&&(a(0,"div",38)(1,"p",48),p(2,"No hay datos para mostrar"),r()())}function dt(t,s){if(t&1&&f(0,st,2,4,"div",37)(1,mt,3,0),t&2){let e=d(3);x(0,e.residences.length>0?0:1)}}var pt=()=>({"min-width":"30rem"});function ct(t,s){if(t&1){let e=b();a(0,"p-table",40),u("selectionChange",function(o){_(e);let i=d(2);return g(i.selectedResidence=o)})("onRowSelect",function(o){_(e);let i=d(2),C=T(47);return g(i.onRowSelect(o,C))})("onRowUnselect",function(){_(e);let o=d(2),i;return o.selectedResidence=null,(i=o.form.get("residence"))==null||i.setValue(""),g((i=o.form.get("residenceToShow"))==null?null:i.setValue(""))}),f(1,ot,7,0,"ng-template",41)(2,lt,7,4,"ng-template",42)(3,dt,2,1,"ng-template",43),r()}if(t&2){let e=d(2);m("value",e.residences)("tableStyle",F(5,pt))("scrollable",!0)("scrollHeight","20vh")("selection",e.selectedResidence)}}function ut(t,s){if(t&1){let e=b();a(0,"input",35,36),u("input",function(){_(e);let o=T(1),i=d();return g(i.onSearch(o.value))}),r(),f(2,nt,2,0,"div",37)(3,ct,4,6)}if(t&2){let e=d();l(2),x(2,e.dataLoading?2:3)}}function _t(t,s){if(t&1){let e=b();a(0,"p-button",49),u("onClick",function(){_(e);let o=d();return g(o.handleAccept())}),r(),a(1,"p-button",50),u("onClick",function(){_(e);let o=d();return o.modalData.response=null,g(o.handleClose.emit())}),r()}t&2&&(m("raised",!0)("rounded",!0),l(),m("raised",!0)("rounded",!0))}var Be=(()=>{let s=class s{constructor(){this.getErrorMessage=Ee,this.messageService=y($),this.fb=y(U),this.incomeTypeSerive=y(pe),this.residenceService=y(de),this.incomeService=y(ce),this.modalData={title:"",data:null,visible:!1,response:null},this.handleClose=new Ce,this.form=this.fb.group({id:[null],description:["",E.required],amount:[0,E.required],paidDate:["",E.required],residenceToShow:["",E.required],residence:["",E.required],incomeType:[void 0,E.required],paidEvidence:[null,E.required]}),this.selectedFile=null,this.incomeTypes=[],this.first=0,this.dataLoading=!0,this.rows=10,this.totalItems=0,this.residences=[],this.selectedResidence=null}getIncomeTypes(){this.incomeTypeSerive.findAllActiveByPeriod(ae.CASUAL).subscribe({next:n=>{this.incomeTypes=n.data},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Error al obtener los tipos de ingreso"})}})}ngOnChanges(n){if(n.modalData&&(this.getIncomeTypes(),this.getResidences(),this.form.reset(),this.modalData.data)){let o=this.modalData.data.residence.user;this.form.patchValue(_e(ue({},this.modalData.data),{paidDate:new Date(this.modalData.data.paidDate),paidSince:new Date(this.modalData.data.paidSince),paidUntil:new Date(this.modalData.data.paidUntil),residenceToShow:this.modalData.data.residence.number+(o!==null?" - "+o.names+" "+o.surnames:" - Sin residente registrado"),residence:this.modalData.data.residence,incomeType:this.modalData.data.type,monthlyAmount:this.modalData.data.type.price})),this.selectedResidence=this.modalData.data.residence,this.form.get("paidEvidence")?.clearValidators(),this.form.get("paidEvidence")?.updateValueAndValidity(),this.calculateAmount()}}handleAccept(){this.form.get("paidEvidence")?.setValue(this.selectedFile),this.form.valid?(this.modalData.response=this.form.value,this.handleClose.emit()):Object.values(this.form.controls).forEach(n=>{n.invalid&&n.markAsDirty()})}handleIncomeType(n){this.calculateAmount()}calculateAmount(){if(this.form.get("incomeType")?.value){let n=this.form.get("incomeType")?.value;n&&this.form.get("amount")?.setValue(n.price)}}setImage(n){let o=n.files[0];o?this.selectedFile=o:this.selectedFile=null}getResidences(n=0,o=""){this.residenceService.findAll(n,o).subscribe({next:this.handleFindAllNext.bind(this),error:this.handleError.bind(this)})}handleFindAllNext(n){this.dataLoading=!0;let o=n.data;this.residences=o.content,this.totalItems=o.totalItems,setTimeout(()=>{this.dataLoading=!1},300)}handleError(n){this.messageService.add({severity:"error",summary:"Error",detail:n.error||n.status===404?"No se encontrado la residencia":"Ha ocurrido un error"}),this.modalData.response=null}onPageChange(n){this.getResidences(n.page),this.first=n.first}onSearch(n){this.first=0,this.getResidences(0,n)}openResidencePanel(n,o){n.show(o)}onRowSelect(n,o){let i=n.data;this.form.patchValue({residence:i});let C=i.user;this.form.patchValue({residenceToShow:i.number+(C!==null?" - "+C.names+" "+C.surnames:" - Sin residente registrado")}),this.messageService.add({severity:"info",summary:"Informaci\xF3n",detail:"Residencia seleccionada"}),o.hide()}};s.\u0275fac=function(o){return new(o||s)},s.\u0275cmp=R({type:s,selectors:[["app-income-casual-form"]],inputs:{modalData:"modalData"},outputs:{handleClose:"handleClose"},standalone:!0,features:[ge,P],decls:50,vars:24,consts:[["id","dialog","styleClass","w-11 md:w-8 lg:w-8",3,"header","visible","modal","draggable","resizable","visibleChange","onHide"],[1,"pt-4","grid","row-gap-3","h-full","nested-grid",3,"formGroup"],[1,"col-6","lg:col-3"],["icon","pi pi-home","severity","secondary","size","small","label","Seleccionar Residencia","styleClass","w-full",3,"raised","rounded","click"],[1,"col-6","lg:col-4"],[1,"p-float-label"],["pInputText","","formControlName","residenceToShow","type","text",1,"w-full",3,"readOnly"],["for","residenceToShow"],[3,"message"],[1,"col-6","lg:col-5"],[1,"flex","align-items-baseline","gap-4","w-full","justify-content-end","h-full"],[1,"font-bold","uppercase","text-xl","vertical-align-middle","white-space-nowrap"],[1,"text-indigo-600"],[1,"font-bold","text-2xl"],[1,"col-12","lg:col-8"],["pInputTextarea","","formControlName","description","id","description",1,"w-full",3,"rows"],["for","description"],[1,"col-12","lg:col-4"],[1,"flex","flex-column","gap-5"],[1,"relative","w-full"],["for","severity",1,"text-xs","text-gray-500","block","ml-2","absolute","left-0",2,"top","-1.2rem"],["formControlName","incomeType","optionLabel","name","appendTo","body","placeholder","Seleccione un tipo","styleClass","w-full",1,"w-full",3,"options","onChange"],[1,"w-full"],["appendTo","body","formControlName","paidDate","dateFormat","dd/mm/yy","styleClass","w-full",3,"showButtonBar"],["for","date"],[1,"col-12","py-0","my-0"],[1,"text-center","text-gray-500","mb-2","text-white","bg-yellow-800","py-1","border-round-xl"],["mode","advanced","chooseLabel","Seleccione una imagen","accept","image/*","chooseStyleClass","p-button-raised p-button-secondary w-full","removeStyleClass","p-button-raised p-button-danger p-button-rounded",3,"maxFileSize","showUploadButton","showCancelButton","onSelect","onRemove","onClear"],["fu",""],["class","col-12 lg:col-4"],["styleClass","bg-gray-200 w-11 lg:w-6",3,"showCloseIcon","dismissable"],["op1",""],["pTemplate","content"],["pTemplate","footer"],["styleClass","flex justify-content-center shadow-3","appendTo","body","imageClass","w-full h-17rem max-h-17rem border-round",3,"src","preview"],["pInputText","","placeholder","Buscar",1,"p-inputtext-sm","mb-2",3,"input"],["search",""],["class","flex justify-content-center"],[1,"flex","justify-content-center"],["styleClass","w-14rem h-14rem","strokeWidth","4","fill","var(--surface-ground)","animationDuration",".5s"],["styleClass","p-datatable-sm p-datatable-striped","selectionMode","single",3,"value","tableStyle","scrollable","scrollHeight","selection","selectionChange","onRowSelect","onRowUnselect"],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],[3,"pSelectableRow"],[1,"font-bold","text-teal-700"],[1,"text-red-700"],[3,"rows","first","totalRecords","showJumpToPageDropdown","onPageChange"],[1,"text-lg","py-2"],["label","Aceptar","severity","success",3,"raised","rounded","onClick"],["label","Cancelar","severity","danger",3,"raised","rounded","onClick"]],template:function(o,i){if(o&1){let C=b();a(0,"p-dialog",0),u("visibleChange",function(c){return i.modalData.visible=c})("onHide",function(){_(C);let c=T(43);return i.modalData.response=null,i.handleClose.emit(),g(c.clear())}),a(1,"form",1)(2,"div",2)(3,"p-button",3),u("click",function(c){_(C);let w=T(47);return g(i.openResidencePanel(w,c))}),r()(),a(4,"div",4)(5,"span",5),v(6,"input",6),a(7,"label",7),p(8,"Residencia"),r()(),f(9,Xe,1,1,"app-error-input",8),r(),a(10,"div",9)(11,"div",10)(12,"label",11),p(13,"Monto Total:"),r(),a(14,"p",12)(15,"span",13),p(16,"$"),r(),a(17,"span",13),p(18),r()()()(),a(19,"div",14)(20,"span",5),v(21,"textarea",15),a(22,"label",16),p(23,"Descripci\xF3n"),r()(),f(24,Ye,1,1,"app-error-input",8),r(),a(25,"div",17)(26,"div",18)(27,"div",19)(28,"label",20),p(29,"Tipo de ingreso casual"),r(),a(30,"p-dropdown",21),u("onChange",function(c){return i.handleIncomeType(c.value)}),r(),f(31,Ze,1,1,"app-error-input",8),r(),a(32,"div",22)(33,"span",5),v(34,"p-calendar",23),a(35,"label",24),p(36,"Fecha del pago"),r()(),f(37,et,1,1,"app-error-input",8),r()()(),a(38,"div",25)(39,"p",26),p(40," Comprobante de pago "),r()(),a(41,"div",14)(42,"p-fileUpload",27,28),u("onSelect",function(c){return i.setImage(c)})("onRemove",function(){return i.selectedFile=null})("onClear",function(){let c;return(c=i.form.get("paidEvidence"))==null||c.setValue(null),i.selectedFile=null}),r(),f(44,tt,1,1,"app-error-input",8),r(),f(45,it,2,2,"div",29),a(46,"p-overlayPanel",30,31),f(48,ut,4,1,"ng-template",32),r()(),f(49,_t,2,4,"ng-template",33),r()}if(o&2){let C,h,c,w,D,V;m("header",i.modalData.title)("visible",i.modalData.visible)("modal",!0)("draggable",!1)("resizable",!1),l(),m("formGroup",i.form),l(2),m("raised",!0)("rounded",!0),l(3),m("readOnly",!0),l(3),x(9,(C=i.form.get("residence"))!=null&&C.dirty&&((C=i.form.get("residence"))!=null&&C.invalid)?9:-1),l(9),S((h=i.form.get("amount"))==null?null:h.value),l(3),m("rows",5),l(3),x(24,(c=i.form.get("description"))!=null&&c.dirty&&((c=i.form.get("description"))!=null&&c.invalid)?24:-1),l(6),m("options",i.incomeTypes),l(),x(31,(w=i.form.get("incomeType"))!=null&&w.dirty&&((w=i.form.get("incomeType"))!=null&&w.invalid)?31:-1),l(3),m("showButtonBar",!0),l(3),x(37,(D=i.form.get("paidDate"))!=null&&D.dirty&&((D=i.form.get("paidDate"))!=null&&D.invalid)?37:-1),l(5),m("maxFileSize",5e6)("showUploadButton",!1)("showCancelButton",!1),l(2),x(44,(V=i.form.get("paidEvidence"))!=null&&V.dirty&&((V=i.form.get("paidEvidence"))!=null&&V.invalid)?44:-1),l(),x(45,i.modalData.data?45:-1),l(),m("showCloseIcon",!0)("dismissable",!1)}},dependencies:[L,A,M,k,N,B,O,G,q,z,j,H,Ve,De,Fe,Z,Y,Pe,Re,Te,Q,J,Ie,X,oe,ie,ne,K,W,te,ee,le,re,me,se]});let t=s;return t})();var gt=["container"];function ft(t,s){t&1&&v(0,"p-calendar",33)}function Ct(t,s){t&1&&(a(0,"div",37),v(1,"p-progressSpinner",38),r())}function ht(t,s){t&1&&(a(0,"tr")(1,"th"),p(2,"N\xFAmero de Casa"),r(),a(3,"th"),p(4,"Propietario"),r(),a(5,"th"),p(6,"Pasaje"),r()())}function vt(t,s){if(t&1&&(a(0,"td"),p(1),r()),t&2){let e=d().$implicit;l(),I(" ",e.user.names+" "+e.user.surnames," ")}}function xt(t,s){t&1&&(a(0,"td",42),p(1,"Sin residente registrado"),r())}function yt(t,s){if(t&1&&(a(0,"tr",40)(1,"td",41),p(2),r(),f(3,vt,2,1,"td")(4,xt,2,0),a(5,"td"),p(6),r()()),t&2){let e=s.$implicit,n=s.$implicit;m("pSelectableRow",n),l(2),I(" ",e.number," "),l(),x(3,e.user?3:4),l(3),S((e.passage==null?null:e.passage.name)||"")}}function bt(t,s){if(t&1){let e=b();a(0,"div",37)(1,"p-paginator",43),u("onPageChange",function(o){_(e);let i=d(4);return g(i.onPageChangeResidence(o))}),r()()}if(t&2){let e=d(4);l(),m("rows",e.rowsResidence)("first",e.firstResidence)("totalRecords",e.totalItemsResidence)("showJumpToPageDropdown",!0)}}function wt(t,s){t&1&&(a(0,"div",37)(1,"p",44),p(2,"No hay datos para mostrar"),r()())}function St(t,s){if(t&1&&f(0,bt,2,4,"div",36)(1,wt,3,0),t&2){let e=d(3);x(0,e.residences.length>0?0:1)}}var Tt=()=>({"min-width":"30rem"});function Et(t,s){if(t&1){let e=b();a(0,"p-table",39),u("selectionChange",function(o){_(e);let i=d(2);return g(i.selectedResidence=o)})("onRowSelect",function(o){_(e);let i=d(2),C=T(21);return g(i.onRowSelectResidence(o,C))})("onRowUnselect",function(){_(e);let o=d(2),i;return o.selectedResidence=null,(i=o.filterForm.get("residence"))==null||i.setValue(void 0),g((i=o.filterForm.get("residenceToShow"))==null?null:i.setValue(""))}),f(1,ht,7,0,"ng-template",25)(2,yt,7,4,"ng-template",26)(3,St,2,1,"ng-template",27),r()}if(t&2){let e=d(2);m("value",e.residences)("tableStyle",F(5,Tt))("scrollable",!0)("scrollHeight","20vh")("selection",e.selectedResidence)}}function It(t,s){if(t&1){let e=b();a(0,"input",34,35),u("input",function(){_(e);let o=T(1),i=d();return g(i.onSearchResidence(o.value))}),r(),f(2,Ct,2,0,"div",36)(3,Et,4,6)}if(t&2){let e=d();l(2),x(2,e.dataLoading?2:3)}}function Ft(t,s){t&1&&(a(0,"tr")(1,"th"),p(2,"C\xF3digo"),r(),a(3,"th"),p(4,"Casa"),r(),a(5,"th"),p(6,"Tipo de pago"),r(),a(7,"th"),p(8,"Descripcion"),r(),a(9,"th"),p(10,"Monto"),r(),a(11,"th"),p(12,"Fecha de pago"),r(),a(13,"th"),p(14,"Comprobante de pago"),r(),a(15,"th",45),p(16,"Acciones"),r()())}function Dt(t,s){if(t&1){let e=b();a(0,"tr")(1,"td",46),p(2),r(),a(3,"td",47),p(4),r(),a(5,"td"),p(6),r(),a(7,"td")(8,"p-button",48),u("click",function(){_(e);let o=d().$implicit,i=d();return g(i.onShowDialogPanel(o.description))}),r()(),a(9,"td"),p(10),r(),a(11,"td"),p(12),ye(13,"date"),r(),a(14,"td"),v(15,"p-image",49),r(),a(16,"td")(17,"div",50)(18,"p-button",51),u("click",function(){_(e);let o=d().$implicit,i=d();return g(i.onViewReceipt(o))}),r(),a(19,"p-button",52),u("click",function(){_(e);let o=d().$implicit,i=d();return g(i.onOpenForm(o))}),r(),a(20,"p-button",53),u("click",function(){_(e);let o=d().$implicit,i=d();return g(i.onDeleteIncome(o))}),r()()()()}if(t&2){let e=d().$implicit,n=d();l(2),S(e.code),l(2),I(" ",e.residence.number," "),l(2),S(e.type.name),l(2),m("rounded",!0)("text",!0)("raised",!0),l(2),S("$ "+n.getNumberWithDigits(e.amount)),l(2),S(be(13,16,e.paidDate,"dd/MM/yyyy")),l(3),m("src",e.paidEvidence!=null?e.paidEvidence.fileUrl:"assets/images/No_image_available.svg")("preview",!!(e.paidEvidence!=null&&e.paidEvidence.fileUrl)),l(3),m("rounded",!0)("raised",!0),l(),m("rounded",!0)("raised",!0),l(),m("rounded",!0)("raised",!0)}}function Vt(t,s){if(t&1&&f(0,Dt,21,19,"tr"),t&2){let e=s.$implicit;x(0,e.canBeDeleted?0:-1)}}function Rt(t,s){if(t&1){let e=b();a(0,"div",37)(1,"p-paginator",54),u("onPageChange",function(o){_(e);let i=d(2);return g(i.onPageChange(o))}),r()()}if(t&2){let e=d(2);l(),m("rows",e.rows)("first",e.first)("totalRecords",e.totalItems)("showJumpToPageDropdown",!0)("currentPageReportTemplate","{currentPage} de {totalPages} p\xE1ginas ({totalRecords} registros)")}}function Pt(t,s){t&1&&(a(0,"div",37)(1,"p",55),p(2,"No hay datos para mostrar"),r()())}function Mt(t,s){if(t&1&&f(0,Rt,2,5,"div",36)(1,Pt,3,0),t&2){let e=d();x(0,e.incomes.length>0?0:1)}}function kt(t,s){if(t&1){let e=b();a(0,"div",56)(1,"h2",57),p(2),r(),a(3,"p",58),p(4),r(),a(5,"div",59)(6,"p-button",60),u("onClick",function(){_(e);let o=d();return g(o.dialogVisible=!1)}),r()()()}if(t&2){let e=d();l(2),S(e.dialogTitle),l(2),I(" ",e.dialogContent," "),l(2),m("raised",!0)("rounded",!0)}}var Nt=()=>({"min-width":"50rem"}),Ni=(()=>{let s=class s{constructor(){this.incomeService=y(ce),this.cdr=y(fe),this.messageService=y($),this.confirmationService=y(Se),this.fb=y(U),this.residenceService=y(de),this.incomeTypeSerive=y(pe),this.first=0,this.totalItems=0,this.rows=20,this.modalData={title:"",visible:!1,data:null,response:null},this.toolbarHeight=0,this.containerOptions={dataLoading:!0,showNewButton:!0,showSearch:!1},this.incomes=[],this.incomeTypes=[],this.filterForm=this.fb.group({residence:[void 0],residenceToShow:[""],start:[void 0],end:[void 0],type:[void 0]}),this.showInterval=!1,this.firstResidence=0,this.dataLoading=!0,this.rowsResidence=10,this.totalItemsResidence=0,this.residences=[],this.selectedResidence=null,this.recipeViewData={income:null,penalty:null,visible:!1},this.dialogContent="",this.dialogVisible=!1,this.dialogTitle=""}ngOnInit(){this.getIncomes()}ngAfterViewInit(){this.toolbarHeight=this.container.toolbar.getBlockableElement().clientHeight,this.cdr.detectChanges()}getIncomes(n,o,i,C,h){this.containerOptions.dataLoading=!0,this.incomeService.findAllCasual(n,o,i,C,h).subscribe({next:c=>{let w=c.data;this.incomes=w.content,this.totalItems=w.totalItems,setTimeout(()=>{this.containerOptions.dataLoading=!1},300)},error:c=>{this.messageService.add({severity:"error",summary:"Error",detail:"Ocurri\xF3 un error al obtener los ingresos."})}})}getIncomeTypes(){this.incomeTypeSerive.findAllActiveByPeriod(ae.CASUAL).subscribe({next:n=>{this.incomeTypes=n.data},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Error al obtener los tipos de ingreso"})}})}openResidencePanel(n,o){n.show(o)}onRowSelectResidence(n,o){let i=n.data;this.filterForm.patchValue({residence:i}),this.filterForm.patchValue({residenceToShow:i.number}),o.hide()}onPageChangeResidence(n){this.getResidences(n.page),this.firstResidence=n.first}onSearchResidence(n){this.firstResidence=0,this.getResidences(0,n)}getResidences(n=0,o=""){this.residenceService.findAll(n,o).subscribe({next:this.handleFindAllNext.bind(this),error:this.handleError.bind(this)})}handleFindAllNext(n){this.dataLoading=!0;let o=n.data;this.residences=o.content,this.totalItemsResidence=o.totalItems,setTimeout(()=>{this.dataLoading=!1},300)}handleError(n){this.messageService.add({severity:"error",summary:"Error",detail:n.error||n.status===404?"No se encontrado la residencia":"Ha ocurrido un error"})}onFilter(){this.first=0,this.filterForm.value,this.getIncomes(this.filterForm.value.type?.id||void 0,this.filterForm.value.start?.getTime()||void 0,this.filterForm.value.end?.getTime()||void 0,this.filterForm.value.residence?.id||void 0,0)}onClearFilter(){this.filterForm.reset()}onShowDialogPanel(n){this.dialogContent=n,this.dialogVisible=!0,this.dialogTitle="Descripci\xF3n"}onOpenForm(n){this.modalData={title:n?"Editar ingreso casual":"Nuevo ingreso casual",visible:!0,data:n,response:null}}getNumberWithDigits(n){return n.toFixed(2)}onHandleClose(){if(this.modalData.response){let n=this.modalData.response.id;if(n){let o={description:this.modalData.response.description,amount:this.modalData.response.amount,paidDate:this.modalData.response.paidDate.getTime(),residence:this.modalData.response.residence.id,incomeType:this.modalData.response.incomeType.id,paidEvidence:this.modalData.response.paidEvidence};this.incomeService.updateIncomeCasual(n,o).subscribe({next:i=>{this.messageService.add({severity:"success",summary:"\xC9xito",detail:i.message}),this.getIncomes(),this.reset()},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Ocurri\xF3 un error al actualizar el ingreso."})}})}else{let o={description:this.modalData.response.description,amount:this.modalData.response.amount,paidDate:this.modalData.response.paidDate.getTime(),residence:this.modalData.response.residence.id,incomeType:this.modalData.response.incomeType.id,paidEvidence:this.modalData.response.paidEvidence};this.incomeService.createIncomeCasual(o).subscribe({next:i=>{this.messageService.add({severity:"success",summary:"\xC9xito",detail:i.message}),this.getIncomes(),this.reset()},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Ocurri\xF3 un error al crear el ingreso."})}})}}else this.reset()}onViewReceipt(n){this.recipeViewData={income:n,penalty:null,visible:!0}}onDeleteIncome(n){this.confirmationService.confirm({message:`\xBFEst\xE1s seguro de que quieres eliminar el ingreso casual <span class="font-bold text-green-600">${n.code}</span>?
      <br>
      <p class="mt-2"><span class="font-bold">Casa: </span> ${n.residence.number}</p>
      <p class="mt-2"><span class="font-bold">Tipo: </span> ${n.type.name}</p>
      <p class="mt-2"><span class="font-bold">Descripcion: </span> ${n.description}</p>
      <p class="font-bold text-red-600 mt-4">Esta acci\xF3n no se puede deshacer.</p>
`,header:"Confirmar eliminaci\xF3n del ingreso casual",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",acceptIcon:"pi pi-trash mr-2",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.incomeService.deleteIncome(n.id).subscribe({next:o=>{this.messageService.add({severity:"success",summary:"\xC9xito",detail:o.message}),this.getIncomes()},error:o=>{this.messageService.add({severity:"error",summary:"Error",detail:"Ocurri\xF3 un error al eliminar el ingreso."})}})}})}onPageChange(n){this.first=n.first,this.getIncomes(this.filterForm.value.type?.id||void 0,this.filterForm.value.start?.getTime()||void 0,this.filterForm.value.end?.getTime()||void 0,this.filterForm.value.residence?.id||void 0,n.page)}reset(){this.modalData={title:"",visible:!1,data:null,response:null}}};s.\u0275fac=function(o){return new(o||s)},s.\u0275cmp=R({type:s,selectors:[["app-casual"]],viewQuery:function(o,i){if(o&1&&he(gt,5),o&2){let C;ve(C=xe())&&(i.container=C.first)}},standalone:!0,features:[P],decls:33,vars:29,consts:[[1,"block","mt-2",3,"options","onOpenForm"],["container",""],["customSearcher",""],["icon","pi pi-angle-down","label","Abrir filtros","styleClass","bg-white hover:bg-gray-200",3,"rounded","raised","text","click"],["filterButton",""],["styleClass","bg-gray-700 w-11 lg:w-30rem",3,"showCloseIcon","dismissable"],["op",""],[3,"formGroup"],[1,"flex","flex-column","gap-1"],[1,"flex","gap-1","w-full"],["styleClass","p-inputtext-sm w-full","formControlName","start","dateFormat","dd/mm/yy","appendTo","body",1,"w-full",3,"placeholder"],["styleClass","p-inputtext-sm w-full","class","w-full","placeholder","Fecha pago (Fin)","formControlName","end","dateFormat","dd/mm/yy","appendTo","body"],["onLabel","Intervalo","offLabel","Fecha","styleClass","p-button-sm w-full",3,"onChange"],["appendTo","body","formControlName","type","optionLabel","name","placeholder","Seleccine un tipo","styleClass","w-full p-inputtext-sm",1,"w-full",3,"options"],[1,"flex","gap-1"],["type","text","pInputText","","placeholder","N\xB0 de casa","formControlName","residenceToShow",1,"w-full","p-inputtext-sm",3,"readOnly"],["icon","pi pi-home","severity","secondary","size","small","label","Seleccionar Residencia","styleClass","w-15rem",3,"raised","rounded","click"],[1,"flex","justify-content-between","mt-2"],["icon","pi pi-filter-slash","label","Limpiar","size","small",3,"outlined","onClick"],["icon","pi pi-filter","label","Filtrar","size","small",3,"outlined","onClick"],["styleClass","bg-gray-200 w-11 lg:w-6",3,"showCloseIcon","dismissable"],["op2",""],["pTemplate","content"],["styleClass","p-datatable-sm p-datatable-striped",3,"value","tableStyle","showJumpToPageDropdown","scrollable","scrollHeight"],["table",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],["styleClass","w-8","position","bottom",3,"visible","header","closable","draggable","visibleChange","onHide"],["ovp",""],["pTemplate","headless"],[3,"modalData","handleClose"],[3,"data"],["styleClass","p-inputtext-sm w-full","placeholder","Fecha pago (Fin)","formControlName","end","dateFormat","dd/mm/yy","appendTo","body",1,"w-full"],["pInputText","","placeholder","Buscar",1,"p-inputtext-sm","mb-2",3,"input"],["search",""],["class","flex justify-content-center"],[1,"flex","justify-content-center"],["styleClass","w-14rem h-14rem","strokeWidth","4","fill","var(--surface-ground)","animationDuration",".5s"],["styleClass","p-datatable-sm p-datatable-striped","selectionMode","single",3,"value","tableStyle","scrollable","scrollHeight","selection","selectionChange","onRowSelect","onRowUnselect"],[3,"pSelectableRow"],[1,"font-bold","text-teal-700"],[1,"text-red-700"],[3,"rows","first","totalRecords","showJumpToPageDropdown","onPageChange"],[1,"text-lg","py-2"],[1,"w-23rem"],[1,"font-bold","text-red-600"],[1,"font-bold","text-teal-600"],["severity","help","label","Mostrar","styleClass","w-full","size","small",3,"rounded","text","raised","click"],["imageClass","w-full h-5rem max-h-5rem border-round",3,"src","preview"],[1,"flex","gap-2"],["icon","pi pi-receipt","severity","secondary","label","Recibo","size","small",3,"rounded","raised","click"],["icon","pi pi-pencil","severity","warning","label","Editar","size","small",3,"rounded","raised","click"],["icon","pi pi-trash","severity","danger","label","Eliminar","size","small",3,"rounded","raised","click"],[3,"rows","first","totalRecords","showJumpToPageDropdown","currentPageReportTemplate","onPageChange"],[1,"text-lg","py-2","px-4"],[1,"bg-black-alpha-90","p-3","border-round","shadow-1"],[1,"text-teal-300","mb-2"],[1,"text-white"],[1,"flex","justify-content-end","mt-2"],["size","small","icon","pi pi-times","label","Cerrar","styleClass","ml-auto","severity","danger",3,"raised","rounded","onClick"]],template:function(o,i){if(o&1){let C=b();a(0,"app-container",0,1),u("onOpenForm",function(){return i.onOpenForm()}),a(2,"div",2)(3,"p-button",3,4),u("click",function(c){return _(C),T(6).toggle(c),i.getResidences(),g(i.getIncomeTypes())}),r(),a(5,"p-overlayPanel",5,6)(7,"form",7)(8,"div",8)(9,"div",9),v(10,"p-calendar",10),f(11,ft,1,0,"p-calendar",11),a(12,"p-toggleButton",12),u("onChange",function(){let c;return i.showInterval=!i.showInterval,(c=i.filterForm.get("end"))==null?null:c.setValue(null)}),r()(),v(13,"p-dropdown",13),a(14,"div",14),v(15,"input",15),a(16,"p-button",16),u("click",function(c){_(C);let w=T(21);return g(i.openResidencePanel(w,c))}),r()(),a(17,"div",17)(18,"p-button",18),u("onClick",function(){return i.onClearFilter()}),r(),a(19,"p-button",19),u("onClick",function(){return i.onFilter()}),r()(),a(20,"p-overlayPanel",20,21),f(22,It,4,1,"ng-template",22),r()()()()(),a(23,"p-table",23,24),f(25,Ft,17,0,"ng-template",25)(26,Vt,1,1,"ng-template",26)(27,Mt,2,1,"ng-template",27),r()(),a(28,"p-dialog",28,29),u("visibleChange",function(c){return i.dialogVisible=c})("onHide",function(){return i.dialogVisible=!1}),f(30,kt,7,4,"ng-template",30),r(),a(31,"app-income-casual-form",31),u("handleClose",function(){return i.onHandleClose()}),r(),v(32,"app-recipe-view",32)}o&2&&(m("options",i.containerOptions),l(3),m("rounded",!0)("raised",!0)("text",!0),l(2),m("showCloseIcon",!0)("dismissable",!1),l(2),m("formGroup",i.filterForm),l(3),m("placeholder",i.showInterval?"Fecha pago (Inicio)":"Fecha de pago"),l(),x(11,i.showInterval?11:-1),l(2),m("options",i.incomeTypes),l(2),m("readOnly",!0),l(),m("raised",!0)("rounded",!0),l(2),m("outlined",!0),l(),m("outlined",!0),l(),m("showCloseIcon",!0)("dismissable",!1),l(3),m("value",i.incomes)("tableStyle",F(28,Nt))("showJumpToPageDropdown",!0)("scrollable",!0)("scrollHeight","calc(100vh - "+i.toolbarHeight+"px - 22.5rem)"),l(5),m("visible",i.dialogVisible)("header","Observaciones")("closable",!0)("draggable",!1),l(3),m("modalData",i.modalData),l(),m("data",i.recipeViewData))},dependencies:[oe,ie,z,ne,Me,G,q,te,ee,X,A,M,k,N,L,B,O,Q,J,we,K,W,me,se,Ne,ke,Z,Y,j,H,le,re,Ae,Be]});let t=s;return t})();export{Ni as CasualComponent};
