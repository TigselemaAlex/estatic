import{a as fe}from"./chunk-DZYMMIQY.js";import{a as he}from"./chunk-QFJMZTM2.js";import"./chunk-KDT3BQPU.js";import{n as ue}from"./chunk-U446ZUSE.js";import"./chunk-7XV6CRBL.js";import"./chunk-LFBU7IBC.js";import"./chunk-6OSMVD66.js";import"./chunk-IAKHD2KQ.js";import"./chunk-KTZAFNHT.js";import"./chunk-L2YMTAJ4.js";import{e as ne,f as re}from"./chunk-SQDM7FYD.js";import"./chunk-MUUDK5FO.js";import"./chunk-GS33KFGJ.js";import{h as se,i as le,m as de,n as me,q as pe,x as ce}from"./chunk-OHCSBWXS.js";import"./chunk-APKN3PFA.js";import"./chunk-X6GEXHSG.js";import{a as oe,b as ae}from"./chunk-MX4UQD2B.js";import"./chunk-X5B2VV3T.js";import"./chunk-ZTWDMVRM.js";import"./chunk-P7FDEGEE.js";import"./chunk-XSSXK7EZ.js";import{a as M}from"./chunk-PXO2TRVQ.js";import"./chunk-PWTX4GCB.js";import{b as J,e as $,f as q,i as K,j as W,k as X,m as Y,o as Z,p as ee,q as te}from"./chunk-HXGQMCX4.js";import"./chunk-TDXTCVPJ.js";import"./chunk-WTM76CTQ.js";import{d as R,e as V}from"./chunk-AXYD25ST.js";import{i as ie,n as T}from"./chunk-VBSZGXZN.js";import{$ as S,Bc as Q,Db as z,Eb as L,Fb as G,Hb as m,Ib as x,O as k,Ob as w,Pb as D,Ta as l,Wa as H,Y as C,Yb as P,Za as U,_b as A,a as I,ab as E,b as N,da as O,db as h,ea as v,fa as b,fb as d,ha as B,ib as j,kb as _,ob as a,pb as o,qb as g,ub as y,wb as f,xb as c}from"./chunk-HOTPW52P.js";function be(e,s){if(e&1&&g(0,"app-error-input",6),e&2){let t=c();d("message",t.getErrorMessage("number",t.residenceForm))}}function xe(e,s){if(e&1&&g(0,"app-error-input",6),e&2){let t=c();d("message",t.getErrorMessage("passage",t.residenceForm))}}function ye(e,s){if(e&1&&g(0,"app-error-input",6),e&2){let t=c();d("message",t.getErrorMessage("user",t.residenceForm))}}function Fe(e,s){if(e&1&&g(0,"app-error-input",6),e&2){let t=c(2);d("message",t.getErrorMessage("user",t.residenceForm))}}var Se=()=>({width:"100%"});function Ee(e,s){if(e&1&&(a(0,"div",17)(1,"label",18),m(2,"Nuevo Propietario"),o(),g(3,"p-dropdown",19),h(4,Fe,1,1,"app-error-input",6),o()),e&2){let t=c(),i;l(3),j(D(6,Se)),d("options",t.users)("showClear",!0)("filter",!0),l(),_(4,(i=t.residenceForm.get("user"))!=null&&i.invalid&&((i=t.residenceForm.get("user"))!=null&&i.dirty)?4:-1)}}function we(e,s){if(e&1){let t=y();a(0,"p-button",20),f("onClick",function(){v(t);let r=c();return b(r.handleAccept())}),o(),a(1,"p-button",21),f("onClick",function(){v(t);let r=c();return r.handleClose.emit(),b(r.usersChoiceVisible=!1)}),o()}e&2&&(d("raised",!0)("rounded",!0),l(),d("raised",!0)("rounded",!0))}var _e=(()=>{let s=class s extends M{constructor(){super(...arguments),this.modalData={visible:!1,title:"",data:null,response:null},this.handleClose=new U,this.usersChoiceVisible=!1,this.users=[],this.fb=C(Y),this.userService=C(he),this.residenceForm=this.fb.group({id:[""],number:[""],user:[""],passage:[""],selectedUser:[""]}),this.getErrorMessage=ae}handleAccept(){this.residenceForm.valid?(this.modalData.response=this.residenceForm.value,this.handleClose.emit()):Object.values(this.residenceForm.controls).forEach(i=>{i.invalid&&(i.markAsDirty(),i.updateValueAndValidity({onlySelf:!0}))})}ngOnChanges(i){if(i.modalData){this.userService.findAllActive().pipe(k(this.destroyed)).subscribe({next:p=>{this.users=p.data.map(u=>N(I({},u),{label:u.names+" "+u.surnames+" - "+u.dni}))}}),this.residenceForm.reset();let r=N(I({},this.modalData.data?.user),{label:(this.modalData.data?.user?.names||"Sin")+" "+(this.modalData.data?.user?.surnames||"Propietario")+" - "+(this.modalData.data?.user?.dni||"")}),n=this.modalData.data?.passage;this.residenceForm.patchValue({id:this.modalData.data?.id,number:this.modalData.data?.number,user:r.active?r:null,passage:n?.name,selectedUser:r.label})}}changeUser(){this.usersChoiceVisible=!0}handleUserChange(){this.usersChoiceVisible=!1}};s.\u0275fac=(()=>{let i;return function(n){return(i||(i=B(s)))(n||s)}})(),s.\u0275cmp=S({type:s,selectors:[["app-residence-form"]],inputs:{modalData:"modalData"},outputs:{handleClose:"handleClose"},standalone:!0,features:[E,O,w],decls:24,vars:15,consts:[["styleClass","w-10 md:w-30rem",3,"header","visible","modal","draggable","resizable","visibleChange","onHide"],[1,"pt-4","grid","row-gap-3",3,"formGroup"],[1,"col-4"],[1,"p-float-label"],["pInputText","","id","number","formControlName","number","type","text","autocomplete","off",1,"w-full",3,"readOnly"],["for","number"],[3,"message"],[1,"col-8"],["pInputText","","id","passage","formControlName","passage","type","text","autocomplete","off",1,"w-full",3,"disabled","readOnly"],["for","passage"],[1,"col-10"],["pInputText","","id","user","formControlName","selectedUser","type","text","autocomplete","off",1,"w-full",3,"readOnly"],["for","user"],[1,"col-2"],["icon","pi pi-arrow-right-arrow-left","severity","secondary",3,"raised","onClick"],["class","col-12"],["pTemplate","footer"],[1,"col-12"],[1,"text-xs","text-gray-500","ml-3","mb-2","block"],["formControlName","user","optionLabel","label","dataKey","id","appendTo","body","placeholder","Seleccione un propietario",3,"options","showClear","filter"],["label","Aceptar","severity","success",3,"raised","rounded","onClick"],["label","Cancelar","severity","danger",3,"raised","rounded","onClick"]],template:function(r,n){if(r&1&&(a(0,"p-dialog",0),f("visibleChange",function(u){return n.modalData.visible=u})("onHide",function(){return n.handleClose.emit(),n.usersChoiceVisible=!1}),a(1,"form",1)(2,"div",2)(3,"span",3),g(4,"input",4),a(5,"label",5),m(6,"N\xFAmero"),o()(),h(7,be,1,1,"app-error-input",6),o(),a(8,"div",7)(9,"span",3),g(10,"input",8),a(11,"label",9),m(12,"Pasaje"),o()(),h(13,xe,1,1,"app-error-input",6),o(),a(14,"div",10)(15,"span",3),g(16,"input",11),a(17,"label",12),m(18,"Propietario Actual"),o()(),h(19,ye,1,1,"app-error-input",6),o(),a(20,"div",13)(21,"p-button",14),f("onClick",function(){return n.changeUser()}),o()(),h(22,Ee,5,7,"div",15),o(),h(23,we,2,4,"ng-template",16),o()),r&2){let p,u,F;d("header",n.modalData.title)("visible",n.modalData.visible)("modal",!0)("draggable",!1)("resizable",!1),l(),d("formGroup",n.residenceForm),l(3),d("readOnly",!0),l(3),_(7,(p=n.residenceForm.get("number"))!=null&&p.invalid&&((p=n.residenceForm.get("number"))!=null&&p.dirty)?7:-1),l(3),d("disabled",!0)("readOnly",!0),l(3),_(13,(u=n.residenceForm.get("passage"))!=null&&u.invalid&&((u=n.residenceForm.get("passage"))!=null&&u.dirty)?13:-1),l(3),d("readOnly",!0),l(3),_(19,(F=n.residenceForm.get("user"))!=null&&F.invalid&&((F=n.residenceForm.get("user"))!=null&&F.dirty)?19:-1),l(2),d("raised",!0),l(),_(22,n.usersChoiceVisible?22:-1)}},dependencies:[re,ne,T,Z,K,J,$,q,W,X,te,ee,oe,V,R,le,se]});let e=s;return e})();var De=["container"];function Te(e,s){e&1&&(a(0,"tr")(1,"th"),m(2,"N\xFAmero de Casa"),o(),a(3,"th"),m(4,"Propietario"),o(),a(5,"th"),m(6,"Pasaje"),o(),a(7,"th",7),m(8,"Fecha de creaci\xF3n"),o(),a(9,"th",7),m(10,"Fecha de actualizaci\xF3n"),o(),a(11,"th"),m(12,"Acciones"),o()())}function Re(e,s){if(e&1&&(a(0,"td"),m(1),o()),e&2){let t=c().$implicit;l(),x(t.user.names+" "+t.user.surnames)}}function Ve(e,s){e&1&&(a(0,"td",11),m(1,"Sin residente registrado"),o())}function Me(e,s){if(e&1){let t=y();a(0,"tr")(1,"td",8),m(2),o(),h(3,Re,2,1,"td")(4,Ve,2,0),a(5,"td"),m(6),o(),a(7,"td"),m(8),P(9,"date"),o(),a(10,"td"),m(11),P(12,"date"),o(),a(13,"td")(14,"div",9)(15,"p-button",10),f("onClick",function(){let n=v(t).$implicit,p=c();return b(p.openForm(n))}),o()()()()}if(e&2){let t=s.$implicit;l(2),x(t.number),l(),_(3,t.user?3:4),l(3),x((t.passage==null?null:t.passage.name)||""),l(2),x(A(9,7,t.createdAt,"dd/MM/yyyy")),l(3),x(A(12,10,t.updatedAt,"dd/MM/yyyy")),l(4),d("rounded",!0)("raised",!0)}}function Ie(e,s){if(e&1){let t=y();a(0,"div",13)(1,"p-paginator",14),f("onPageChange",function(r){v(t);let n=c(2);return b(n.onPageChange(r))}),o()()}if(e&2){let t=c(2);l(),d("rows",t.rows)("first",t.first)("totalRecords",t.totalItems)("showJumpToPageDropdown",!0)}}function Ne(e,s){e&1&&(a(0,"div",13)(1,"p",15),m(2,"No hay datos para mostrar"),o()())}function Pe(e,s){if(e&1&&h(0,Ie,2,4,"div",12)(1,Ne,3,0),e&2){let t=c();_(0,t.residences.length>0?0:1)}}var Ae=()=>({"min-width":"50rem"}),xt=(()=>{let s=class s extends M{constructor(){super(),this.first=0,this.rows=10,this.totalItems=0,this.residences=[],this.modalData={visible:!1,title:"",data:null,response:null},this.containerOptions={showNewButton:!1,showSearch:!0,dataLoading:!0},this.toolbarHeight=0,this.messageService=C(ie),this.residenceService=C(fe),this.cdr=C(H)}ngOnInit(){super.ngOnInit(),this.getResidences()}getResidences(i=0,r=""){this.residenceService.findAll(i,r).subscribe({next:this.handleFindAllNext.bind(this),error:this.handleError.bind(this)})}handleFindAllNext(i){this.containerOptions.dataLoading=!0;let r=i.data;this.residences=r.content,this.totalItems=r.totalItems,setTimeout(()=>{this.containerOptions.dataLoading=!1},300)}handleError(i){this.messageService.add({severity:"error",summary:"Error",detail:i.error||i.status===404?"No se encontrado la residencia":"Ha ocurrido un error"}),this.modalData.response=null}openForm(i){this.modalData={visible:!0,title:"Editar residencia",data:i,response:null}}onPageChange(i){let r=this.containerComponent.searchInput.nativeElement.value;this.getResidences(i.page,r),this.first=i.first}getHandleClose(){if(this.modalData.response){let i=this.modalData.data?.id,r=this.modalData.response?.user?.id||null;this.residenceService.updateResidence(i,{user:r}).subscribe({next:n=>{this.messageService.add({severity:"success",summary:"Residencia actualizada",detail:n.message}),this.reset(),this.getResidences()},error:this.handleError.bind(this)})}else this.reset()}onSearch(i){this.getResidences(0,i)}reset(){this.modalData={visible:!1,title:"",data:null,response:null}}ngAfterViewInit(){this.toolbarHeight=this.containerComponent.toolbar.getBlockableElement().clientHeight,this.cdr.detectChanges()}};s.\u0275fac=function(r){return new(r||s)},s.\u0275cmp=S({type:s,selectors:[["app-residences"]],viewQuery:function(r,n){if(r&1&&z(De,5),r&2){let p;L(p=G())&&(n.containerComponent=p.first)}},standalone:!0,features:[E,w],decls:7,vars:7,consts:[[3,"options","onSearch"],["container",""],["styleClass","p-datatable-sm p-datatable-striped",3,"value","tableStyle","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],[3,"modalData","handleClose"],[1,"max-w-8rem"],[1,"font-bold","text-teal-700"],[1,"flex","gap-1"],["icon","pi pi-pencil","severity","warning","label","Editar","size","small",3,"rounded","raised","onClick"],[1,"text-red-700"],["class","flex justify-content-center"],[1,"flex","justify-content-center"],[3,"rows","first","totalRecords","showJumpToPageDropdown","onPageChange"],[1,"text-lg","py-2","px-4"]],template:function(r,n){r&1&&(a(0,"app-container",0,1),f("onSearch",function(u){return n.onSearch(u)}),a(2,"p-table",2),h(3,Te,13,0,"ng-template",3)(4,Me,16,13,"ng-template",4)(5,Pe,2,1,"ng-template",5),o()(),a(6,"app-residence-form",6),f("handleClose",function(){return n.getHandleClose()}),o()),r&2&&(d("options",n.containerOptions),l(2),d("value",n.residences)("tableStyle",D(6,Ae))("scrollable",!0)("scrollHeight","calc(100vh - "+n.toolbarHeight+"px - 13.5rem)"),l(4),d("modalData",n.modalData))},dependencies:[_e,ue,ce,pe,T,V,R,me,de,Q]});let e=s;return e})();export{xt as ResidencesComponent};
