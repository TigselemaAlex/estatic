import{a as he}from"./chunk-JDRUBIL5.js";import{a as qe}from"./chunk-X3UOWKQ6.js";import{a as fe}from"./chunk-PZI4WV4M.js";import{a as ge}from"./chunk-DZYMMIQY.js";import{a as Oe}from"./chunk-X7SG3D25.js";import{a as Le,b as He}from"./chunk-X2N4LBF3.js";import{a as ee,b as te}from"./chunk-B2W5NOZS.js";import{a as de}from"./chunk-WYL7NH4F.js";import{f as Ae,g as Be,n as Ue}from"./chunk-U446ZUSE.js";import{a as ue,b as _e}from"./chunk-7XV6CRBL.js";import{a as Pe,b as Ne}from"./chunk-LFBU7IBC.js";import{a as pe,b as ce}from"./chunk-6OSMVD66.js";import"./chunk-IAKHD2KQ.js";import"./chunk-KTZAFNHT.js";import"./chunk-L2YMTAJ4.js";import{e as X,f as Z}from"./chunk-SQDM7FYD.js";import"./chunk-MUUDK5FO.js";import"./chunk-GS33KFGJ.js";import{h as ie,i as Me,k as ne,l as oe,m as ae,n as re,q as le,r as se,x as me}from"./chunk-OHCSBWXS.js";import"./chunk-APKN3PFA.js";import"./chunk-X6GEXHSG.js";import{a as De,b as Ve}from"./chunk-MX4UQD2B.js";import"./chunk-X5B2VV3T.js";import"./chunk-ZTWDMVRM.js";import"./chunk-P7FDEGEE.js";import"./chunk-XSSXK7EZ.js";import{a as Re,b as ke}from"./chunk-PWTX4GCB.js";import{b as U,c as T,e as O,f as L,i as H,j as q,k as z,l as j,o as $,p as G,q as J}from"./chunk-HXGQMCX4.js";import"./chunk-TDXTCVPJ.js";import"./chunk-WTM76CTQ.js";import{d as Y,e as K}from"./chunk-AXYD25ST.js";import{e as Ie,i as Q,n as W}from"./chunk-VBSZGXZN.js";import{$ as P,Bc as ve,Db as Se,Eb as Te,Fb as Fe,Gb as F,Hb as m,Ib as b,Jb as E,Lb as Ee,Ob as N,Pb as I,Ta as l,Wa as we,Y as x,Yb as A,Za as be,_b as B,a as Ce,b as ye,da as xe,db as f,ea as h,fa as C,fb as d,kb as v,ob as r,pb as a,qb as y,ub as w,wb as u,xb as p}from"./chunk-HOTPW52P.js";function nt(n,s){if(n&1&&y(0,"app-error-input",8),n&2){let e=p();d("message",e.getErrorMessage("residence",e.form))}}function ot(n,s){if(n&1&&y(0,"app-error-input",8),n&2){let e=p(2);d("message",e.getErrorMessage("parking",e.form))}}function at(n,s){if(n&1){let e=w();r(0,"div",38)(1,"label",21),m(2,"Parqueadero"),a(),r(3,"p-dropdown",39),u("onChange",function(){h(e);let o=p();return C(o.getLastByResidenceAndType())}),a(),f(4,ot,1,1,"app-error-input",8),a()}if(n&2){let e=p(),i;l(3),d("options",e.parkings),l(),v(4,(i=e.form.get("parking"))!=null&&i.dirty&&((i=e.form.get("parking"))!=null&&i.invalid)?4:-1)}}function rt(n,s){if(n&1&&y(0,"app-error-input",8),n&2){let e=p();d("message",e.getErrorMessage("description",e.form))}}function lt(n,s){if(n&1&&y(0,"app-error-input",8),n&2){let e=p();d("message",e.getErrorMessage("incomeType",e.form))}}function st(n,s){if(n&1&&y(0,"app-error-input",8),n&2){let e=p();d("message",e.getErrorMessage("paidDate",e.form))}}function mt(n,s){if(n&1&&y(0,"app-error-input",8),n&2){let e=p();d("message",e.getErrorMessage("paidSince",e.form))}}function dt(n,s){if(n&1&&y(0,"app-error-input",8),n&2){let e=p();d("message",e.getErrorMessage("paidUntil",e.form))}}function pt(n,s){if(n&1&&y(0,"app-error-input",8),n&2){let e=p();d("message",e.getErrorMessage("paidEvidence",e.form))}}function ct(n,s){if(n&1&&(r(0,"div",18),y(1,"p-image",40),a()),n&2){let e=p();l(),d("src",e.modalData.data.paidEvidence.fileUrl||"assets/images/No_image_available.svg")("preview",!!e.modalData.data.paidEvidence.fileUrl)}}function ut(n,s){n&1&&(r(0,"div",44),y(1,"p-progressSpinner",45),a())}function _t(n,s){n&1&&(r(0,"tr")(1,"th"),m(2,"N\xFAmero de Casa"),a(),r(3,"th"),m(4,"Propietario"),a(),r(5,"th"),m(6,"Pasaje"),a()())}function gt(n,s){if(n&1&&(r(0,"td"),m(1),a()),n&2){let e=p().$implicit;l(),E(" ",e.user.names+" "+e.user.surnames," ")}}function ft(n,s){n&1&&(r(0,"td",52),m(1,"Sin residente registrado"),a())}function ht(n,s){if(n&1&&(r(0,"tr",50)(1,"td",51),m(2),a(),f(3,gt,2,1,"td")(4,ft,2,0),r(5,"td"),m(6),a()()),n&2){let e=s.$implicit,i=s.$implicit;d("pSelectableRow",i),l(2),b(e.number),l(),v(3,e.user?3:4),l(3),b((e.passage==null?null:e.passage.name)||"")}}function Ct(n,s){if(n&1){let e=w();r(0,"div",44)(1,"p-paginator",53),u("onPageChange",function(o){h(e);let t=p(4);return C(t.onPageChange(o))}),a()()}if(n&2){let e=p(4);l(),d("rows",e.rows)("first",e.first)("totalRecords",e.totalItems)("showJumpToPageDropdown",!0)}}function yt(n,s){n&1&&(r(0,"div",44)(1,"p",54),m(2,"No hay datos para mostrar"),a()())}function vt(n,s){if(n&1&&f(0,Ct,2,4,"div",43)(1,yt,3,0),n&2){let e=p(3);v(0,e.residences.length>0?0:1)}}var xt=()=>({"min-width":"30rem"});function wt(n,s){if(n&1){let e=w();r(0,"p-table",46),u("selectionChange",function(o){h(e);let t=p(2);return C(t.selectedResidence=o)})("onRowSelect",function(o){h(e);let t=p(2),c=F(71);return C(t.onRowSelect(o,c))})("onRowUnselect",function(){h(e);let o=p(2),t;return o.selectedResidence=null,(t=o.form.get("residence"))==null||t.setValue(""),(t=o.form.get("residenceToShow"))==null||t.setValue(""),C(o.getParkings())}),f(1,_t,7,0,"ng-template",47)(2,ht,7,4,"ng-template",48)(3,vt,2,1,"ng-template",49),a()}if(n&2){let e=p(2);d("value",e.residences)("tableStyle",I(5,xt))("scrollable",!0)("scrollHeight","20vh")("selection",e.selectedResidence)}}function bt(n,s){if(n&1){let e=w();r(0,"input",41,42),u("input",function(){h(e);let o=F(1),t=p();return C(t.onSearch(o.value))}),a(),f(2,ut,2,0,"div",43)(3,wt,4,6)}if(n&2){let e=p();l(2),v(2,e.dataLoading?2:3)}}function St(n,s){if(n&1){let e=w();r(0,"p-button",55),u("onClick",function(){h(e);let o=p();return C(o.handleAccept())}),a(),r(1,"p-button",56),u("onClick",function(){h(e);let o=p();return o.modalData.response=null,C(o.handleClose.emit())}),a()}n&2&&(d("raised",!0)("rounded",!0),l(),d("raised",!0)("rounded",!0))}var ze=(()=>{let s=class s{constructor(){this.getErrorMessage=Ve,this.messageService=x(Q),this.fb=x(j),this.incomeTypeSerive=x(fe),this.residenceService=x(ge),this.incomeService=x(he),this.parkingService=x(Oe),this.modalData={title:"",data:null,visible:!1,response:null},this.handleClose=new be,this.form=this.fb.group({id:[null],description:["",T.required],monthlyAmount:[0],amount:[0,T.required],paidDate:["",T.required],paidSince:["",T.required],paidUntil:["",[T.required]],paidMonths:[0],residenceToShow:["",T.required],residence:["",T.required],parking:[],incomeType:["",T.required],paidEvidence:[null,T.required]}),this.selectedFile=null,this.incomeTypes=[],this.parkings=[],this.first=0,this.dataLoading=!0,this.rows=10,this.totalItems=0,this.residences=[],this.selectedResidence=null}ngOnChanges(i){if(i.modalData&&(this.form.setValidators(this.validateDates),this.getIncomeTypes(),this.getResidences(),this.form.reset(),this.form.get("paidUntil")?.setValidators([T.required,this.validateDates]),this.form.get("paidUntil")?.updateValueAndValidity({onlySelf:!0}),this.modalData.data)){let o=this.modalData.data.residence.user;this.form.patchValue(ye(Ce({},this.modalData.data),{paidDate:new Date(this.modalData.data.paidDate),paidSince:new Date(this.modalData.data.paidSince),paidUntil:new Date(this.modalData.data.paidUntil),residenceToShow:this.modalData.data.residence.number+(o!==null?" - "+o.names+" "+o.surnames:" - Sin residente registrado"),residence:this.modalData.data.residence,incomeType:this.modalData.data.type,monthlyAmount:this.modalData.data.type.price})),this.selectedResidence=this.modalData.data.residence,this.form.get("paidEvidence")?.clearValidators(),this.form.get("paidEvidence")?.updateValueAndValidity(),this.calculateAmount()}}getIncomeTypes(){this.incomeTypeSerive.findAllActiveByPeriod(de.MONTHLY).subscribe({next:i=>{this.incomeTypes=i.data},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Error al obtener los tipos de ingreso"})}})}handleAccept(){this.form.get("paidEvidence")?.setValue(this.selectedFile),this.form.valid?(this.modalData.response=this.form.value,this.handleClose.emit()):Object.values(this.form.controls).forEach(i=>{i.invalid&&i.markAsDirty()})}getParkings(){let i=this.form.get("residence")?.value,o=this.form.get("incomeType")?.value;o&&i?o.id===2?(this.form.get("parking")?.setValidators(T.required),this.form.get("parking")?.updateValueAndValidity({onlySelf:!0}),this.parkingService.findAllByResidence(i.id).subscribe({next:t=>{this.parkings=t.data,this.parkings.length===0&&this.messageService.add({severity:"warn",summary:"Aviso",detail:"Esta residencia no tiene parqueaderos asignados"})},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Error al obtener los parqueaderos"})}})):(this.form.get("parking")?.setValue(null),this.parkings=[],this.form.get("parking")?.clearValidators(),this.form.get("parking")?.updateValueAndValidity({onlySelf:!0})):(this.parkings=[],this.form.get("parking")?.clearValidators(),this.form.get("parking")?.updateValueAndValidity({onlySelf:!0}))}handleIncomeType(i){this.form.get("monthlyAmount")?.setValue(i.price),this.getParkings(),this.calculateAmount(),this.getLastByResidenceAndType()}calculateAmount(){if(this.form.get("paidSince")&&this.form.get("paidUntil")&&this.form.get("monthlyAmount")&&this.form.get("paidSince").value&&this.form.get("paidUntil").value&&this.form.get("monthlyAmount").value){let i=new Date(this.form.get("paidSince").value),o=new Date(this.form.get("paidUntil").value);if(i>o)return;let t=(o.getFullYear()-i.getFullYear())*12+(o.getMonth()-i.getMonth())+1;this.form.get("paidMonths").setValue(t),this.form.get("amount")?.setValue(t*this.form.get("monthlyAmount").value)}}setImage(i){let o=i.files[0];o?this.selectedFile=o:this.selectedFile=null}getResidences(i=0,o=""){this.residenceService.findAll(i,o).subscribe({next:this.handleFindAllNext.bind(this),error:this.handleError.bind(this)})}handleFindAllNext(i){this.dataLoading=!0;let o=i.data;this.residences=o.content,this.totalItems=o.totalItems,setTimeout(()=>{this.dataLoading=!1},300)}handleError(i){this.messageService.add({severity:"error",summary:"Error",detail:i.error||i.status===404?"No se encontrado la residencia":"Ha ocurrido un error"}),this.modalData.response=null}onPageChange(i){this.getResidences(i.page),this.first=i.first}onSearch(i){this.first=0,this.getResidences(0,i)}openResidencePanel(i,o){i.show(o)}onRowSelect(i,o){let t=i.data;this.form.patchValue({residence:t});let c=t.user;this.form.patchValue({residenceToShow:t.number+(c!==null?" - "+c.names+" "+c.surnames:" - Sin residente registrado")}),this.messageService.add({severity:"info",summary:"Informaci\xF3n",detail:"Residencia seleccionada"}),o.hide(),this.getLastByResidenceAndType(),this.getParkings()}validateDates(i){let o=i.get("paidSince")?.value,t=i.get("paidUntil")?.value;return o&&t&&t<o?(i.get("paidUntil")?.setErrors({lowerDate:!0}),{lowerDate:!0}):null}getLastByResidenceAndType(){if(this.modalData.data)return;let i=this.form.get("residence")?.value,o=this.form.get("incomeType")?.value,t;if(i&&o){let c=o;if(c.id===2){let g=this.form.get("parking")?.value;if(g)t=g.id;else return}this.incomeService.findLastActiveByResidenceAndType(i.id,c.id,t).subscribe({next:g=>{let _=g.data;_&&(this.form.patchValue(ye(Ce({},this.form.value),{paidSince:new Date(_.paidUntil)})),this.messageService.add({severity:"info",summary:"Informaci\xF3n",detail:"Ingreso encontrado, la fecha desde el ultimo ingreso se ha actualizado"}))},error:g=>{this.form.patchValue({paidSince:null}),g.status===404&&this.messageService.add({severity:"warn",summary:"Aviso",detail:"No se encontr\xF3 un ingreso previo"})}})}}};s.\u0275fac=function(o){return new(o||s)},s.\u0275cmp=P({type:s,selectors:[["app-income-fees-form"]],inputs:{modalData:"modalData"},outputs:{handleClose:"handleClose"},standalone:!0,features:[xe,N],decls:74,vars:32,consts:[["id","dialog","styleClass","w-11 md:w-8 lg:w-8",3,"header","visible","modal","draggable","resizable","visibleChange","onHide"],[1,"pt-4","grid","row-gap-3","h-full","nested-grid",3,"formGroup"],[1,"col-6","lg:col-3"],["icon","pi pi-home","severity","secondary","size","small","label","Seleccionar Residencia","styleClass","w-full",3,"raised","rounded","click"],[1,"col-6","lg:col-4"],[1,"p-float-label"],["pInputText","","formControlName","residenceToShow","type","text",1,"w-full",3,"readOnly"],["for","residenceToShow"],[3,"message"],[1,"col-6","lg:col-2"],[1,"flex","align-items-baseline","gap-4","w-full","justify-content-end","h-full"],[1,"font-bold","uppercase","text-xl","vertical-align-middle","white-space-nowrap"],[1,"text-indigo-600"],[1,"font-bold","text-2xl"],["class","col-12 relative"],[1,"col-12","lg:col-8"],["pInputTextarea","","formControlName","description","id","description",1,"w-full",3,"rows"],["for","description"],[1,"col-12","lg:col-4"],[1,"flex","flex-column","gap-5"],[1,"relative","w-full"],["for","severity",1,"text-xs","text-gray-500","block","ml-2","absolute","left-0",2,"top","-1.2rem"],["formControlName","incomeType","optionLabel","name","appendTo","body","placeholder","Seleccione un tipo","styleClass","w-full",1,"w-full",3,"options","onChange"],["formControlName","monthlyAmount","mode","currency","currency","USD","locale","en-US","styleClass","w-full",1,"w-full",3,"readonly","min"],["for","price"],["appendTo","body","formControlName","paidDate","dateFormat","dd/mm/yy","styleClass","w-full",3,"showButtonBar"],["for","date"],["appendTo","body","formControlName","paidSince","view","month","dateFormat","MM 'del' yy","styleClass","w-full",3,"showButtonBar","onSelect"],["appendTo","body","formControlName","paidUntil","view","month","dateFormat","MM 'del' yy","styleClass","w-full",3,"showButtonBar","onSelect"],[1,"col-12","py-0","my-0"],[1,"text-center","text-gray-500","mb-2","text-white","bg-yellow-800","py-1","border-round-xl"],["mode","advanced","chooseLabel","Seleccione una imagen","accept","image/*","chooseStyleClass","p-button-raised p-button-secondary w-full","removeStyleClass","p-button-raised p-button-danger p-button-rounded",3,"maxFileSize","showUploadButton","showCancelButton","onSelect","onRemove","onClear"],["fu",""],["class","col-12 lg:col-4"],["styleClass","bg-gray-200 w-11 lg:w-6",3,"showCloseIcon","dismissable"],["op1",""],["pTemplate","content"],["pTemplate","footer"],[1,"col-12","relative"],["formControlName","parking","optionLabel","code","appendTo","body","placeholder","Seleccione un parqueadero","styleClass","w-full",1,"w-full",3,"options","onChange"],["styleClass","flex justify-content-center shadow-3","appendTo","body","imageClass","w-full h-17rem max-h-17rem border-round",3,"src","preview"],["pInputText","","placeholder","Buscar",1,"p-inputtext-sm","mb-2",3,"input"],["search",""],["class","flex justify-content-center"],[1,"flex","justify-content-center"],["styleClass","w-14rem h-14rem","strokeWidth","4","fill","var(--surface-ground)","animationDuration",".5s"],["styleClass","p-datatable-sm p-datatable-striped","selectionMode","single",3,"value","tableStyle","scrollable","scrollHeight","selection","selectionChange","onRowSelect","onRowUnselect"],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],[3,"pSelectableRow"],[1,"font-bold","text-teal-700"],[1,"text-red-700"],[3,"rows","first","totalRecords","showJumpToPageDropdown","onPageChange"],[1,"text-lg","py-2"],["label","Aceptar","severity","success",3,"raised","rounded","onClick"],["label","Cancelar","severity","danger",3,"raised","rounded","onClick"]],template:function(o,t){if(o&1){let c=w();r(0,"p-dialog",0),u("visibleChange",function(_){return t.modalData.visible=_})("onHide",function(){h(c);let _=F(67);return t.modalData.response=null,t.handleClose.emit(),C(_.clear())}),r(1,"form",1)(2,"div",2)(3,"p-button",3),u("click",function(_){h(c);let S=F(71);return C(t.openResidencePanel(S,_))}),a()(),r(4,"div",4)(5,"span",5),y(6,"input",6),r(7,"label",7),m(8,"Residencia"),a()(),f(9,nt,1,1,"app-error-input",8),a(),r(10,"div",9)(11,"div",10)(12,"label",11),m(13,"Meses:"),a(),r(14,"p",12)(15,"span",13),m(16),a()()()(),r(17,"div",2)(18,"div",10)(19,"label",11),m(20,"Monto Total:"),a(),r(21,"p",12)(22,"span",13),m(23,"$"),a(),r(24,"span",13),m(25),a()()()(),f(26,at,5,2,"div",14),r(27,"div",15)(28,"span",5),y(29,"textarea",16),r(30,"label",17),m(31,"Descripci\xF3n"),a()(),f(32,rt,1,1,"app-error-input",8),a(),r(33,"div",18)(34,"div",19)(35,"div",20)(36,"label",21),m(37,"Tipo de ingreso mensual"),a(),r(38,"p-dropdown",22),u("onChange",function(_){return t.handleIncomeType(_.value)}),a(),f(39,lt,1,1,"app-error-input",8),a(),r(40,"span",5),y(41,"p-inputNumber",23),r(42,"label",24),m(43,"Pago mensual"),a()()()(),r(44,"div",18)(45,"span",5),y(46,"p-calendar",25),r(47,"label",26),m(48,"Fecha del pago"),a()(),f(49,st,1,1,"app-error-input",8),a(),r(50,"div",18)(51,"span",5)(52,"p-calendar",27),u("onSelect",function(){return t.calculateAmount()}),a(),r(53,"label"),m(54,"Desde el mes"),a()(),f(55,mt,1,1,"app-error-input",8),a(),r(56,"div",18)(57,"span",5)(58,"p-calendar",28),u("onSelect",function(){return t.calculateAmount()}),a(),r(59,"label",26),m(60,"Hasta el mes"),a()(),f(61,dt,1,1,"app-error-input",8),a(),r(62,"div",29)(63,"p",30),m(64," Comprobante de pago "),a()(),r(65,"div",15)(66,"p-fileUpload",31,32),u("onSelect",function(_){return t.setImage(_)})("onRemove",function(){return t.selectedFile=null})("onClear",function(){let _;return(_=t.form.get("paidEvidence"))==null||_.setValue(null),t.selectedFile=null}),a(),f(68,pt,1,1,"app-error-input",8),a(),f(69,ct,2,2,"div",33),r(70,"p-overlayPanel",34,35),f(72,bt,4,1,"ng-template",36),a()(),f(73,St,2,4,"ng-template",37),a()}if(o&2){let c,g,_,S,D,V,M,R,k;d("header",t.modalData.title)("visible",t.modalData.visible)("modal",!0)("draggable",!1)("resizable",!1),l(),d("formGroup",t.form),l(2),d("raised",!0)("rounded",!0),l(3),d("readOnly",!0),l(3),v(9,(c=t.form.get("residence"))!=null&&c.dirty&&((c=t.form.get("residence"))!=null&&c.invalid)?9:-1),l(7),b((g=t.form.get("paidMonths"))==null?null:g.value),l(9),b((_=t.form.get("amount"))==null?null:_.value),l(),v(26,t.parkings.length>0?26:-1),l(3),d("rows",5),l(3),v(32,(S=t.form.get("description"))!=null&&S.dirty&&((S=t.form.get("description"))!=null&&S.invalid)?32:-1),l(6),d("options",t.incomeTypes),l(),v(39,(D=t.form.get("incomeType"))!=null&&D.dirty&&((D=t.form.get("incomeType"))!=null&&D.invalid)?39:-1),l(2),d("readonly",!0)("min",0),l(5),d("showButtonBar",!0),l(3),v(49,(V=t.form.get("paidDate"))!=null&&V.dirty&&((V=t.form.get("paidDate"))!=null&&V.invalid)?49:-1),l(3),d("showButtonBar",!0),l(3),v(55,(M=t.form.get("paidSince"))!=null&&M.dirty&&((M=t.form.get("paidSince"))!=null&&M.invalid)?55:-1),l(3),d("showButtonBar",!0),l(3),v(61,(R=t.form.get("paidUntil"))!=null&&R.dirty&&((R=t.form.get("paidUntil"))!=null&&R.invalid)?61:-1),l(5),d("maxFileSize",5e6)("showUploadButton",!1)("showCancelButton",!1),l(2),v(68,(k=t.form.get("paidEvidence"))!=null&&k.dirty&&((k=t.form.get("paidEvidence"))!=null&&k.invalid)?68:-1),l(),v(69,t.modalData.data?69:-1),l(),d("showCloseIcon",!0)("dismissable",!1)}},dependencies:[$,H,U,O,L,q,z,K,Y,W,J,G,Ne,Pe,ke,Re,oe,ne,Be,Ae,De,Z,X,Me,ie,me,le,se,te,ee,re,ae,ce,pe,_e,ue]});let n=s;return n})();var Tt=["container"];function Ft(n,s){n&1&&y(0,"p-calendar",33)}function Et(n,s){n&1&&(r(0,"div",37),y(1,"p-progressSpinner",38),a())}function It(n,s){n&1&&(r(0,"tr")(1,"th"),m(2,"N\xFAmero de Casa"),a(),r(3,"th"),m(4,"Propietario"),a(),r(5,"th"),m(6,"Pasaje"),a()())}function Dt(n,s){if(n&1&&(r(0,"td"),m(1),a()),n&2){let e=p().$implicit;l(),E(" ",e.user.names+" "+e.user.surnames," ")}}function Vt(n,s){n&1&&(r(0,"td",42),m(1,"Sin residente registrado"),a())}function Mt(n,s){if(n&1&&(r(0,"tr",40)(1,"td",41),m(2),a(),f(3,Dt,2,1,"td")(4,Vt,2,0),r(5,"td"),m(6),a()()),n&2){let e=s.$implicit,i=s.$implicit;d("pSelectableRow",i),l(2),E(" ",e.number," "),l(),v(3,e.user?3:4),l(3),b((e.passage==null?null:e.passage.name)||"")}}function Rt(n,s){if(n&1){let e=w();r(0,"div",37)(1,"p-paginator",43),u("onPageChange",function(o){h(e);let t=p(4);return C(t.onPageChangeResidence(o))}),a()()}if(n&2){let e=p(4);l(),d("rows",e.rowsResidence)("first",e.firstResidence)("totalRecords",e.totalItemsResidence)("showJumpToPageDropdown",!0)}}function kt(n,s){n&1&&(r(0,"div",37)(1,"p",44),m(2,"No hay datos para mostrar"),a()())}function Pt(n,s){if(n&1&&f(0,Rt,2,4,"div",36)(1,kt,3,0),n&2){let e=p(3);v(0,e.residences.length>0?0:1)}}var Nt=()=>({"min-width":"30rem"});function At(n,s){if(n&1){let e=w();r(0,"p-table",39),u("selectionChange",function(o){h(e);let t=p(2);return C(t.selectedResidence=o)})("onRowSelect",function(o){h(e);let t=p(2),c=F(21);return C(t.onRowSelectResidence(o,c))})("onRowUnselect",function(){h(e);let o=p(2),t;return o.selectedResidence=null,(t=o.filterForm.get("residence"))==null||t.setValue(void 0),C((t=o.filterForm.get("residenceToShow"))==null?null:t.setValue(""))}),f(1,It,7,0,"ng-template",25)(2,Mt,7,4,"ng-template",26)(3,Pt,2,1,"ng-template",27),a()}if(n&2){let e=p(2);d("value",e.residences)("tableStyle",I(5,Nt))("scrollable",!0)("scrollHeight","20vh")("selection",e.selectedResidence)}}function Bt(n,s){if(n&1){let e=w();r(0,"input",34,35),u("input",function(){h(e);let o=F(1),t=p();return C(t.onSearchResidence(o.value))}),a(),f(2,Et,2,0,"div",36)(3,At,4,6)}if(n&2){let e=p();l(2),v(2,e.dataLoading?2:3)}}function Ut(n,s){n&1&&(r(0,"tr")(1,"th"),m(2,"C\xF3digo"),a(),r(3,"th"),m(4,"Casa"),a(),r(5,"th"),m(6,"Parqueadero"),a(),r(7,"th"),m(8,"Tipo de pago"),a(),r(9,"th"),m(10,"Descripcion"),a(),r(11,"th"),m(12,"Monto"),a(),r(13,"th"),m(14,"Fecha de pago"),a(),r(15,"th"),m(16,"Meses pagados"),a(),r(17,"th"),m(18,"Pagado desde"),a(),r(19,"th"),m(20,"Pagado hasta"),a(),r(21,"th"),m(22,"Comprobante de pago"),a(),r(23,"th"),m(24,"Acciones"),a()())}function Ot(n,s){if(n&1&&y(0,"p-image",49),n&2){let e=p().$implicit;d("src",e.paidEvidence!=null?e.paidEvidence.fileUrl:"assets/images/No_image_available.svg")("preview",!!(e.paidEvidence!=null&&e.paidEvidence.fileUrl))}}function Lt(n,s){if(n&1){let e=w();r(0,"tr")(1,"td",45),m(2),a(),r(3,"td",46),m(4),a(),r(5,"td",46),m(6),a(),r(7,"td"),m(8),a(),r(9,"td")(10,"p-button",47),u("click",function(){let t=h(e).$implicit,c=p();return C(c.onShowDialogPanel(t.description))}),a()(),r(11,"td"),m(12),a(),r(13,"td"),m(14),A(15,"date"),a(),r(16,"td"),m(17),a(),r(18,"td"),m(19),A(20,"date"),a(),r(21,"td"),m(22),A(23,"date"),a(),r(24,"td")(25,"p-button",48),u("onClick",function(){let t=h(e).$implicit,c=p();return C(c.toogleImage(t))}),a(),f(26,Ot,1,2,"p-image",49),a(),r(27,"td")(28,"div",50)(29,"p-button",51),u("click",function(){let t=h(e).$implicit,c=p();return C(c.onViewReceipt(t))}),a(),r(30,"p-button",52),u("click",function(){let t=h(e).$implicit,c=p();return C(c.onOpenForm(t))}),a(),r(31,"p-button",53),u("click",function(){let t=h(e).$implicit,c=p();return C(c.onDeleteIncome(t))}),a()()()()}if(n&2){let e=s.$implicit,i=p();l(2),b(e.code),l(2),E(" ",e.residence.number," "),l(2),E(" ",e.parking==null?null:e.parking.code," "),l(2),b(e.type.name),l(2),d("rounded",!0)("text",!0)("raised",!0),l(2),b("$ "+i.getNumberWithDigits(e.amount)),l(2),b(B(15,23,e.paidDate,"dd/MM/yyyy")),l(3),b(e.monthsPaid),l(2),b(B(20,26,e.paidSince,"MMMM 'del' yyyy")),l(3),b(B(23,29,e.paidUntil,"MMMM 'del' yyyy")),l(3),d("rounded",!0)("label",i.showImages[e.id]?"Cerrar":"Mostrar")("text",!0)("raised",!0),l(),v(26,i.showImages[e.id]?26:-1),l(3),d("rounded",!0)("raised",!0),l(),d("rounded",!0)("raised",!0),l(),d("rounded",!0)("raised",!0)}}function Ht(n,s){if(n&1){let e=w();r(0,"div",37)(1,"p-paginator",54),u("onPageChange",function(o){h(e);let t=p(2);return C(t.onPageChange(o))}),a()()}if(n&2){let e=p(2);l(),d("rows",e.rows)("first",e.first)("totalRecords",e.totalItems)("showJumpToPageDropdown",!0)("currentPageReportTemplate","{currentPage} de {totalPages} p\xE1ginas ({totalRecords} registros)")}}function qt(n,s){n&1&&(r(0,"div",37)(1,"p",55),m(2,"No hay datos para mostrar"),a()())}function zt(n,s){if(n&1&&f(0,Ht,2,5,"div",36)(1,qt,3,0),n&2){let e=p();v(0,e.incomes.length>0?0:1)}}function jt(n,s){if(n&1){let e=w();r(0,"div",56)(1,"h2",57),m(2),a(),r(3,"p",58),m(4),a(),r(5,"div",59)(6,"p-button",60),u("onClick",function(){h(e);let o=p();return C(o.dialogVisible=!1)}),a()()()}if(n&2){let e=p();l(2),b(e.dialogTitle),l(2),E(" ",e.dialogContent," "),l(2),d("raised",!0)("rounded",!0)}}var $t=()=>({"min-width":"50rem"}),Ji=(()=>{let s=class s{constructor(){this.incomeService=x(he),this.cdr=x(we),this.messageService=x(Q),this.confirmationService=x(Ie),this.fb=x(j),this.residenceService=x(ge),this.incomeTypeSerive=x(fe),this.first=0,this.totalItems=0,this.rows=20,this.modalData={title:"",visible:!1,data:null,response:null},this.toolbarHeight=0,this.containerOptions={dataLoading:!0,showNewButton:!0,showSearch:!1},this.dialogContent="",this.dialogVisible=!1,this.dialogTitle="",this.incomes=[],this.incomeTypes=[],this.filterForm=this.fb.group({residence:[void 0],residenceToShow:[""],start:[void 0],end:[void 0],type:[void 0]}),this.showInterval=!1,this.showImages=[],this.firstResidence=0,this.dataLoading=!0,this.rowsResidence=10,this.totalItemsResidence=0,this.residences=[],this.selectedResidence=null,this.recipeViewData={income:null,penalty:null,visible:!1}}ngOnInit(){this.getIncomes()}ngAfterViewInit(){this.toolbarHeight=this.container.toolbar.getBlockableElement().clientHeight,this.cdr.detectChanges()}onOpenForm(i){this.modalData={title:i?"Editar ingreso mensual":"Nuevo ingreso mensual",visible:!0,data:i,response:null}}getIncomes(i,o,t,c,g){this.containerOptions.dataLoading=!0,this.showImages=[],this.incomeService.findAllMonthly(i,o,t,c,g).subscribe({next:_=>{let S=_.data;this.incomes=S.content,this.totalItems=S.totalItems,setTimeout(()=>{this.containerOptions.dataLoading=!1},300)},error:_=>{this.messageService.add({severity:"error",summary:"Error",detail:"Ocurri\xF3 un error al obtener los ingresos."})}})}getIncomeTypes(){this.incomeTypeSerive.findAllActiveByPeriod(de.MONTHLY).subscribe({next:i=>{this.incomeTypes=i.data},error:()=>{this.messageService.add({severity:"error",summary:"Error",detail:"Error al obtener los tipos de ingreso"})}})}openResidencePanel(i,o){i.show(o)}onRowSelectResidence(i,o){let t=i.data;this.filterForm.patchValue({residence:t}),this.filterForm.patchValue({residenceToShow:t.number}),o.hide()}onPageChangeResidence(i){this.getResidences(i.page),this.firstResidence=i.first}onSearchResidence(i){this.firstResidence=0,this.getResidences(0,i)}getResidences(i=0,o=""){this.residenceService.findAll(i,o).subscribe({next:this.handleFindAllNext.bind(this),error:this.handleError.bind(this)})}handleFindAllNext(i){this.dataLoading=!0;let o=i.data;this.residences=o.content,this.totalItemsResidence=o.totalItems,setTimeout(()=>{this.dataLoading=!1},300)}handleError(i){this.messageService.add({severity:"error",summary:"Error",detail:i.error||i.status===404?"No se encontrado la residencia":"Ha ocurrido un error"})}onFilter(){this.first=0,this.filterForm.value,this.getIncomes(this.filterForm.value.type?.id||void 0,this.filterForm.value.start?.getTime()||void 0,this.filterForm.value.end?.getTime()||void 0,this.filterForm.value.residence?.id||void 0,0)}onClearFilter(){this.filterForm.reset()}getNumberWithDigits(i){return i.toFixed(2)}onShowDialogPanel(i){this.dialogContent=i,this.dialogVisible=!0,this.dialogTitle="Descripci\xF3n"}onHandleClose(){if(this.modalData.response){let i=this.modalData.response.id;if(i){let o={description:this.modalData.response.description,amount:this.modalData.response.amount,paidDate:this.modalData.response.paidDate.getTime(),paidSince:this.modalData.response.paidSince.getTime(),paidUntil:this.modalData.response.paidUntil.getTime(),residence:this.modalData.response.residence.id,parking:this.modalData.response.parking?.id,incomeType:this.modalData.response.incomeType.id,paidEvidence:this.modalData.response.paidEvidence};this.incomeService.updateIncomeFees(i,o).subscribe({next:t=>{this.messageService.add({severity:"success",summary:"\xC9xito",detail:t.message}),this.getIncomes(),this.reset()},error:t=>{this.messageService.add({severity:"error",summary:"Error",detail:"Ocurri\xF3 un error al actualizar el ingreso."})}})}else{let o={description:this.modalData.response.description,amount:this.modalData.response.amount,paidDate:this.modalData.response.paidDate.getTime(),paidSince:this.modalData.response.paidSince.getTime(),paidUntil:this.modalData.response.paidUntil.getTime(),residence:this.modalData.response.residence.id,parking:this.modalData.response.parking?.id,incomeType:this.modalData.response.incomeType.id,paidEvidence:this.modalData.response.paidEvidence};this.incomeService.createIncomeFees(o).subscribe({next:t=>{this.messageService.add({severity:"success",summary:"\xC9xito",detail:t.message}),this.getIncomes(),this.reset()},error:t=>{console.log(t),this.messageService.add({severity:"error",summary:"Error",detail:"Ocurri\xF3 un error al crear el ingreso."})}})}}else this.reset()}onViewReceipt(i){this.recipeViewData={income:i,penalty:null,visible:!0}}onDeleteIncome(i){this.confirmationService.confirm({message:`\xBFEst\xE1s seguro de que quieres eliminar el ingreso mensual <span class="font-bold text-green-600">${i.code}</span>?
      <br>
      <p class="mt-2"><span class="font-bold">Casa: </span> ${i.residence.number}</p>

      <p class="mt-2"><span class="font-bold">Descripcion: </span> ${i.description}</p>
      <p class="font-bold text-red-600 mt-4">Esta acci\xF3n no se puede deshacer.</p>
`,header:"Confirmar eliminaci\xF3n del ingreso mensual",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",acceptIcon:"pi pi-trash mr-2",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.incomeService.deleteIncome(i.id).subscribe({next:o=>{this.messageService.add({severity:"success",summary:"\xC9xito",detail:o.message}),this.getIncomes()},error:o=>{this.messageService.add({severity:"error",summary:"Error",detail:"Ocurri\xF3 un error al eliminar el ingreso."})}})}})}onPageChange(i){this.first=i.first,this.getIncomes(this.filterForm.value.type?.id||void 0,this.filterForm.value.start?.getTime()||void 0,this.filterForm.value.end?.getTime()||void 0,this.filterForm.value.residence?.id||void 0,i.page)}reset(){this.modalData={title:"",visible:!1,data:null,response:null}}toogleImage(i){this.showImages[i.id]=!this.showImages[i.id]}};s.\u0275fac=function(o){return new(o||s)},s.\u0275cmp=P({type:s,selectors:[["app-monthly"]],viewQuery:function(o,t){if(o&1&&Se(Tt,5),o&2){let c;Te(c=Fe())&&(t.container=c.first)}},standalone:!0,features:[Ee([ve]),N],decls:33,vars:29,consts:[[1,"block","mt-2",3,"options","onOpenForm"],["container",""],["customSearcher",""],["icon","pi pi-angle-down","label","Abrir filtros","styleClass","bg-white hover:bg-gray-200",3,"rounded","raised","text","click"],["filterButton",""],["styleClass","bg-gray-700 w-11 lg:w-30rem",3,"showCloseIcon","dismissable"],["op",""],[3,"formGroup"],[1,"flex","flex-column","gap-1"],[1,"flex","gap-1","w-full"],["styleClass","p-inputtext-sm w-full","formControlName","start","dateFormat","dd/mm/yy","appendTo","body",1,"w-full",3,"placeholder"],["styleClass","p-inputtext-sm w-full","class","w-full","placeholder","Fecha pago (Fin)","formControlName","end","dateFormat","dd/mm/yy","appendTo","body"],["onLabel","Intervalo","offLabel","Fecha","styleClass","p-button-sm w-full",3,"onChange"],["appendTo","body","formControlName","type","optionLabel","name","placeholder","Seleccine un tipo","styleClass","w-full p-inputtext-sm",1,"w-full",3,"options"],[1,"flex","gap-1"],["type","text","pInputText","","placeholder","N\xB0 de casa","formControlName","residenceToShow",1,"w-full","p-inputtext-sm",3,"readOnly"],["icon","pi pi-home","severity","secondary","size","small","label","Seleccionar Residencia","styleClass","w-15rem",3,"raised","rounded","click"],[1,"flex","justify-content-between","mt-2"],["icon","pi pi-filter-slash","label","Limpiar","size","small",3,"outlined","onClick"],["icon","pi pi-filter","label","Filtrar","size","small",3,"outlined","onClick"],["styleClass","bg-gray-200 w-11 lg:w-6",3,"showCloseIcon","dismissable"],["op2",""],["pTemplate","content"],["styleClass","p-datatable-sm p-datatable-striped",3,"value","tableStyle","showJumpToPageDropdown","scrollable","scrollHeight"],["table",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],["styleClass","w-8","position","bottom",3,"visible","header","closable","draggable","visibleChange","onHide"],["ovp",""],["pTemplate","headless"],[3,"modalData","handleClose"],[3,"data"],["styleClass","p-inputtext-sm w-full","placeholder","Fecha pago (Fin)","formControlName","end","dateFormat","dd/mm/yy","appendTo","body",1,"w-full"],["pInputText","","placeholder","Buscar",1,"p-inputtext-sm","mb-2",3,"input"],["search",""],["class","flex justify-content-center"],[1,"flex","justify-content-center"],["styleClass","w-14rem h-14rem","strokeWidth","4","fill","var(--surface-ground)","animationDuration",".5s"],["styleClass","p-datatable-sm p-datatable-striped","selectionMode","single",3,"value","tableStyle","scrollable","scrollHeight","selection","selectionChange","onRowSelect","onRowUnselect"],[3,"pSelectableRow"],[1,"font-bold","text-teal-700"],[1,"text-red-700"],[3,"rows","first","totalRecords","showJumpToPageDropdown","onPageChange"],[1,"text-lg","py-2"],[1,"font-bold","text-red-600"],[1,"font-bold","text-teal-600"],["severity","help","label","Mostrar","styleClass","w-full","size","small",3,"rounded","text","raised","click"],["styleClass","w-full","size","small",3,"rounded","label","text","raised","onClick"],["styleClass","mt-4","imageClass","w-full h-5rem max-h-5rem border-round",3,"src","preview"],[1,"flex","gap-2"],["icon","pi pi-receipt","severity","secondary","label","Recibo","size","small",3,"rounded","raised","click"],["icon","pi pi-pencil","severity","warning","label","Editar","size","small",3,"rounded","raised","click"],["icon","pi pi-trash","severity","danger","label","Eliminar","size","small",3,"rounded","raised","click"],[3,"rows","first","totalRecords","showJumpToPageDropdown","currentPageReportTemplate","onPageChange"],[1,"text-lg","py-2","px-4"],[1,"bg-black-alpha-90","p-3","border-round","shadow-1"],[1,"text-teal-300","mb-2"],[1,"text-white"],[1,"flex","justify-content-end","mt-2"],["size","small","icon","pi pi-times","label","Cerrar","styleClass","ml-auto","severity","danger",3,"raised","rounded","onClick"]],template:function(o,t){if(o&1){let c=w();r(0,"app-container",0,1),u("onOpenForm",function(){return t.onOpenForm()}),r(2,"div",2)(3,"p-button",3,4),u("click",function(_){return h(c),F(6).toggle(_),t.getResidences(),C(t.getIncomeTypes())}),a(),r(5,"p-overlayPanel",5,6)(7,"form",7)(8,"div",8)(9,"div",9),y(10,"p-calendar",10),f(11,Ft,1,0,"p-calendar",11),r(12,"p-toggleButton",12),u("onChange",function(){let _;return t.showInterval=!t.showInterval,(_=t.filterForm.get("end"))==null?null:_.setValue(null)}),a()(),y(13,"p-dropdown",13),r(14,"div",14),y(15,"input",15),r(16,"p-button",16),u("click",function(_){h(c);let S=F(21);return C(t.openResidencePanel(S,_))}),a()(),r(17,"div",17)(18,"p-button",18),u("onClick",function(){return t.onClearFilter()}),a(),r(19,"p-button",19),u("onClick",function(){return t.onFilter()}),a()(),r(20,"p-overlayPanel",20,21),f(22,Bt,4,1,"ng-template",22),a()()()()(),r(23,"p-table",23,24),f(25,Ut,25,0,"ng-template",25)(26,Lt,32,32,"ng-template",26)(27,zt,2,1,"ng-template",27),a()(),r(28,"p-dialog",28,29),u("visibleChange",function(_){return t.dialogVisible=_})("onHide",function(){return t.dialogVisible=!1}),f(30,jt,7,4,"ng-template",30),a(),r(31,"app-income-fees-form",31),u("handleClose",function(){return t.onHandleClose()}),a(),y(32,"app-recipe-view",32)}o&2&&(d("options",t.containerOptions),l(3),d("rounded",!0)("raised",!0)("text",!0),l(2),d("showCloseIcon",!0)("dismissable",!1),l(2),d("formGroup",t.filterForm),l(3),d("placeholder",t.showInterval?"Fecha pago (Inicio)":"Fecha de pago"),l(),v(11,t.showInterval?11:-1),l(2),d("options",t.incomeTypes),l(2),d("readOnly",!0),l(),d("raised",!0)("rounded",!0),l(2),d("outlined",!0),l(),d("outlined",!0),l(),d("showCloseIcon",!0)("dismissable",!1),l(3),d("value",t.incomes)("tableStyle",I(28,$t))("showJumpToPageDropdown",!0)("scrollable",!0)("scrollHeight","calc(100vh - "+t.toolbarHeight+"px - 22.5rem)"),l(5),d("visible",t.dialogVisible)("header","Observaciones")("closable",!0)("draggable",!1),l(3),d("modalData",t.modalData),l(),d("data",t.recipeViewData))},dependencies:[me,le,W,se,Ue,K,Y,re,ae,ie,H,U,O,L,$,q,z,Z,X,ve,te,ee,_e,ue,He,Le,oe,ne,ze,J,G,ce,pe,qe]});let n=s;return n})();export{Ji as MonthlyComponent};
