import{a as Se}from"./chunk-MRWSOSDG.js";import{b as ue}from"./chunk-B2W5NOZS.js";import"./chunk-4JPFA7UL.js";import"./chunk-RC3HNZO7.js";import{a as xe,b as ye}from"./chunk-VBOQVG3O.js";import"./chunk-MFZZJFXN.js";import"./chunk-PLS5QCJQ.js";import{b as se}from"./chunk-UEPQK3PU.js";import{b as be}from"./chunk-DEGAUCA6.js";import{b as ge,c as fe,d as he,e as _e,i as Ce,j as ve}from"./chunk-Y6YU6P5I.js";import"./chunk-YGKFOOJ6.js";import{a as j,b as L}from"./chunk-7XV6CRBL.js";import"./chunk-LFBU7IBC.js";import{b as O}from"./chunk-6OSMVD66.js";import"./chunk-IAKHD2KQ.js";import"./chunk-KTZAFNHT.js";import"./chunk-L2YMTAJ4.js";import{e as oe,f as le}from"./chunk-SQDM7FYD.js";import"./chunk-MUUDK5FO.js";import"./chunk-GS33KFGJ.js";import{m as ce,n as U,x as B}from"./chunk-OHCSBWXS.js";import"./chunk-APKN3PFA.js";import"./chunk-X6GEXHSG.js";import{a as de,b as me}from"./chunk-MX4UQD2B.js";import"./chunk-X5B2VV3T.js";import"./chunk-ZTWDMVRM.js";import"./chunk-P7FDEGEE.js";import"./chunk-XSSXK7EZ.js";import{a as pe}from"./chunk-PXO2TRVQ.js";import"./chunk-PWTX4GCB.js";import{b as K,c as y,e as W,f as X,i as Z,j as ee,k as te,l as ie,o as re,p as ae,q as N}from"./chunk-HXGQMCX4.js";import"./chunk-TDXTCVPJ.js";import"./chunk-WTM76CTQ.js";import{d as P,e as A}from"./chunk-AXYD25ST.js";import{e as M,i as ne,n as V,o as k}from"./chunk-VBSZGXZN.js";import{$ as F,Db as D,Eb as I,Fb as G,Hb as d,Ib as S,Jb as w,Ob as T,Ta as l,Y as x,Za as Q,a as R,ab as $,b as z,da as q,db as h,ea as _,fa as C,fb as m,kb as v,mb as H,nb as J,ob as r,pb as o,qb as c,ub as b,wb as g,wc as Y,xb as u}from"./chunk-HOTPW52P.js";var Ge=["fu"];function Te(n,s){if(n&1&&c(0,"app-error-input",6),n&2){let a=u();m("message",a.getErrorMessage("fullName",a.guardForm))}}function Ne(n,s){if(n&1&&c(0,"app-error-input",6),n&2){let a=u();m("message",a.getErrorMessage("dni",a.guardForm))}}function Me(n,s){if(n&1&&c(0,"app-error-input",6),n&2){let a=u();m("message",a.getErrorMessage("phone",a.guardForm))}}function Ve(n,s){if(n&1){let a=b();r(0,"div",19),c(1,"p-image",20),r(2,"p-button",21),g("onClick",function(i){_(a);let e=u();return C(e.setImageDeleted(i))}),o()()}if(n&2){let a=u();l(),m("src",a.modalData.data.photoUrl)("preview",!0)}}function ke(n,s){if(n&1){let a=b();r(0,"p-button",22),g("onClick",function(){_(a);let i=u();return C(i.handleAccept())}),o(),r(1,"p-button",23),g("onClick",function(){_(a);let i=u();return i.modalData.response=null,C(i.handleClose.emit())}),o()}n&2&&(m("raised",!0)("rounded",!0),l(),m("raised",!0)("rounded",!0))}var we=(()=>{let s=class s{constructor(){this.modalData={visible:!1,title:"",data:null,response:null},this.handleClose=new Q,this.fb=x(ie),this.confirmationService=x(M),this.guardForm=this.fb.group({id:[""],fullName:["",y.required],dni:["",[y.required,y.minLength(8),y.maxLength(15)]],phone:["",[y.required,y.pattern("^[0-9]*$")]],photo:[new File([],"")],isPhotoUpdated:[!1]}),this.deleteImage=!1,this.getErrorMessage=me}ngOnChanges(t){t.modalData&&(this.fileUpload&&this.fileUpload.clear(),this.guardForm.reset(),this.deleteImage=!1,this.modalData.data&&this.guardForm.patchValue(this.modalData.data))}handleAccept(){this.guardForm.valid?(this.modalData.response=z(R({},this.guardForm.value),{isPhotoUpdated:this.deleteImage}),this.handleClose.emit()):Object.values(this.guardForm.controls).forEach(t=>{t.invalid&&(t.markAsDirty(),t.updateValueAndValidity({onlySelf:!0}))})}setImage(t){this.guardForm.patchValue({photo:t.files[0]}),this.deleteImage=!0}setImageDeleted(t){this.confirmationService.confirm({message:"\xBFEst\xE1 seguro que desea eliminar la foto actual, el cambio se aplicara cuando acepte el formulario?",target:t.target,header:"Confirmar eliminaci\xF3n de imagen",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",acceptIcon:"pi pi-trash mr-2",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.guardForm.patchValue({photo:new File([],"")}),this.deleteImage=!0}})}};s.\u0275fac=function(i){return new(i||s)},s.\u0275cmp=F({type:s,selectors:[["app-guard-form"]],viewQuery:function(i,e){if(i&1&&D(Ge,5),i&2){let p;I(p=G())&&(e.fileUpload=p.first)}},inputs:{modalData:"modalData"},outputs:{handleClose:"handleClose"},standalone:!0,features:[q,T],decls:28,vars:14,consts:[["styleClass","w-10 md:w-8 lg:w-6",3,"header","visible","modal","draggable","resizable","visibleChange","onHide"],[1,"pt-4","grid","row-gap-3",3,"formGroup"],[1,"col-12"],[1,"p-float-label"],["pInputText","","id","fullName","formControlName","fullName","autocomplete","off","type","text",1,"w-full"],["for","fullName"],[3,"message"],[1,"col-6"],["pInputText","","id","dni","formControlName","dni","autocomplete","off","type","text",1,"w-full"],["for","dni"],["id","phone","mask","9999999999","formControlName","phone","styleClass","w-full",3,"autoClear"],["for","phone"],[1,"col-12","lg:col-7"],[1,"text-xs","text-gray-500","ml-3","mb-2","block","p-0","mt-0"],["mode","advanced","chooseLabel","Fotograf\xEDa","accept","image/*","chooseStyleClass","p-button-raised p-button-secondary w-full","removeStyleClass","p-button-raised p-button-danger p-button-rounded",3,"maxFileSize","showUploadButton","showCancelButton","onSelect"],["fu",""],[1,"col-12","lg:col-5"],["class","flex gap-2 justify-content-between align-items-end"],["pTemplate","footer"],[1,"flex","gap-2","justify-content-between","align-items-end"],["height","180","appendTo","body",3,"src","preview"],["label","Eliminar imagen","size","small","icon","pi pi-trash","severity","danger",3,"onClick"],["label","Aceptar","severity","success",3,"raised","rounded","onClick"],["label","Cancelar","severity","danger",3,"raised","rounded","onClick"]],template:function(i,e){if(i&1&&(r(0,"p-dialog",0),g("visibleChange",function(f){return e.modalData.visible=f})("onHide",function(){return e.modalData.response=null,e.handleClose.emit()}),r(1,"form",1)(2,"div",2)(3,"span",3),c(4,"input",4),r(5,"label",5),d(6,"Nombre completo"),o()(),h(7,Te,1,1,"app-error-input",6),o(),r(8,"div",7)(9,"span",3),c(10,"input",8),r(11,"label",9),d(12,"D.N.I."),o()(),h(13,Ne,1,1,"app-error-input",6),o(),r(14,"div",7)(15,"span",3),c(16,"p-inputMask",10),r(17,"label",11),d(18,"Tel\xE9fono"),o()(),h(19,Me,1,1,"app-error-input",6),o(),r(20,"div",12)(21,"label",13),d(22,"Fotograf\xEDa del guardia:"),o(),r(23,"p-fileUpload",14,15),g("onSelect",function(f){return e.setImage(f)}),o()(),r(25,"div",16),h(26,Ve,3,2,"div",17),o()(),h(27,ke,2,4,"ng-template",18),o()),i&2){let p,f,E;m("header",e.modalData.title)("visible",e.modalData.visible)("modal",!0)("draggable",!1)("resizable",!1),l(),m("formGroup",e.guardForm),l(6),v(7,(p=e.guardForm.get("fullName"))!=null&&p.invalid&&((p=e.guardForm.get("fullName"))!=null&&p.dirty)?7:-1),l(6),v(13,(f=e.guardForm.get("dni"))!=null&&f.invalid&&((f=e.guardForm.get("dni"))!=null&&f.dirty)?13:-1),l(3),m("autoClear",!1),l(3),v(19,(E=e.guardForm.get("phone"))!=null&&E.invalid&&((E=e.guardForm.get("phone"))!=null&&E.dirty)?19:-1),l(4),m("maxFileSize",5e6)("showUploadButton",!1)("showCancelButton",!1),l(3),v(26,e.modalData.data!=null&&e.modalData.data.photoUrl&&!e.deleteImage?26:-1)}},dependencies:[A,P,V,le,oe,de,N,ae,ue,U,Z,K,W,X,O,re,ee,te,k,B,_e,he,ye,xe,L,j]});let n=s;return n})();var Pe=["container"],Ae=(n,s)=>s.id;function Ue(n,s){if(n&1){let a=b();r(0,"p-button",37),g("onClick",function(){_(a);let i=u().$implicit,e=u(3);return C(e.onDelete(i))}),o()}n&2&&m("rounded",!0)("raised",!0)}function Be(n,s){if(n&1){let a=b();r(0,"p-button",38),g("onClick",function(){_(a);let i=u().$implicit,e=u(3);return C(e.onReactivate(i))}),o()}n&2&&m("rounded",!0)("raised",!0)}function Oe(n,s){if(n&1){let a=b();r(0,"div",8)(1,"div",9)(2,"div",10)(3,"div",11),c(4,"p-image",12),r(5,"div",13)(6,"p-button",14),g("onClick",function(){let e=_(a).$implicit,p=u(3);return C(p.openForm(e))}),o(),h(7,Ue,1,2,"p-button",15)(8,Be,1,2),o()(),r(9,"div",16),c(10,"div",17),r(11,"div",18)(12,"p",19),d(13," DNI: "),r(14,"span",20),d(15),o()()(),r(16,"div",21)(17,"div",18)(18,"p"),d(19,"Nombre Completo:"),o(),r(20,"p",22),d(21),o()(),r(22,"div",18)(23,"p"),d(24,"Tel\xE9fono:"),o(),r(25,"p",22),d(26),o()()(),r(27,"div",18)(28,"p",19),d(29," Estado: "),r(30,"span",23),d(31),o()()(),r(32,"div",18)(33,"p",24),d(34,"Actividades"),o(),r(35,"div",25)(36,"div",26)(37,"div",27)(38,"p",28),c(39,"span",29),d(40," Pendientes: "),o(),r(41,"p",30),d(42),o()(),r(43,"div",27)(44,"p",28),c(45,"span",31),d(46," En progreso: "),o(),r(47,"p",32),d(48),o()()(),r(49,"div",26)(50,"div",27)(51,"p",28),c(52,"span",33),d(53," Terminadas: "),o(),r(54,"p",34),d(55),o()(),r(56,"div",27)(57,"p",28),c(58,"span",35),d(59," Incompletas: "),o(),r(60,"p",36),d(61),o()()()()()()()()()}if(n&2){let a=s.$implicit;l(4),m("src",a.photoUrl||"assets/images/No_image_available.svg")("preview",!!a.photoUrl),l(2),m("raised",!0)("rounded",!0),l(),v(7,a.active?7:8),l(8),S(a.dni),l(6),S(a.fullName),l(5),S(a.phone),l(4),m("ngClass",a.active?"bg-green-500":"bg-red-500"),l(),S(a.active?"ACTIVO":"INACTIVO"),l(11),w(" ",a.pendingActivities," "),l(6),w(" ",a.inProgressActivities," "),l(7),w(" ",a.finishedActivities," "),l(6),w(" ",a.incompleteActivities," ")}}function je(n,s){if(n&1&&(r(0,"div",7),H(1,Oe,62,14,"div",39,Ae),o()),n&2){let a=u(2);l(),J(a.guards)}}function Le(n,s){if(n&1){let a=b();r(0,"div",3)(1,"p-paginator",4),g("onPageChange",function(i){_(a);let e=u();return C(e.onPageChange(i))}),o()(),r(2,"p-dataView",5),h(3,je,3,0,"ng-template",6),o()}if(n&2){let a=u();l(),m("rows",a.rows)("first",a.first)("currentPageReportTemplate","{currentPage} de {totalPages} p\xE1ginas ({totalRecords} registros)")("showJumpToPageDropdown",!0)("totalRecords",a.totalItems),l(),m("value",a.guards)}}function Re(n,s){n&1&&(r(0,"div",40)(1,"p",41),d(2,"No hay datos para mostrar"),o()())}var Lt=(()=>{let s=class s extends pe{constructor(){super(),this.guards=[],this.first=0,this.rows=10,this.totalItems=0,this.modalData={visible:!1,title:"",data:null,response:null},this.containerOptions={dataLoading:!0,showNewButton:!0,showSearch:!0},this.guardService=x(Se),this.messageService=x(ne),this.confirmationService=x(M)}ngOnInit(){super.ngOnInit(),this.getGuards()}getGuards(t,i){this.guardService.findAllGuards(t,i).subscribe({next:this.handleFindAllNext.bind(this),error:this.handleFindAllError.bind(this)})}handleFindAllNext(t){this.containerOptions.dataLoading=!0;let i=t.data;this.guards=i.content,this.totalItems=i.totalItems,setTimeout(()=>{this.containerOptions.dataLoading=!1},300)}handleFindAllError(t){this.messageService.add({severity:"error",summary:"Error",detail:"Error al obtener los guardias"})}openForm(t){this.modalData={visible:!0,title:t?"Editar guardia":"Crear guardia",data:t,response:null}}onSearch(t){this.getGuards(t)}onPageChange(t){this.first=t.first,this.getGuards("",t.page)}getHandleClose(){if(this.modalData.response){let t=this.modalData.response.id;if(t){let i={fullName:this.modalData.response.fullName,dni:this.modalData.response.dni,phone:this.modalData.response.phone,photo:this.modalData.response.photo,isPhotoUpdated:this.modalData.response.isPhotoUpdated};this.guardService.updateGuard(i,t).subscribe({next:e=>{this.reset(),this.getGuards(),this.messageService.add({severity:"success",summary:"Guardia actualizado",detail:e.message})},error:e=>{this.messageService.add({severity:"error",summary:"Error",detail:e.error??"Error al editar guardia"})}})}else{let i={fullName:this.modalData.response.fullName,dni:this.modalData.response.dni,phone:this.modalData.response.phone,photo:this.modalData.response.photo};this.guardService.creteGuard(i).subscribe({next:e=>{this.reset(),this.getGuards(),this.messageService.add({severity:"success",summary:"Guardia creado",detail:e.message})},error:e=>{this.messageService.add({severity:"error",summary:"Error",detail:e.error??"Error al crear guardia"})}})}}else this.reset()}reset(){this.modalData={visible:!1,title:"",data:null,response:null}}onDelete(t){this.confirmationService.confirm({message:`\xBFEst\xE1s seguro de que quieres inhabilitar al guardia <span class="font-bold text-green-600">${t.fullName}</span>?`,header:"Confirmar inhabilitaci\xF3n del guardia",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",acceptIcon:"pi pi-trash mr-2",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.guardService.deleteGuard(t.id).subscribe({next:i=>{this.messageService.add({severity:"success",summary:"Guardia inhabilitado",detail:i.message}),this.getGuards()},error:i=>{this.messageService.add({severity:"error",summary:"Error",detail:"Error al inhabilitar guardia"})}})}})}onReactivate(t){this.confirmationService.confirm({message:`\xBFEst\xE1s seguro de que quieres habilitar al guardia <span class="font-bold text-green-600">${t.fullName}</span>?`,header:"Confirmar habilitaci\xF3n del guardia",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-success",rejectButtonStyleClass:"p-button-secondary",acceptIcon:"pi pi-check mr-2",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.guardService.reactivateGuard(t.id).subscribe({next:i=>{this.messageService.add({severity:"success",summary:"Guardia habilitado",detail:i.message}),this.getGuards()},error:i=>{this.messageService.add({severity:"error",summary:"Error",detail:"Error al habilitar guardia"})}})}})}ngAfterViewInit(){}};s.\u0275fac=function(i){return new(i||s)},s.\u0275cmp=F({type:s,selectors:[["app-guards"]],viewQuery:function(i,e){if(i&1&&D(Pe,5),i&2){let p;I(p=G())&&(e.containerComponent=p.first)}},standalone:!0,features:[$,T],decls:5,vars:3,consts:[[1,"block","mt-2",3,"options","onOpenForm","onSearch"],["container",""],[3,"modalData","handleClose"],[1,"flex","justify-content-center","mb-2"],[1,"shadow-1","w-full",3,"rows","first","currentPageReportTemplate","showJumpToPageDropdown","totalRecords","onPageChange"],["layout","grid","styleClass","w-full",3,"value"],["pTemplate","grid"],[1,"grid","grid-nogutter","bg-teal-50"],[1,"col-12","lg:col-6","xl:col-4","p-2"],[1,"shadow-2","surface-border","border-round","p-2","bg-white","h-full"],[1,"flex","gap-2"],[1,"w-10rem","flex","flex-column","align-items-center"],["imageClass","w-full h-9rem max-h-9rem border-round","styleClass","mb-2",3,"src","preview"],[1,"flex","flex-column","gap-2"],["icon","pi pi-pencil","size","small","severity","warning","label","Editar","styleClass","w-full",3,"raised","rounded","onClick"],["icon","pi pi-trash","severity","danger","size","small","label","Inhabilitar",3,"rounded","raised"],[1,"flex","w-full","flex-column","justify-content-between","relative"],[1,"guard-card-content"],[1,"text-sm"],[1,"text-right"],[1,"font-bold","text-indigo-600",2,"letter-spacing","2px"],[1,"flex","justify-content-between"],[1,"font-bold"],[1,"text-white","py-1","px-2","border-round","text-center","shadow-1",3,"ngClass"],[1,"text-center","mb-2"],[1,"flex","justify-content-evenly"],[1,"flex","flex-column"],[1,"w-full"],[1,"text-xs","inline-flex","gap-1"],[1,"block","w-1rem","h-1rem","bg-gray-500","border-circle"],[1,"text-center","text-lg","font-bold","text-gray-500"],[1,"block","w-1rem","h-1rem","bg-blue-500","border-circle"],[1,"text-center","text-lg","font-bold","text-blue-500"],[1,"block","w-1rem","h-1rem","bg-green-500","border-circle"],[1,"text-center","text-lg","font-bold","text-green-500"],[1,"block","w-1rem","h-1rem","bg-red-500","border-circle"],[1,"text-center","text-lg","font-bold","text-red-500"],["icon","pi pi-trash","severity","danger","size","small","label","Inhabilitar",3,"rounded","raised","onClick"],["icon","pi pi-undo","severity","help","size","small","label","Reactivar",3,"rounded","raised","onClick"],["class","col-12 lg:col-6 xl:col-4 p-2"],[1,"flex","justify-content-center","w-full"],[1,"text-lg","py-2","px-4"]],template:function(i,e){i&1&&(r(0,"app-container",0,1),g("onOpenForm",function(){return e.openForm()})("onSearch",function(f){return e.onSearch(f)}),h(2,Le,4,6)(3,Re,3,0),o(),r(4,"app-guard-form",2),g("handleClose",function(){return e.getHandleClose()}),o()),i&2&&(m("options",e.containerOptions),l(2),v(2,e.guards.length>0?2:3),l(2),m("modalData",e.modalData))},dependencies:[A,P,V,be,N,U,ce,O,k,B,Ce,Y,fe,ge,L,j,se,we,ve],styles:['.guard-card-content[_ngcontent-%COMP%]{position:absolute;inset:0;margin:auto;opacity:.05;background-image:url("./media/SEGURIDAD-MJHYANND.png")!important;background-size:100% 33.1%}']});let n=s;return n})();export{Lt as GuardsComponent};
