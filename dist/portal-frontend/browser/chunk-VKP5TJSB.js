import{a as W}from"./chunk-4JPFA7UL.js";import"./chunk-RC3HNZO7.js";import{a as X}from"./chunk-QFJMZTM2.js";import"./chunk-VBOQVG3O.js";import{a as O,b as H}from"./chunk-MFZZJFXN.js";import"./chunk-YODMGMDB.js";import"./chunk-PLS5QCJQ.js";import{a as G,b as K}from"./chunk-DEGAUCA6.js";import{n as J}from"./chunk-U446ZUSE.js";import"./chunk-7XV6CRBL.js";import"./chunk-LFBU7IBC.js";import"./chunk-6OSMVD66.js";import"./chunk-IAKHD2KQ.js";import"./chunk-KTZAFNHT.js";import"./chunk-L2YMTAJ4.js";import"./chunk-SQDM7FYD.js";import"./chunk-MUUDK5FO.js";import"./chunk-GS33KFGJ.js";import{m as L,n as z,q as Q,x as q}from"./chunk-OHCSBWXS.js";import"./chunk-APKN3PFA.js";import"./chunk-X6GEXHSG.js";import"./chunk-MX4UQD2B.js";import"./chunk-X5B2VV3T.js";import"./chunk-ZTWDMVRM.js";import"./chunk-P7FDEGEE.js";import"./chunk-XSSXK7EZ.js";import{a as j}from"./chunk-PXO2TRVQ.js";import"./chunk-PWTX4GCB.js";import"./chunk-HXGQMCX4.js";import"./chunk-TDXTCVPJ.js";import"./chunk-WTM76CTQ.js";import{d as M,e as $}from"./chunk-AXYD25ST.js";import{e as k,i as N,n as B}from"./chunk-VBSZGXZN.js";import{$ as E,Bc as A,Db as D,Eb as F,Fb as R,Hb as o,Ib as u,Ob as P,Pb as V,Ta as c,Ua as f,Wa as w,Yb as S,_b as b,ab as U,db as C,ea as _,fa as g,fb as m,kb as x,mb as T,nb as I,ob as r,pb as n,qb as y,ub as v,wb as h,xb as p}from"./chunk-HOTPW52P.js";var Z=["container"];function ee(s,l){s&1&&(r(0,"tr")(1,"th"),o(2,"C\xE9dula"),n(),r(3,"th"),o(4,"Nombres"),n(),r(5,"th"),o(6,"Apellidos"),n(),r(7,"th"),o(8,"Correo"),n(),r(9,"th"),o(10,"Tel\xE9fono"),n(),r(11,"th"),o(12,"Activo"),n(),r(13,"th"),o(14,"Roles"),n(),r(15,"th"),o(16,"Fecha de creaci\xF3n"),n(),r(17,"th"),o(18,"Fecha de actualizaci\xF3n"),n(),r(19,"th"),o(20,"Acciones"),n()())}var te=(s,l)=>l.id;function ie(s,l){if(s&1&&y(0,"p-chip",7),s&2){let i=l.$implicit,e=p(2);m("label",e.getSpanishRole(i.name))("styleClass",e.getColorRole(i.name,"text-xs uppercase shadow-3"))}}function re(s,l){if(s&1){let i=v();r(0,"p-button",12),h("onClick",function(){_(i);let t=p().$implicit,a=p();return g(a.onDelete(t))}),n()}s&2&&m("rounded",!0)("raised",!0)}function ne(s,l){if(s&1){let i=v();r(0,"p-button",13),h("onClick",function(){_(i);let t=p().$implicit,a=p();return g(a.onReactivate(t))}),n()}s&2&&m("rounded",!0)("raised",!0)}function ae(s,l){if(s&1){let i=v();r(0,"tr")(1,"td"),o(2),n(),r(3,"td"),o(4),n(),r(5,"td"),o(6),n(),r(7,"td"),o(8),n(),r(9,"td"),o(10),n(),r(11,"td"),y(12,"p-chip",7),n(),r(13,"td")(14,"div",8),T(15,ie,1,2,"p-chip",7,te),n()(),r(17,"td"),o(18),S(19,"date"),n(),r(20,"td"),o(21),S(22,"date"),n(),r(23,"td")(24,"div",9)(25,"p-button",10),h("onClick",function(){let a=_(i).$implicit,d=p();return g(d.openForm(a))}),n(),C(26,re,1,2,"p-button",11)(27,ne,1,2),n()()()}if(s&2){let i=l.$implicit;c(2),u(i.dni),c(2),u(i.names),c(2),u(i.surnames),c(2),u(i.email),c(2),u(i.phone),c(2),m("label",i.active?"Si":"No")("styleClass",i.active?"bg-blue-100 text-blue-600 text-sm shadow-3":"bg-red-100 text-red-600 text-sm shadow-3"),c(3),I(i.roles),c(3),u(b(19,12,i.createdAt,"dd/MM/yyyy")),c(3),u(b(22,15,i.updatedAt,"dd/MM/yyyy")),c(4),m("rounded",!0)("raised",!0),c(),x(26,i.active?26:27)}}function se(s,l){if(s&1){let i=v();r(0,"div",15)(1,"p-paginator",16),h("onPageChange",function(t){_(i);let a=p(2);return g(a.onPageChange(t))}),n()()}if(s&2){let i=p(2);c(),m("rows",i.rows)("first",i.first)("totalRecords",i.totalItems)("showJumpToPageDropdown",!0)("currentPageReportTemplate","{currentPage} de {totalPages} p\xE1ginas ({totalRecords} registros)")}}function oe(s,l){s&1&&(r(0,"div",15)(1,"p",17),o(2,"No hay datos para mostrar"),n()())}function le(s,l){if(s&1&&C(0,se,2,5,"div",14)(1,oe,3,0),s&2){let i=p();x(0,i.users.length>0?0:1)}}var ce=()=>({"min-width":"50rem"}),De=(()=>{let l=class l extends j{constructor(e,t,a,d){super(),this.userService=e,this.messageService=t,this.confirmationService=a,this.cdr=d,this.first=0,this.rows=10,this.totalItems=0,this.summary="",this.users=[],this.modalData={visible:!1,title:"",data:null,response:null},this.containerOptions={showNewButton:!0,showSearch:!0,dataLoading:!0},this.toolbarHeight=0,this.getSpanishRole=O,this.getColorRole=H}ngOnInit(){super.ngOnInit(),this.getUsers()}handleFindAllNext(e){this.containerOptions.dataLoading=!0;let t=e.data;this.users=t.content,this.totalItems=t.totalItems,setTimeout(()=>{this.containerOptions.dataLoading=!1},300)}handleFindAllError(e){this.messageService.add({severity:"error",summary:"Error",detail:"Error al obtener los usuarios"})}getUsers(e=0,t=""){this.userService.findAll(e,t).subscribe({next:this.handleFindAllNext.bind(this),error:this.handleFindAllError.bind(this)})}onDelete(e){this.confirmationService.confirm({message:`\xBFEst\xE1 seguro que desea inactivar el usuario
                <span class="font-bold">${e.names} ${e.surnames}</span>
                con DNI: <span class="text-green-600 font-bold">${e.dni}</span>?`,header:"Confirmar inactivaci\xF3n",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",acceptIcon:"pi pi-trash mr-2",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.deleteUser(e)}})}onReactivate(e){this.confirmationService.confirm({message:`\xBFEst\xE1 seguro que desea reactivar el usuario
                <span class="font-bold">${e.names} ${e.surnames}</span>
                con DNI: <span class="text-green-600 font-bold">${e.dni}</span>?`,header:"Confirmar reactivaci\xF3n",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-success",rejectButtonStyleClass:"p-button-secondary",acceptIcon:"pi pi-check mr-2",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.reactivateUser(e)}})}onSearch(e){this.getUsers(0,e)}openForm(e){this.modalData={visible:!0,title:e?.id?"Editar usuario":"Nuevo usuario",data:e,response:null}}onPageChange(e){this.first=e.first;let t=this.containerComponent.searchInput.nativeElement.value;this.getUsers(e.page,t)}reactivateUser(e){this.userService.reactivate(e.id).subscribe({next:()=>{this.first=0,this.messageService.add({severity:"success",summary:"\xC9xito",detail:"Usuario reactivado correctamente"}),this.getUsers()},error:t=>{t.status===404?this.messageService.add({severity:"error",summary:"Error",detail:"El usuario no existe"}):this.messageService.add({severity:"error",summary:"Error",detail:"Error al reactivar el usuario"})}})}deleteUser(e){this.userService.delete(e.id).subscribe({next:()=>{this.first=0,this.messageService.add({severity:"success",summary:"\xC9xito",detail:"Usuario inactivado correctamente"}),this.getUsers()},error:t=>{t.status===404?this.messageService.add({severity:"error",summary:"Error",detail:"El usuario no existe"}):this.messageService.add({severity:"error",summary:"Error",detail:"Error al inactivar el usuario"})}})}reset(){this.modalData={visible:!1,title:"",data:null,response:null},this.first=0}getHandleClose(){if(this.modalData.response){let e=this.modalData.response.id;if(e){let t=this.modalData.response;this.userService.update(e,t).subscribe({next:a=>{this.messageService.add({severity:"success",summary:"\xC9xito",detail:a.message}),this.reset(),this.getUsers()},error:a=>{this.messageService.add({severity:"error",summary:"Error",detail:a.error??"Acci\xF3n no permitida"}),this.modalData.response=null}})}else{let t=this.modalData.response;this.userService.create(t).subscribe({next:a=>(this.messageService.add({severity:"success",summary:"\xC9xito",detail:a.message}),this.reset(),this.getUsers()),error:a=>{this.messageService.add({severity:"error",summary:"Error",detail:a.error??"Acci\xF3n no permitida"}),this.modalData.response=null}})}}else this.reset()}ngAfterViewInit(){this.toolbarHeight=this.containerComponent.toolbar.getBlockableElement().clientHeight,this.cdr.detectChanges()}};l.\u0275fac=function(t){return new(t||l)(f(X),f(N),f(k),f(w))},l.\u0275cmp=E({type:l,selectors:[["app-users"]],viewQuery:function(t,a){if(t&1&&D(Z,5),t&2){let d;F(d=R())&&(a.containerComponent=d.first)}},standalone:!0,features:[U,P],decls:7,vars:7,consts:[[3,"options","onOpenForm","onSearch"],["container",""],["styleClass","p-datatable-sm p-datatable-striped",3,"value","tableStyle","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],[3,"modalData","handleClose"],[3,"label","styleClass"],[1,"flex","gap-2","flex-wrap"],[1,"flex","gap-1"],["icon","pi pi-pencil","label","Editar","severity","warning","size","small",3,"rounded","raised","onClick"],["icon","pi pi-trash","severity","danger","label","Inactivar","size","small",3,"rounded","raised"],["icon","pi pi-trash","severity","danger","label","Inactivar","size","small",3,"rounded","raised","onClick"],["icon","pi pi-undo","severity","help","label","Reactivar","size","small",3,"rounded","raised","onClick"],["class","flex justify-content-center"],[1,"flex","justify-content-center"],[3,"rows","first","totalRecords","showJumpToPageDropdown","currentPageReportTemplate","onPageChange"],[1,"text-lg","py-2","px-4"]],template:function(t,a){t&1&&(r(0,"app-container",0,1),h("onOpenForm",function(){return a.openForm()})("onSearch",function(Y){return a.onSearch(Y)}),r(2,"p-table",2),C(3,ee,21,0,"ng-template",3)(4,ae,28,18,"ng-template",4)(5,le,2,1,"ng-template",5),n()(),r(6,"app-user-form",6),h("handleClose",function(){return a.getHandleClose()}),n()),t&2&&(m("options",a.containerOptions),c(2),m("value",a.users)("tableStyle",V(6,ce))("scrollable",!0)("scrollHeight","calc(100vh - "+a.toolbarHeight+"px - 13.5rem)"),c(4),m("modalData",a.modalData))},dependencies:[W,J,q,Q,B,K,G,$,M,z,L,A]});let s=l;return s})();export{De as UsersComponent};
