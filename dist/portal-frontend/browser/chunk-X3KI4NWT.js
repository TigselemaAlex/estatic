import{a as Xe,b as Ye}from"./chunk-ELGNCYQ4.js";import{a as et,b as tt}from"./chunk-6T5XIYJ5.js";import{a as it,b as nt}from"./chunk-X2N4LBF3.js";import{a as ve}from"./chunk-MRWSOSDG.js";import{a as Re,b as ke}from"./chunk-THPYG6QI.js";import{a as Le}from"./chunk-FQDKIOII.js";import{a as ae,b as re}from"./chunk-B2W5NOZS.js";import{b as D,e as he,f as qe,g as ue,h as Ce}from"./chunk-WY5L5QV5.js";import"./chunk-WYL7NH4F.js";import{a as Ke}from"./chunk-QFJMZTM2.js";import{b as Ze}from"./chunk-VBOQVG3O.js";import{e as Ue,j as We}from"./chunk-Y6YU6P5I.js";import{c as Je}from"./chunk-YGKFOOJ6.js";import{b as Qe}from"./chunk-7XV6CRBL.js";import{a as ze,b as $e}from"./chunk-LFBU7IBC.js";import{a as _e,b as ge}from"./chunk-6OSMVD66.js";import"./chunk-IAKHD2KQ.js";import"./chunk-KTZAFNHT.js";import"./chunk-L2YMTAJ4.js";import{e as H,f as q}from"./chunk-SQDM7FYD.js";import"./chunk-MUUDK5FO.js";import"./chunk-GS33KFGJ.js";import{h as He,k as oe,l as le,m as se,n as de,q as me,r as pe,x as ce}from"./chunk-OHCSBWXS.js";import"./chunk-APKN3PFA.js";import"./chunk-X6GEXHSG.js";import{a as Oe,b as Be}from"./chunk-MX4UQD2B.js";import"./chunk-X5B2VV3T.js";import"./chunk-ZTWDMVRM.js";import{a as Ie}from"./chunk-P7FDEGEE.js";import"./chunk-XSSXK7EZ.js";import{a as je}from"./chunk-PXO2TRVQ.js";import"./chunk-PWTX4GCB.js";import{b as U,c as F,e as J,f as W,i as Z,j as K,k as X,l as Y,o as ee,p as te,q as ie}from"./chunk-HXGQMCX4.js";import{a as Ne}from"./chunk-TDXTCVPJ.js";import"./chunk-WTM76CTQ.js";import{c as B,d as j,e as L}from"./chunk-AXYD25ST.js";import{e as Pe,i as ne,n as O,o as Me}from"./chunk-VBSZGXZN.js";import{$ as V,Bc as Q,Db as I,Eb as N,Fb as P,Gb as T,Hb as d,Ib as S,Jb as G,Ka as $,Lc as Ge,Nc as Ve,Ob as M,Pb as E,S as we,Ta as s,Ub as De,Wa as Ae,Y as w,Yb as R,Za as Te,_b as k,a as be,ab as Ee,b as Se,da as z,db as g,ea as h,fa as C,fb as m,jb as fe,kb as x,ob as n,pb as r,qb as u,ub as b,wb as _,wc as Fe,xb as p}from"./chunk-HOTPW52P.js";var at=(()=>{let l=class l{constructor(){this.END_POINT=Ne.API_URL+"/protected/guard-activity",this.http=w(Ve)}findAll(i,o,a,c,f,v,A){let y=new Ge;return i&&(y=y.append("subject",i)),o&&(y=y.append("start",o.getTime().toString())),a&&(y=y.append("end",a.getTime().toString())),c&&(y=y.append("guard",c.toString())),f&&(y=y.append("createdBy",f.toString())),v&&(y=y.append("status",v.toString())),A&&(y=y.append("page",A.toString())),this.http.get(this.END_POINT,{params:y})}createGuardActivity(i){return this.http.post(this.END_POINT,i)}updateGuardActivity(i,o){return this.http.put(`${this.END_POINT}/${i}`,o)}deleteGuardActivity(i){return this.http.delete(`${this.END_POINT}/${i}`)}};l.\u0275fac=function(o){return new(o||l)},l.\u0275prov=we({token:l,factory:l.\u0275fac,providedIn:"root"});let e=l;return e})();var ft=["search"];function ht(e,l){if(e&1&&u(0,"app-error-input",6),e&2){let t=p();m("message",t.getErrorMessage("subject",t.guardActivityForm))}}function Ct(e,l){if(e&1&&u(0,"app-error-input",6),e&2){let t=p();m("message",t.getErrorMessage("guardToShow",t.guardActivityForm))}}function yt(e,l){if(e&1&&u(0,"app-error-input",6),e&2){let t=p();m("message",t.getErrorMessage("description",t.guardActivityForm))}}function xt(e,l){if(e&1&&u(0,"app-error-input",6),e&2){let t=p();m("message",t.getErrorMessage("startDate",t.guardActivityForm))}}function bt(e,l){if(e&1&&u(0,"app-error-input",6),e&2){let t=p();m("message",t.getErrorMessage("endDate",t.guardActivityForm))}}function St(e,l){if(e&1&&(n(0,"div",32),u(1,"div",33),n(2,"div"),d(3),r()()),e&2){let t=l.$implicit,i=p(2);s(),m("ngClass",i.getRowCellClass(t.value)),s(2),S(t.label)}}function wt(e,l){if(e&1&&u(0,"app-error-input",6),e&2){let t=p(2);m("message",t.getErrorMessage("status",t.guardActivityForm))}}function At(e,l){if(e&1&&(n(0,"div",25)(1,"label",26),d(2,"Estado"),r(),n(3,"p-listbox",27),g(4,St,4,2,"ng-template",28),r(),g(5,wt,1,1,"app-error-input",6),r(),n(6,"div",29)(7,"span",3),u(8,"textarea",30),n(9,"label",31),d(10,"Observaci\xF3n"),r()()()),e&2){let t=p(),i;s(3),m("options",t.statusList)("emptyMessage","No hay datos para mostrar"),s(2),x(5,(i=t.guardActivityForm.get("status"))!=null&&i.invalid&&((i=t.guardActivityForm.get("status"))!=null&&i.dirty)?5:-1)}}function Tt(e,l){e&1&&(n(0,"div",37),u(1,"p-progressSpinner",38),r())}function Et(e,l){e&1&&(n(0,"tr")(1,"th"),d(2,"Foto"),r(),n(3,"th"),d(4,"Nombre completo"),r(),n(5,"th"),d(6,"D.N.I."),r()())}function Dt(e,l){if(e&1&&(n(0,"tr",43)(1,"td"),u(2,"img",44),r(),n(3,"td"),d(4),r(),n(5,"td"),d(6),r()()),e&2){let t=l.$implicit,i=l.$implicit;m("pSelectableRow",i),s(2),m("src",t.photoUrl,$),s(2),S(t.fullName),s(2),S(t.dni)}}function Ft(e,l){if(e&1){let t=b();n(0,"div",37)(1,"p-paginator",45),_("onPageChange",function(o){h(t);let a=p(4);return C(a.onPageChange(o))}),r()()}if(e&2){let t=p(4);s(),m("rows",t.rows)("first",t.first)("totalRecords",t.totalItems)("currentPageReportTemplate","{currentPage} de {totalPages} p\xE1ginas ({totalRecords} registros)")("showJumpToPageDropdown",!0)}}function Gt(e,l){e&1&&(n(0,"div",37)(1,"p",46),d(2,"No hay datos para mostrar"),r()())}function Vt(e,l){if(e&1&&g(0,Ft,2,5,"div",36)(1,Gt,3,0),e&2){let t=p(3);x(0,t.guards.length>0?0:1)}}var It=()=>({"min-width":"30rem"});function Nt(e,l){if(e&1){let t=b();n(0,"p-table",39),_("selectionChange",function(o){h(t);let a=p(2);return C(a.selectedGuard=o)})("onRowSelect",function(o){h(t);let a=p(2),c=T(37);return C(a.onRowSelect(o,c))}),g(1,Et,7,0,"ng-template",40)(2,Dt,7,4,"ng-template",41)(3,Vt,2,1,"ng-template",42),r()}if(e&2){let t=p(2);m("value",t.guards)("tableStyle",E(5,It))("scrollable",!0)("scrollHeight","30vh")("selection",t.selectedGuard)}}function Pt(e,l){if(e&1){let t=b();n(0,"input",34,35),_("input",function(){h(t);let o=T(1),a=p();return C(a.onSearchGuard(o.value))}),r(),g(2,Tt,2,0,"div",36)(3,Nt,4,6)}if(e&2){let t=p();s(2),x(2,t.dataLoading?2:3)}}function Mt(e,l){if(e&1){let t=b();n(0,"p-button",47),_("onClick",function(){h(t);let o=p();return C(o.handleAccept())}),r(),n(1,"p-button",48),_("onClick",function(){h(t);let o=p();return C(o.handleClose.emit())}),r()}e&2&&(m("raised",!0)("rounded",!0),s(),m("raised",!0)("rounded",!0))}var st=(()=>{let l=class l{constructor(){this.modalData={visible:!1,title:"",data:null,response:null},this.handleClose=new Te,this.fb=w(Y),this.storageService=w(Ie),this.guardService=w(ve),this.messageService=w(ne),this.guardActivityForm=this.fb.group({id:[""],subject:["",F.required],description:["",F.required],startDate:["",F.required],endDate:["",F.required],status:[""],guard:["",F.required],guardToShow:["",F.required],createdBy:[""],observation:[""]}),this.guards=[],this.dataLoading=!0,this.selectedGuard={},this.first=0,this.rows=10,this.totalItems=0,this.statusList=[{label:"PENDIENTE",value:D.PENDING},{label:"EN PROGRESO",value:D.IN_PROGRESS},{label:"FINALIZADO",value:D.FINISHED},{label:"INCOMPLETO",value:D.INCOMPLETE}],this.getErrorMessage=Be,this.getRowCellClass=ue}handleAccept(){if(this.guardActivityForm.valid){if(this.modalData.response=this.guardActivityForm.value,!this.modalData.data){let i=this.storageService.getAuth();i&&(this.modalData.response.createdBy=i.id)}if(this.modalData.response.startDate>this.modalData.response.endDate){this.messageService.add({severity:"error",summary:"Error",detail:"La fecha de inicio no puede ser mayor a la fecha de fin"});return}this.handleClose.emit()}else Object.values(this.guardActivityForm.controls).forEach(i=>{i.invalid&&i.markAsDirty()})}ngOnChanges(i){i.modalData&&(this.getGuards(),this.guardActivityForm.reset(),this.guardActivityForm.setValidators(this.validateDates),this.guardActivityForm.get("endDate")?.setValidators([F.required,this.validateDates]),this.guardActivityForm.get("endDate")?.updateValueAndValidity({onlySelf:!0}),this.guardActivityForm.patchValue(Se(be({},this.modalData.data),{startDate:this.modalData.data?.startDate?new Date(this.modalData.data.startDate):null,endDate:this.modalData.data?.endDate?new Date(this.modalData.data.endDate):null,guard:this.modalData.data?.guard?this.modalData.data.guard.id:null,guardToShow:this.modalData.data?.guard?this.modalData.data.guard.fullName+" - "+this.modalData.data.guard.dni:null})),this.modalData.data?this.guardActivityForm.get("status")?.setValidators(F.required):this.guardActivityForm.get("status")?.clearValidators(),this.guardActivityForm.get("status")?.updateValueAndValidity(),this.selectedGuard=this.modalData.data?.guard)}getGuards(i,o){this.guardService.findAllActiveGuards(i,o).subscribe({next:a=>{this.dataLoading=!0,this.totalItems=a.data.totalItems,this.guards=a.data.content,setTimeout(()=>{this.dataLoading=!1},300)},error:a=>{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudieron obtener los guardias"})}})}onSearchGuard(i){this.getGuards(i)}onRowSelect(i,o){this.selectedGuard=i.data,this.guardActivityForm.patchValue({guard:this.selectedGuard.id.toString()}),this.guardActivityForm.patchValue({guardToShow:this.selectedGuard.fullName+" - "+this.selectedGuard.dni}),o.hide()}onPageChange(i){this.first=i.first;let o=this.search.nativeElement.value;this.getGuards(o,i.page)}validateDates(i){let o=i.get("startDate")?.value,a=i.get("endDate")?.value;return o&&a&&a<=o?(i.get("endDate")?.setErrors({lowerDate:!0}),{lowerDate:!0}):null}};l.\u0275fac=function(o){return new(o||l)},l.\u0275cmp=V({type:l,selectors:[["app-guard-activity-form"]],viewQuery:function(o,a){if(o&1&&I(ft,5),o&2){let c;N(c=P())&&(a.search=c.first)}},inputs:{modalData:"modalData"},outputs:{handleClose:"handleClose"},standalone:!0,features:[z,M],decls:40,vars:19,consts:[["position","top","styleClass","w-10 md:w-8 lg:w-8",3,"header","visible","modal","draggable","resizable","visibleChange","onHide"],[1,"pt-4","grid","row-gap-3",3,"formGroup"],[1,"col-12","lg:col-5"],[1,"p-float-label"],["pInputText","","id","subject","formControlName","subject",1,"w-full"],["for","subject"],[3,"message"],[1,"col-10","lg:col-5"],["pInputText","","id","guardToShow","formControlName","guardToShow",1,"w-full",3,"readOnly"],["for","guardToShow"],[1,"col-2"],["title","Cambiar guardia responsable","pButton","","type","button","icon","pi pi-arrow-right-arrow-left","label","Cambiar",1,"p-button-rounded","p-button-sm","p-button-secondary",3,"click"],["btn",""],[1,"col-12"],["id","description","rows","7","formControlName","description","pInputTextarea","",1,"w-full"],["for","description"],[1,"col-12","lg:col-6"],["formControlName","startDate","id","startDate","dateFormat","dd/mm/yy","appendTo","body","styleClass","w-full",3,"showTime","showButtonBar"],["for","startDate"],["formControlName","endDate","id","endDate","dateFormat","dd/mm/yy","appendTo","body","styleClass","w-full",3,"showTime","showButtonBar"],["for","endDate"],["styleClass","bg-gray-200 w-11 lg:w-6",3,"showCloseIcon","dismissable"],["op1",""],["pTemplate","content"],["pTemplate","footer"],[1,"col-4","relative"],["for","status",1,"text-xs","text-gray-500","block","ml-3","absolute","left-0",2,"top","-1rem"],["formControlName","status","id","status",3,"options","emptyMessage"],["pTemplate","item"],[1,"col-8"],["id","observation","rows","9","formControlName","observation","pInputTextarea","",1,"w-full"],["for","observation"],[1,"flex","align-items-center","gap-2"],[1,"w-1rem","h-1rem","border-circle",3,"ngClass"],["pInputText","","placeholder","Buscar",1,"p-inputtext-sm","mb-2",3,"input"],["search",""],["class","flex justify-content-center"],[1,"flex","justify-content-center"],["styleClass","w-14rem h-14rem","strokeWidth","4","fill","var(--surface-ground)","animationDuration",".5s"],["styleClass","p-datatable-sm p-datatable-striped","selectionMode","single",3,"value","tableStyle","scrollable","scrollHeight","selection","selectionChange","onRowSelect"],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],[3,"pSelectableRow"],["alt","Foto de perfil",1,"w-3rem","max-h-4rem","rounded-full",3,"src"],[3,"rows","first","totalRecords","currentPageReportTemplate","showJumpToPageDropdown","onPageChange"],[1,"text-lg","py-2"],["label","Aceptar","severity","success",3,"raised","rounded","onClick"],["label","Cancelar","severity","danger",3,"raised","rounded","onClick"]],template:function(o,a){if(o&1){let c=b();n(0,"p-dialog",0),_("visibleChange",function(v){return a.modalData.visible=v})("onHide",function(){h(c);let v=T(37);return a.handleClose.emit(),C(v.hide())}),n(1,"form",1)(2,"div",2)(3,"span",3),u(4,"input",4),n(5,"label",5),d(6,"Asunto"),r()(),g(7,ht,1,1,"app-error-input",6),r(),n(8,"div",7)(9,"span",3),u(10,"input",8),n(11,"label",9),d(12,"Guardia responsable"),r()(),g(13,Ct,1,1,"app-error-input",6),r(),n(14,"div",10)(15,"button",11,12),_("click",function(v){h(c);let A=T(37);return C(A.toggle(v))}),r()(),n(17,"div",13)(18,"span",3),u(19,"textarea",14),n(20,"label",15),d(21,"Descripci\xF3n"),r()(),g(22,yt,1,1,"app-error-input",6),r(),n(23,"div",16)(24,"span",3),u(25,"p-calendar",17),n(26,"label",18),d(27,"Fecha & hora de inicio"),r()(),g(28,xt,1,1,"app-error-input",6),r(),n(29,"div",16)(30,"span",3),u(31,"p-calendar",19),n(32,"label",20),d(33,"Fecha & hora de fin"),r()(),g(34,bt,1,1,"app-error-input",6),r(),g(35,At,11,3),n(36,"p-overlayPanel",21,22),g(38,Pt,4,1,"ng-template",23),r()(),g(39,Mt,2,4,"ng-template",24),r()}if(o&2){let c,f,v,A,y,xe;m("header",a.modalData.title)("visible",a.modalData.visible)("modal",!0)("draggable",!1)("resizable",!1),s(),m("formGroup",a.guardActivityForm),s(6),x(7,(c=a.guardActivityForm.get("subject"))!=null&&c.invalid&&((c=a.guardActivityForm.get("subject"))!=null&&c.dirty)?7:-1),s(3),m("readOnly",!0),s(3),x(13,(f=a.guardActivityForm.get("guardToShow"))!=null&&f.invalid&&((f=a.guardActivityForm.get("guardToShow"))!=null&&f.dirty)?13:-1),s(9),x(22,(v=a.guardActivityForm.get("description"))!=null&&v.invalid&&((v=a.guardActivityForm.get("description"))!=null&&v.dirty)?22:-1),s(3),m("showTime",!0)("showButtonBar",!0),s(3),x(28,(A=a.guardActivityForm.get("startDate"))!=null&&A.invalid&&((A=a.guardActivityForm.get("startDate"))!=null&&A.dirty)?28:-1),s(3),m("showTime",!0)("showButtonBar",!0),s(3),x(34,(y=a.guardActivityForm.get("endDate"))!=null&&y.invalid&&((y=a.guardActivityForm.get("endDate"))!=null&&y.dirty)?34:-1),s(),x(35,(xe=a.guardActivityForm.get("id"))!=null&&xe.value?35:-1),s(),m("showCloseIcon",!0)("dismissable",!1)}},dependencies:[L,B,j,O,q,H,Oe,Ue,Qe,Ze,ie,te,de,se,Z,U,J,W,ee,K,X,Me,re,ae,ge,_e,ce,me,pe,$e,ze,le,oe,Ye,Xe,Fe]});let e=l;return e})();function Rt(e,l){if(e&1&&(n(0,"p",9),d(1," Guardia: "),n(2,"span",10),d(3),r()()),e&2){let t=p();s(3),S(t.guardActivity.guard.fullName)}}function kt(e,l){if(e&1&&(n(0,"p"),d(1),r()),e&2){let t=p();s(),S(t.guardActivity.observation)}}function Ot(e,l){e&1&&(n(0,"p"),d(1,"No hay observaciones"),r())}var Bt=()=>({size:"A4",margin:"0"}),jt=()=>({"-webkit-print-color-adjust":"exact"}),Lt=()=>({padding:"0 !important",border:"none !important"}),Ht=()=>({"border-top":"1px solid #e5e7eb !important","border-top-left-radius":"6px !important","border-top-right-radius":"6px !important"}),qt=()=>({"border-top-left-radius":"6px !important","border-top-right-radius":"6px !important"}),zt=(e,l,t,i,o)=>({"@page":e,body:l,".p-editor-toolbar.ng-star-inserted.ql-toolbar.ql-snow":t,".p-editor-container .p-editor-content":i,".p-editor-container .p-editor-content .ql-editor":o});function $t(e,l){if(e&1){let t=b();n(0,"div",14),u(1,"button",15),n(2,"p-button",16),_("click",function(){h(t);let o=p();return C(o.visible=!1)}),r()()}if(e&2){let t=p();s(),m("printSectionId","print-section")("useExistingCss",!0)("previewOnly",!1)("openNewTab",!1)("printTitle",t.guardActivity.subject)("printStyle",De(14,zt,E(9,Bt),E(10,jt),E(11,Lt),E(12,Ht),E(13,qt)))("bodyClass","p-2 bg-teal-50"),s(),m("rounded",!0)("raised",!0)}}var dt=(()=>{let l=class l{constructor(){this.guardActivity={},this.visible=!1,this.currentPresident={},this.userService=w(Ke)}ngOnChanges(i){this.userService.findPresident().subscribe(o=>{this.currentPresident=o.data}),i.guardActivity&&this.guardActivity}};l.\u0275fac=function(o){return new(o||l)},l.\u0275cmp=V({type:l,selectors:[["app-guard-activity-view"]],inputs:{guardActivity:"guardActivity",visible:"visible"},standalone:!0,features:[z,M],decls:46,vars:20,consts:[["styleClass"," w-11 lg:w-8 h-full","contentStyleClass","",3,"modal","draggable","resizable","visible","visibleChange"],["id","print-section"],[1,"flex","justify-content-center","relative"],["src","assets/images/logo-removebg.png","alt","logo",1,"w-8rem","mt-2","ml-2","absolute","top-0","left-0"],[1,"text-5xl","font-bold","mb-4"],[1,"flex","flex-column","gap-2"],[1,"text-center","font-bold","px-6","py-2","bg-teal-700","text-white","w-fit","m-auto","uppercase","mb-3"],[1,"text-xl","text-center","mb-2"],[1,"text-teal-700"],[1,"font-bold"],[1,"font-normal"],["class","font-bold"],[1,"text-sm","text-center"],["pTemplate","footer"],[1,"flex","gap-2","justify-content-end","align-items-center"],["title","Descargar en PDF","pButton","","label","Descargar","icon","pi pi-file-pdf","ngxPrint","",1,"p-button","p-button-raised","p-button-rounded","p-button-secondary",3,"printSectionId","useExistingCss","previewOnly","openNewTab","printTitle","printStyle","bodyClass"],["label","Cerrar","icon","pi pi-times","severity","danger",3,"rounded","raised","click"]],template:function(o,a){o&1&&(n(0,"p-dialog",0),_("visibleChange",function(f){return a.visible=f}),n(1,"div",1)(2,"div",2),u(3,"img",3),n(4,"h1",4),d(5,"PORTAL DE LA VI\xD1A"),r()(),n(6,"section",5)(7,"h1",6),d(8," Actividad de guardian\xEDa "),r(),n(9,"h2",7),d(10," Asunto: "),n(11,"span",8),d(12),r()(),n(13,"div")(14,"p",9),d(15," Fecha & hora de inicio: "),n(16,"span",10),d(17),R(18,"date"),r()(),n(19,"p",9),d(20," Fecha & hora de fin: "),n(21,"span",10),d(22),R(23,"date"),r()()(),g(24,Rt,4,1,"p",11),n(25,"p",9),d(26,"Descripci\xF3n de la actividad:"),r(),n(27,"p"),d(28),r(),n(29,"p",9),d(30,"Observaciones:"),r(),g(31,kt,2,1,"p")(32,Ot,2,0),u(33,"br")(34,"br")(35,"br"),n(36,"div",12)(37,"p",9),d(38),r(),n(39,"p"),d(40),r(),n(41,"p"),d(42),r(),n(43,"p"),d(44),r()()()(),g(45,$t,3,20,"ng-template",13),r()),o&2&&(m("modal",!0)("draggable",!1)("resizable",!1)("visible",a.visible),s(12),S(a.guardActivity.subject),s(5),S(k(18,14,a.guardActivity.startDate,"dd 'de' MMMM 'del' yyyy 'a las' HH:mm ")),s(5),S(k(23,17,a.guardActivity.endDate,"dd 'de' MMMM 'del' yyyy 'a las' HH:mm ")),s(2),x(24,a.guardActivity.guard?24:-1),s(4),S(a.guardActivity.description),s(3),x(31,a.guardActivity.observation?31:32),s(7),G(" ",a.currentPresident.names+" "+a.currentPresident.surnames," "),s(2),G("D.N.I.: ",a.currentPresident.dni,""),s(2),G("Telf.: ",a.currentPresident.phone,""),s(2),G("Email.: ",a.currentPresident.email,""))},dependencies:[q,H,O,L,B,j,Je,Q]});let e=l;return e})();var Qt=["container"],Ut=["gav"],Jt=["search"];function Wt(e,l){e&1&&u(0,"p-calendar",39)}function Zt(e,l){if(e&1){let t=b();u(0,"p-tag",41),n(1,"i",42),_("click",function(o){h(t),p(3);let a=T(15);return C(a.clear(o))}),r()}if(e&2){let t=p(3);m("styleClass",t.getTagClassFilter(t.getSelectedStatus()))("value",t.getGuardActivityStatusSpanishTranslationFilter(t.getSelectedStatus())||void 0)}}function Kt(e,l){if(e&1&&g(0,Zt,2,2),e&2){let t=p(2);x(0,t.getSelectedStatus()?0:-1)}}function Xt(e,l){e&1&&(n(0,"span",43),d(1,"Seleccione un estado"),r())}function Yt(e,l){if(e&1&&(n(0,"div",40),g(1,Kt,1,1)(2,Xt,2,0),r()),e&2){let t=p(),i;s(),x(1,(i=t.filterForm.get("status"))!=null&&i.value?1:2)}}function ei(e,l){if(e&1&&(n(0,"div",40)(1,"div",44),u(2,"p-tag",41),r()()),e&2){let t=l.$implicit,i=p();s(2),m("styleClass",i.getTagClass(t.value))("value",t.label||"Valor")}}function ti(e,l){e&1&&(n(0,"div",48),u(1,"p-progressSpinner",49),r())}function ii(e,l){e&1&&(n(0,"tr")(1,"th"),d(2,"Foto"),r(),n(3,"th"),d(4,"Nombre completo"),r(),n(5,"th"),d(6,"D.N.I."),r()())}function ni(e,l){if(e&1&&(n(0,"tr",51)(1,"td"),u(2,"img",52),r(),n(3,"td"),d(4),r(),n(5,"td"),d(6),r()()),e&2){let t=l.$implicit,i=l.$implicit;m("pSelectableRow",i),s(2),m("src",t.photoUrl,$),s(2),S(t.fullName),s(2),S(t.dni)}}function ai(e,l){if(e&1){let t=b();n(0,"div",48)(1,"p-paginator",53),_("onPageChange",function(o){h(t);let a=p(4);return C(a.onPageChangeGuard(o))}),r()()}if(e&2){let t=p(4);s(),m("rows",t.rows)("first",t.first)("totalRecords",t.totalItems)("currentPageReportTemplate","{currentPage} de {totalPages} p\xE1ginas ({totalRecords} registros)")("showJumpToPageDropdown",!0)}}function ri(e,l){e&1&&(n(0,"div",48)(1,"p",54),d(2,"No hay datos para mostrar"),r()())}function oi(e,l){if(e&1&&g(0,ai,2,5,"div",47)(1,ri,3,0),e&2){let t=p(3);x(0,t.guards.length>0?0:1)}}var li=()=>({"min-width":"30rem"});function si(e,l){if(e&1){let t=b();n(0,"p-table",50),_("selectionChange",function(o){h(t);let a=p(2);return C(a.selectedGuard=o)})("onRowSelect",function(o){h(t);let a=p(2),c=T(29);return C(a.onRowSelect(o,c))}),g(1,ii,7,0,"ng-template",31)(2,ni,7,4,"ng-template",32)(3,oi,2,1,"ng-template",33),r()}if(e&2){let t=p(2);m("value",t.guards)("tableStyle",E(5,li))("scrollable",!0)("scrollHeight","22vh")("selection",t.selectedGuard)}}function di(e,l){if(e&1){let t=b();n(0,"input",45,46),_("input",function(){h(t);let o=T(1),a=p();return C(a.onSearchGuard(o.value))}),r(),g(2,ti,2,0,"div",47)(3,si,4,6)}if(e&2){let t=p();s(2),x(2,t.dataLoading?2:3)}}function mi(e,l){e&1&&(n(0,"tr"),u(1,"th",55),n(2,"th"),d(3,"Asunto"),r(),n(4,"th"),d(5,"Descripci\xF3n"),r(),n(6,"th"),d(7,"Guardia responsable"),r(),n(8,"th"),d(9,"Fecha de inicio"),r(),n(10,"th"),d(11,"Fecha de fin"),r(),n(12,"th"),d(13,"Creado por"),r(),n(14,"th"),d(15,"Observaciones"),r(),n(16,"th"),d(17,"Estado"),r(),n(18,"th"),d(19,"Acciones"),r()())}function pi(e,l){if(e&1){let t=b();n(0,"p-button",62),_("click",function(){h(t);let o=p().$implicit,a=p();return C(a.onShowDialogPanel(o.description,"D"))}),r()}e&2&&m("rounded",!0)("text",!0)("raised",!0)}function ci(e,l){e&1&&d(0," No hay descripci\xF3n ")}function ui(e,l){if(e&1){let t=b();n(0,"p-button",62),_("click",function(){h(t);let o=p().$implicit,a=p();return C(a.onShowDialogPanel(o.observation,"O"))}),r()}e&2&&m("rounded",!0)("text",!0)("raised",!0)}function _i(e,l){e&1&&d(0," No hay observaciones ")}function gi(e,l){if(e&1){let t=b();n(0,"tr"),u(1,"td"),n(2,"td"),d(3),r(),n(4,"td"),g(5,pi,1,3,"p-button",56)(6,ci,1,0),r(),n(7,"td"),d(8),r(),n(9,"td"),d(10),R(11,"date"),r(),n(12,"td"),d(13),R(14,"date"),r(),n(15,"td"),d(16),r(),n(17,"td"),g(18,ui,1,3,"p-button",56)(19,_i,1,0),r(),n(20,"td",57),u(21,"p-tag",58),r(),n(22,"td")(23,"div",44)(24,"p-button",59),_("onClick",function(){let a=h(t).$implicit,c=p();return C(c.onViewGuardActivity(a))}),r(),n(25,"p-button",60),_("onClick",function(){let a=h(t).$implicit,c=p();return C(c.onOpenForm(a))}),r(),n(26,"p-button",61),_("onClick",function(){let a=h(t).$implicit,c=p();return C(c.onDeleteGuardActivity(a))}),r()()()()}if(e&2){let t=l.$implicit,i=p();fe(i.getRowClass(t.status)),s(),fe(i.getRowCellClass(t.status)),s(2),S(t.subject),s(2),x(5,t.description?5:6),s(3),S(t.guard.fullName),s(2),S(k(11,19,t.startDate,"dd/MM/yyyy HH:mm")),s(3),S(k(14,22,t.endDate,"dd/MM/yyyy HH:mm")),s(3),G(" ",t.createdBy.names+" "+t.createdBy.surnames," "),s(2),x(18,t.observation?18:19),s(3),m("value",i.getGuardActivityStatusSpanishTranslation(t.status))("styleClass",i.getTagClass(t.status)),s(3),m("rounded",!0)("raised",!0),s(),m("rounded",!0)("raised",!0),s(),m("rounded",!0)("raised",!0)}}function vi(e,l){if(e&1){let t=b();n(0,"div",48)(1,"p-paginator",63),_("onPageChange",function(o){h(t);let a=p(2);return C(a.onPageChange(o))}),r()()}if(e&2){let t=p(2);s(),m("rows",t.rows)("showJumpToPageDropdown",!0)("currentPageReportTemplate","{currentPage} de {totalPages} p\xE1ginas ({totalRecords} registros)")("first",t.first)("totalRecords",t.totalItems)}}function fi(e,l){e&1&&(n(0,"div",48)(1,"p",64),d(2,"No hay datos para mostrar"),r()())}function hi(e,l){if(e&1&&g(0,vi,2,5,"div",47)(1,fi,3,0),e&2){let t=p();x(0,t.guardActivities.length>0?0:1)}}function Ci(e,l){if(e&1){let t=b();n(0,"div",65)(1,"h2",66),d(2),r(),n(3,"p",67),d(4),r(),n(5,"div",68)(6,"p-button",69),_("onClick",function(){h(t);let o=p();return C(o.dialogVisible=!1)}),r()()()}if(e&2){let t=p();s(2),S(t.dialogTitle),s(2),G(" ",t.dialogContent," "),s(2),m("raised",!0)("rounded",!0)}}var yi=()=>({"min-width":"50rem"}),qn=(()=>{let l=class l extends je{constructor(){super(),this.guardActivities=[],this.first=0,this.rows=10,this.totalItems=0,this.modalData={visible:!1,title:"",data:null,response:null},this.dialogContent="",this.dialogVisible=!1,this.dialogTitle="",this.containerOptions={dataLoading:!0,showNewButton:!0,showSearch:!1},this.toolbarHeight=0,this.messageService=w(ne),this.confirmationService=w(Pe),this.cdr=w(Ae),this.guardActivityService=w(at),this.guardService=w(ve),this.fb=w(Y),this.filterForm=this.fb.group({subject:[""],start:[],end:[],guard:[""],guardToShow:[""],createdBy:[""],status:[]}),this.guards=[],this.selectedGuard={},this.firstGuardService=0,this.rowsGuardService=10,this.totalItemsGuardService=0,this.dataLoading=!0,this.statusList=[{label:"PENDIENTE",value:D.PENDING},{label:"EN PROGRESO",value:D.IN_PROGRESS},{label:"TERMINADA",value:D.FINISHED},{label:"INCOMPLETA",value:D.INCOMPLETE}],this.showInterval=!1,this.getRowClass=qe,this.getRowCellClass=ue,this.getGuardActivityStatusSpanishTranslation=he,this.getTagClass=Ce}ngOnInit(){super.ngOnInit(),this.getGuardActivities()}ngAfterViewInit(){this.toolbarHeight=this.container.toolbar.getBlockableElement().clientHeight,this.cdr.detectChanges()}onOpenForm(i){this.modalData={visible:!0,title:i?"Editar actividad de guardian\xEDa":"Nueva actividad de guardian\xEDa",data:i,response:null}}onSearch(i){this.getGuardActivities(i)}onPageChange(i){this.first=i.first,this.getGuardActivities(this.filterForm.value.subject||void 0,this.filterForm.value.start||void 0,this.filterForm.value.end||void 0,Number(this.filterForm.value.guard)||void 0,Number(this.filterForm.value.createdBy)||void 0,this.getSelectedStatus()||void 0,i.page)}getGuardActivities(i,o,a,c,f,v,A){this.guardActivityService.findAll(i,o,a,c,f,v,A).subscribe({next:y=>{this.containerOptions.dataLoading=!0,this.guardActivities=y.data.content,this.totalItems=y.data.totalItems,setTimeout(()=>{this.containerOptions.dataLoading=!1},300)},error:y=>{this.messageService.add({severity:"error",summary:"Error",detail:"Error al obtener las actividades"})}})}onDeleteGuardActivity(i){this.confirmationService.confirm({message:`\xBFEst\xE1s seguro de que quieres eliminar la actividad <span class="font-bold text-green-600">${i.subject}</span>?
      <br>
      <p class="mt-2"><span class="font-bold">Descripci\xF3n: </span> ${i.description}</p>
      <p class="font-bold text-red-600 mt-4">Esta acci\xF3n no se puede deshacer.</p>
`,header:"Confirmar eliminaci\xF3n de actividad del guardia",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",acceptIcon:"pi pi-trash mr-2",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.guardActivityService.deleteGuardActivity(i.id).subscribe({next:o=>{this.messageService.add({severity:"success",summary:"\xC9xito",detail:o.message}),this.getGuardActivities()},error:o=>{this.messageService.add({severity:"error",summary:"Error",detail:"Error al eliminar la actividad de guardian\xEDa"})}})}})}onViewGuardActivity(i){this.gav.visible=!0,this.gav.guardActivity=i,this.gav.ngOnChanges({socialEvent:{currentValue:i,previousValue:null,firstChange:!0,isFirstChange:()=>!0}})}onHandleCloseForm(){if(this.modalData.response){let i=this.modalData.response.id,o;i?(o={guard:this.modalData.response.guard,subject:this.modalData.response.subject,endDate:this.modalData.response.endDate.getTime(),startDate:this.modalData.response.startDate.getTime(),description:this.modalData.response.description,status:this.modalData.response.status,observation:this.modalData.response.observation},this.guardActivityService.updateGuardActivity(i,o).subscribe({next:a=>{this.reset(),this.messageService.add({severity:"success",summary:"\xC9xito",detail:a.message}),this.getGuardActivities()},error:a=>{this.messageService.add({severity:"danger",summary:"Error",detail:"Error al actualizar la actividad de guardian\xEDa"})}})):(o={guard:this.modalData.response.guard,createdBy:this.modalData.response.createdBy,subject:this.modalData.response.subject,endDate:this.modalData.response.endDate.getTime(),startDate:this.modalData.response.startDate.getTime(),description:this.modalData.response.description},this.guardActivityService.createGuardActivity(o).subscribe({next:a=>{this.reset(),this.messageService.add({severity:"success",summary:"\xC9xito",detail:a.message}),this.getGuardActivities()},error:a=>{this.messageService.add({severity:"danger",summary:"Error",detail:"Error al crear la actividad de guardian\xEDa"})}}))}else this.reset()}reset(){this.modalData={visible:!1,title:"",data:null,response:null}}onShowDialogPanel(i,o){this.dialogContent=i,this.dialogVisible=!0,this.dialogTitle=o==="O"?"Observaci\xF3n":"Descripci\xF3n"}getSelectedStatus(){let i=this.filterForm.get("status").value;return i?i.value:null}getGuards(i,o){this.guardService.findAllActiveGuards(i,o).subscribe({next:a=>{this.dataLoading=!0,this.totalItems=a.data.totalItems,this.guards=a.data.content,setTimeout(()=>{this.dataLoading=!1},300)},error:a=>{this.messageService.add({severity:"error",summary:"Error",detail:"No se pudieron obtener los guardias"})}})}onSearchGuard(i){this.getGuards(i)}onClearFilter(){this.filterForm.reset(),this.selectedGuard={}}onRowSelect(i,o){this.selectedGuard=i.data,this.filterForm.patchValue({guard:this.selectedGuard.id.toString()}),this.filterForm.patchValue({guardToShow:this.selectedGuard.fullName+" - "+this.selectedGuard.dni}),o.hide()}onFilter(){this.getGuardActivities(this.filterForm.value.subject||void 0,this.filterForm.value.start||void 0,this.filterForm.value.end||void 0,Number(this.filterForm.value.guard)||void 0,Number(this.filterForm.value.createdBy)||void 0,this.getSelectedStatus()||void 0,0)}clearGuardOnFilter(){this.filterForm.patchValue({guard:"",guardToShow:""}),this.selectedGuard={}}onPageChangeGuard(i){this.first=i.first;let o=this.search.nativeElement.value;this.getGuards(o,i.page)}getTagClassFilter(i){return i?Ce(i):""}getGuardActivityStatusSpanishTranslationFilter(i){return i?he(i):""}};l.\u0275fac=function(o){return new(o||l)},l.\u0275cmp=V({type:l,selectors:[["app-activities"]],viewQuery:function(o,a){if(o&1&&(I(Qt,5),I(Ut,5),I(Jt,5)),o&2){let c;N(c=P())&&(a.container=c.first),N(c=P())&&(a.gav=c.first),N(c=P())&&(a.search=c.first)}},standalone:!0,features:[Ee,M],decls:41,vars:25,consts:[[1,"block","mt-2",3,"options","onSearch","onOpenForm"],["container",""],["customSearcher",""],["icon","pi pi-angle-down","label","Abrir filtros","styleClass","bg-white hover:bg-gray-200",3,"rounded","raised","text","click"],["filterButton",""],["styleClass","bg-gray-700 w-11 lg:w-30rem",3,"showCloseIcon","dismissable"],["op",""],[3,"formGroup"],[1,"flex","flex-column","gap-1"],[1,"flex","gap-1","w-full"],["styleClass","p-inputtext-sm w-full","formControlName","start","dateFormat","dd/mm/yy","appendTo","body",1,"w-full",3,"placeholder"],["styleClass","p-inputtext-sm w-full","class","w-full","placeholder","Fecha de fin","formControlName","end","dateFormat","dd/mm/yy","appendTo","body"],["onLabel","Intervalo","offLabel","Fecha","styleClass","p-button-sm w-full",3,"onChange"],[1,"flex","w-full","gap-1"],["appendTo","body","formControlName","status","placeholder","Seleccine un tipo","optionLabel","name","styleClass","w-full p-inputtext-sm",1,"w-full",3,"options","onClear"],["statusDropdown",""],["pTemplate","selectedItem"],["pTemplate","item"],[1,"flex","gap-1"],["pInputText","","placeholder","Guardia","id","guardToShow","formControlName","guardToShow",1,"p-inputtext-sm",3,"readOnly"],["title","Limpiar guardia","type","button","pButton","","icon","pi pi-times",1,"p-button-sm",3,"click"],["pButton","","title","Seleccionar","type","button","icon","pi pi-arrow-right-arrow-left","label","Seleccionar",1,"p-button-rounded","p-button-sm","p-button-secondary","w-14rem",3,"click"],["btn",""],["type","text","pInputText","","placeholder","Asunto","formControlName","subject",1,"w-full","p-inputtext-sm"],[1,"flex","justify-content-between","mt-2"],["icon","pi pi-filter-slash","label","Limpiar","size","small",3,"outlined","onClick"],["icon","pi pi-filter","label","Filtrar","size","small",3,"outlined","onClick"],["styleClass","bg-gray-200 w-11 lg:w-6",3,"showCloseIcon","dismissable"],["op1",""],["pTemplate","content"],["styleClass","p-datatable-sm p-datatable-striped",3,"value","tableStyle","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],["styleClass","w-8","position","bottom",3,"visible","header","closable","draggable","visibleChange","onHide"],["ovp",""],["pTemplate","headless"],[3,"modalData","handleClose"],["gav",""],["styleClass","p-inputtext-sm w-full","placeholder","Fecha de fin","formControlName","end","dateFormat","dd/mm/yy","appendTo","body",1,"w-full"],[1,"flex","align-items-center","gap-2"],[3,"styleClass","value"],[1,"pi","pi-times",3,"click"],[1,"text-gray-500"],[1,"flex","gap-2"],["pInputText","","placeholder","Buscar",1,"p-inputtext-sm","mb-2",3,"input"],["search",""],["class","flex justify-content-center"],[1,"flex","justify-content-center"],["styleClass","w-14rem h-14rem","strokeWidth","4","fill","var(--surface-ground)","animationDuration",".5s"],["styleClass","p-datatable-sm p-datatable-striped","selectionMode","single",3,"value","tableStyle","scrollable","scrollHeight","selection","selectionChange","onRowSelect"],[3,"pSelectableRow"],["alt","Foto de perfil",1,"w-3rem","max-h-4rem","rounded-full",3,"src"],[3,"rows","first","totalRecords","currentPageReportTemplate","showJumpToPageDropdown","onPageChange"],[1,"text-lg","py-2"],[1,"w-1rem"],["severity","help","label","Mostrar","styleClass","w-full","size","small",3,"rounded","text","raised"],[1,"w-8rem"],[3,"value","styleClass"],["icon","pi pi-eye","severity","secondary","label","Ver","size","small",3,"rounded","raised","onClick"],["icon","pi pi-pencil","severity","warning","label","Editar","size","small",3,"rounded","raised","onClick"],["icon","pi pi-trash","severity","danger","label","Eliminar","size","small",3,"rounded","raised","onClick"],["severity","help","label","Mostrar","styleClass","w-full","size","small",3,"rounded","text","raised","click"],[3,"rows","showJumpToPageDropdown","currentPageReportTemplate","first","totalRecords","onPageChange"],[1,"text-lg","py-2","px-4"],[1,"bg-black-alpha-90","p-3","border-round","shadow-1"],[1,"text-teal-300","mb-2"],[1,"text-white"],[1,"flex","justify-content-end","mt-2"],["size","small","icon","pi pi-times","label","Cerrar","styleClass","ml-auto","severity","danger",3,"raised","rounded","onClick"]],template:function(o,a){if(o&1){let c=b();n(0,"app-container",0,1),_("onSearch",function(v){return a.onSearch(v)})("onOpenForm",function(){return a.onOpenForm()}),n(2,"div",2)(3,"p-button",3,4),_("click",function(v){return h(c),T(6).toggle(v),C(a.getGuards())}),r(),n(5,"p-overlayPanel",5,6)(7,"form",7)(8,"div",8)(9,"div",9),u(10,"p-calendar",10),g(11,Wt,1,0,"p-calendar",11),n(12,"p-toggleButton",12),_("onChange",function(){let v;return a.showInterval=!a.showInterval,(v=a.filterForm.get("end"))==null?null:v.setValue(null)}),r()(),n(13,"div",13)(14,"p-dropdown",14,15),_("onClear",function(){let v;return(v=a.filterForm.get("status"))==null?null:v.setValue(null)}),g(16,Yt,3,1,"ng-template",16)(17,ei,3,2,"ng-template",17),r()(),n(18,"div",18)(19,"p-inputGroup"),u(20,"input",19),n(21,"button",20),_("click",function(){return a.clearGuardOnFilter()}),r()(),n(22,"button",21,22),_("click",function(v){h(c);let A=T(29);return C(A.toggle(v))}),r()(),u(24,"input",23),n(25,"div",24)(26,"p-button",25),_("onClick",function(){return a.onClearFilter()}),r(),n(27,"p-button",26),_("onClick",function(){return a.onFilter()}),r()(),n(28,"p-overlayPanel",27,28),g(30,di,4,1,"ng-template",29),r()()()()(),n(31,"p-table",30),g(32,mi,20,0,"ng-template",31)(33,gi,27,25,"ng-template",32)(34,hi,2,1,"ng-template",33),r()(),n(35,"p-dialog",34,35),_("visibleChange",function(v){return a.dialogVisible=v})("onHide",function(){return a.dialogVisible=!1}),g(37,Ci,7,4,"ng-template",36),r(),n(38,"app-guard-activity-form",37),_("handleClose",function(){return a.onHandleCloseForm()}),r(),u(39,"app-guard-activity-view",null,38)}o&2&&(m("options",a.containerOptions),s(3),m("rounded",!0)("raised",!0)("text",!0),s(2),m("showCloseIcon",!0)("dismissable",!1),s(2),m("formGroup",a.filterForm),s(3),m("placeholder",a.showInterval?"Fecha de inicio":"Fecha"),s(),x(11,a.showInterval?11:-1),s(3),m("options",a.statusList),s(6),m("readOnly",!0),s(6),m("outlined",!0),s(),m("outlined",!0),s(),m("showCloseIcon",!0)("dismissable",!1),s(3),m("value",a.guardActivities)("tableStyle",E(24,yi))("scrollable",!0)("scrollHeight","calc(100vh - "+a.toolbarHeight+"px - 18.0rem)"),s(4),m("visible",a.dialogVisible)("header","Observaciones")("closable",!0)("draggable",!1),s(3),m("modalData",a.modalData))},dependencies:[We,ce,me,O,pe,Q,L,B,j,Le,st,de,se,He,Z,U,J,W,re,ae,dt,q,H,tt,et,ge,_e,ke,Re,ee,K,X,ie,te,le,oe,nt,it]});let e=l;return e})();export{qn as ActivitiesComponent};
